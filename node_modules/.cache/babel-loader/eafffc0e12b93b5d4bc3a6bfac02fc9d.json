{"ast":null,"code":"/* eslint-disable jsdoc/require-returns */\n\n/* eslint-disable jsdoc/require-param */\n\n/* eslint-disable valid-jsdoc */\n\n/* eslint-disable no-case-declarations */\nimport { Browser } from '@syncfusion/ej2-base';\nimport { Point } from '../primitives/point';\nimport { Container } from '../core/containers/container';\nimport { Connector } from '../objects/connector';\nimport { NodeDrawingTool, ConnectorDrawingTool, TextDrawingTool } from './tool';\nimport { PolygonDrawingTool, PolyLineDrawingTool, FixedUserHandleTool } from './tool';\nimport { Node } from '../objects/node';\nimport { SelectTool, MoveTool, ResizeTool, RotateTool, ConnectTool, ExpandTool, LabelTool, ZoomPanTool } from './tool';\nimport { LabelDragTool, LabelResizeTool, LabelRotateTool } from './tool';\nimport { ConnectorEditing } from './connector-editing';\nimport { Selector } from '../objects/node';\nimport { findToolToActivate, isSelected, getCursor, contains } from './actions';\nimport { DiagramAction, KeyModifiers, Keys, DiagramEvent, DiagramTools, RendererAction, DiagramConstraints } from '../enum/enum';\nimport { BlazorAction, ScrollActions } from '../enum/enum';\nimport { isPointOverConnector, findObjectType, insertObject, getObjectFromCollection, getTooltipOffset, findParentInSwimlane } from '../utility/diagram-util';\nimport { getObjectType, getInOutConnectPorts, removeChildNodes, cloneBlazorObject, checkPort } from '../utility/diagram-util';\nimport { canZoomPan, canDraw, canDrag, canZoomTextEdit, canVitualize, canPreventClearSelection } from './../utility/constraints-util';\nimport { canMove, canEnablePointerEvents, canSelect, canEnableToolTip } from './../utility/constraints-util';\nimport { canOutConnect, canInConnect, canPortInConnect, canPortOutConnect, canAllowDrop, canUserInteract, defaultTool } from './../utility/constraints-util';\nimport { updateTooltip } from '../objects/tooltip';\nimport { PortVisibility, NodeConstraints, ConnectorConstraints, RealAction } from '../enum/enum';\nimport { addTouchPointer, measureHtmlText, getAdornerLayerSvg } from '../utility/dom-util';\nimport { TextElement } from '../core/elements/text-element';\nimport { Size } from '../primitives/size';\nimport { cloneObject as clone, cloneObject } from './../utility/base-util';\nimport { Rect } from '../primitives/rect';\nimport { identityMatrix, rotateMatrix, transformPointByMatrix } from './../primitives/matrix';\nimport { removeRulerMarkers, drawRulerMarkers, getRulerSize, updateRuler } from '../ruler/ruler';\nimport { canContinuousDraw, canDrawOnce } from '../utility/constraints-util';\nimport { getFunction, cornersPointsBeforeRotation } from '../utility/base-util';\nimport { updateCanvasBounds, checkChildNodeInContainer, checkParentAsContainer, removeChildInContainer } from './container-interaction';\nimport { moveChildInStack, renderStackHighlighter } from './container-interaction';\nimport { updateSwimLaneObject } from '../utility/swim-lane-util';\nimport { getConnectors, updateHeaderMaxWidth, laneInterChanged, updateConnectorsProperties } from '../utility/swim-lane-util';\nimport { DiagramHtmlElement } from '../core/elements/html-element';\nimport { randomId } from '../index';\nimport { isBlazor } from '@syncfusion/ej2-base';\n/**\n * This module handles the mouse and touch events\n */\n\nvar DiagramEventHandler =\n/** @class */\nfunction () {\n  /** @private */\n  function DiagramEventHandler(diagram, commandHandler) {\n    this.currentAction = 'None';\n    this.previousAction = 'None';\n    /**   @private  */\n\n    this.focus = false;\n    this.isBlocked = false;\n    this.isMouseDown = false;\n    this.inAction = false;\n    this.doingAutoScroll = false;\n    this.diagram = null;\n    this.objectFinder = null;\n    this.tool = null;\n    this.eventArgs = null;\n    this.keyArgs = {};\n    this.diagram = diagram;\n    this.objectFinder = new ObjectFinder();\n    this.commandHandler = commandHandler;\n  }\n\n  Object.defineProperty(DiagramEventHandler.prototype, \"action\", {\n    get: function () {\n      return this.currentAction;\n    },\n    set: function (action) {\n      if (action !== this.currentAction) {\n        if (this.currentAction === 'PortDraw') {\n          this.diagram.tool &= ~DiagramTools.DrawOnce;\n\n          if (this.tool) {\n            this.tool.mouseUp({\n              position: this.currentPosition\n            });\n          }\n\n          this.tool = null;\n        }\n\n        if (action === 'Rotate' || action === 'LabelRotate') {\n          this.diagram.diagramCanvas.classList.add('e-diagram-rotate');\n        } else if (this.currentAction === 'Rotate' || this.currentAction === 'LabelRotate') {\n          this.diagram.diagramCanvas.classList.remove('e-diagram-rotate');\n        }\n\n        this.currentAction = action;\n\n        if (this.currentAction !== 'None' && this.currentAction !== 'Select' && !(this.diagram.diagramActions & DiagramAction.TextEdit) || this.commandHandler.isUserHandle(this.currentPosition)) {\n          this.diagram.diagramActions = this.diagram.diagramActions | DiagramAction.ToolAction;\n        } else {\n          this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.ToolAction;\n        }\n\n        this.diagram.setCursor(this.diagram.getCursor(action, this.inAction));\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(DiagramEventHandler.prototype, \"blocked\", {\n    get: function () {\n      return this.isBlocked;\n    },\n    set: function (blocked) {\n      this.isBlocked = blocked;\n\n      if (this.blocked) {\n        this.diagram.setCursor('not-allowed');\n      } else {\n        this.diagram.setCursor(this.diagram.getCursor(this.action, this.inAction));\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /** @private */\n\n  DiagramEventHandler.prototype.getMousePosition = function (e) {\n    var touchArg;\n    var offsetX;\n    var offsetY;\n\n    if (e.type.indexOf('touch') !== -1) {\n      touchArg = e;\n      offsetX = touchArg.changedTouches[0].clientX;\n      offsetY = touchArg.changedTouches[0].clientY;\n    } else {\n      offsetX = e.clientX;\n      offsetY = e.clientY;\n    }\n\n    var position = new Size();\n    position = getRulerSize(this.diagram);\n    var boundingRect = this.diagram.element.getBoundingClientRect();\n    offsetX = offsetX + this.diagram.diagramCanvas.scrollLeft - boundingRect.left - position.width;\n    offsetY = offsetY + this.diagram.diagramCanvas.scrollTop - boundingRect.top - position.height;\n    offsetX /= this.diagram.scroller.transform.scale;\n    offsetY /= this.diagram.scroller.transform.scale;\n    offsetX -= this.diagram.scroller.transform.tx;\n    offsetY -= this.diagram.scroller.transform.ty;\n    return {\n      x: offsetX,\n      y: offsetY\n    };\n  };\n  /**\n   * @private\n   */\n\n\n  DiagramEventHandler.prototype.windowResize = function (evt) {\n    var _this = this;\n\n    if (this.resizeTo) {\n      clearTimeout(this.resizeTo);\n    }\n\n    this.resizeTo = setTimeout(function () {\n      _this.updateViewPortSize(_this.diagram.element);\n    }, 300);\n    return false;\n  };\n  /**\n   * @private\n   */\n\n\n  DiagramEventHandler.prototype.updateViewPortSize = function (element) {\n    var container = document.getElementById(element.id);\n\n    if (container) {\n      var bounds = container.getBoundingClientRect();\n      this.diagram.scroller.setViewPortSize(bounds.width, bounds.height);\n      var position = new Size();\n      position = getRulerSize(this.diagram);\n      var width = this.diagram.getSizeValue(this.diagram.width, position.width);\n      var height = this.diagram.getSizeValue(this.diagram.height, position.height);\n      this.diagram.diagramCanvas.style.width = width;\n      this.diagram.diagramCanvas.style.height = height;\n      this.diagram.scroller.setSize();\n      this.diagram.transformLayers();\n\n      if (this.diagram.rulerSettings.showRulers) {\n        updateRuler(this.diagram);\n      }\n    }\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.canHideResizers = function () {\n    return (this.tool instanceof MoveTool || this.tool instanceof RotateTool) && this.isMouseDown;\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.updateCursor = function () {\n    if (this.diagram.selectedItems.nodes.length === 1 || this.diagram.selectedItems.connectors.length === 1) {\n      var list = [];\n      list = list.concat(this.diagram.selectedItems.nodes, this.diagram.selectedItems.connectors); // Bug fix - EJ2-44495 -Node does not gets selected on slight movement of mouse when drag constraints disabled for node\n\n      this.blocked = this.eventArgs && this.eventArgs.source && !canMove(this.eventArgs.source) ? false : this.isMouseDown && list.length === 1 && this.tool instanceof SelectTool && !canMove(list[0]);\n    }\n  };\n\n  DiagramEventHandler.prototype.isForeignObject = function (target, isTextBox) {\n    var foreignobject = target;\n\n    if (foreignobject) {\n      while (foreignobject.parentNode !== null) {\n        if (typeof foreignobject.className === 'string' && (!isTextBox && foreignobject.className.indexOf('foreign-object') !== -1 || isTextBox && foreignobject.className.indexOf('e-diagram-text-edit') !== -1)) {\n          return foreignobject;\n        } else {\n          foreignobject = foreignobject.parentNode;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  DiagramEventHandler.prototype.isMetaKey = function (evt) {\n    return navigator.platform.match('Mac') ? evt.metaKey : evt.ctrlKey;\n  };\n\n  DiagramEventHandler.prototype.renderUmlHighLighter = function (args) {\n    this.diagram.commandHandler.removeStackHighlighter();\n    var node = this.diagram.selectedItems.nodes[0];\n\n    if (node && node.container && node.container.type === 'Stack' && node.shape.type === 'UmlClassifier') {\n      var bound = node.wrapper.bounds;\n\n      if (!bound.containsPoint(this.currentPosition)) {\n        // eslint-disable-next-line max-len\n        var objects = this.diagram.findObjectsUnderMouse({\n          x: this.currentPosition.x - 20,\n          y: this.currentPosition.y\n        });\n        var target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n\n        if (target && target.parentId && target.parentId === node.id) {\n          // eslint-disable-next-line max-len\n          var isVertical = this.diagram.nameTable[target.parentId].container.orientation === 'Vertical';\n          renderStackHighlighter(target.wrapper, isVertical, args.position, this.diagram, true);\n        }\n      }\n    }\n  };\n\n  DiagramEventHandler.prototype.isDeleteKey = function (key, value) {\n    return navigator.platform.match('Mac') && key === 'Backspace' && value === 'delete';\n  };\n\n  DiagramEventHandler.prototype.isMouseOnScrollBar = function (evt) {\n    var x = evt.offsetX;\n    var y = evt.offsetY;\n    var diagramCanvas = this.diagram.diagramCanvas;\n    var height = diagramCanvas.offsetHeight;\n    var width = diagramCanvas.offsetWidth;\n    var topLeft;\n    var topRight;\n    var bottomLeft;\n    var bottomRight;\n    var bounds;\n\n    if (height < diagramCanvas.scrollHeight) {\n      //default scrollbar width in browser is '17pixels'.\n      topLeft = {\n        x: width - 17,\n        y: 0\n      };\n      topRight = {\n        x: width,\n        y: 0\n      };\n      bottomLeft = {\n        x: width - 17,\n        y: height\n      };\n      bottomRight = {\n        x: width,\n        y: height\n      };\n      bounds = Rect.toBounds([topLeft, topRight, bottomLeft, bottomRight]);\n\n      if (bounds.containsPoint({\n        x: x,\n        y: y\n      })) {\n        return true;\n      }\n    }\n\n    if (width < diagramCanvas.scrollWidth) {\n      topLeft = {\n        x: 0,\n        y: height - 17\n      };\n      topRight = {\n        x: width,\n        y: height - 17\n      };\n      bottomLeft = {\n        x: 0,\n        y: height\n      };\n      bottomRight = {\n        x: width,\n        y: height\n      };\n      bounds = Rect.toBounds([topLeft, topRight, bottomLeft, bottomRight]);\n\n      if (bounds.containsPoint({\n        x: x,\n        y: y\n      })) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n  /**   @private  */\n\n\n  DiagramEventHandler.prototype.updateVirtualization = function () {\n    var _this = this;\n\n    var delay = 50; //let removeObjectInterval: Object;\n\n    var removeObjectInterval = setInterval(function (args) {\n      _this.diagram.removeVirtualObjects(removeObjectInterval);\n    }, delay);\n    setTimeout(function () {\n      _this.diagram.deleteVirtualObject = true;\n    }, delay);\n  };\n\n  DiagramEventHandler.prototype.checkPreviousAction = function () {\n    if (this.action !== this.previousAction && this.diagram.selectedItems.userHandles.length) {\n      for (var i = 0; i < this.diagram.selectedItems.userHandles.length; i++) {\n        if (this.previousAction && this.diagram.selectedItems.userHandles[i]) {\n          this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseLeave);\n          this.previousAction = 'None';\n        }\n      }\n    }\n  };\n\n  DiagramEventHandler.prototype.checkUserHandleEvent = function (eventName) {\n    if (this.diagram.selectedItems && this.diagram.selectedItems.userHandles.length > 0) {\n      var currentAction = eventName === DiagramEvent.onUserHandleMouseLeave ? this.previousAction : this.action;\n      var arg = {\n        element: undefined\n      };\n\n      for (var i = 0; i < this.diagram.selectedItems.userHandles.length; i++) {\n        if (currentAction === this.diagram.selectedItems.userHandles[i].name || eventName === DiagramEvent.onUserHandleMouseUp && currentAction === 'Select') {\n          arg.element = this.diagram.selectedItems.userHandles[i];\n\n          if (eventName === DiagramEvent.onUserHandleMouseEnter) {\n            this.previousAction = this.action;\n          }\n\n          if (eventName === DiagramEvent.onUserHandleMouseDown) {\n            this.userHandleObject = this.diagram.selectedItems.userHandles[i].name;\n          }\n\n          var element = document.getElementById(this.diagram.selectedItems.userHandles[i].name + '_userhandle');\n\n          if (eventName === DiagramEvent.onUserHandleMouseUp) {\n            if (this.commandHandler.isUserHandle(this.currentPosition) && element && element.id === this.userHandleObject + '_userhandle') {\n              this.diagram.triggerEvent(eventName, arg);\n            }\n          } else {\n            this.diagram.triggerEvent(eventName, arg);\n          }\n        }\n      }\n    }\n  };\n\n  DiagramEventHandler.prototype.mouseDown = function (evt) {\n    this.focus = true; //let touches: TouchList;\n\n    var touches = evt.touches;\n\n    if (this.isMouseOnScrollBar(evt)) {\n      this.isScrolling = true;\n      evt.preventDefault();\n      return;\n    } // commanded by gowtham- unwanted cloning of selectedItems\n    // if (isBlazor()) {\n    //     this.commandHandler.oldSelectedObjects = cloneObject(this.diagram.selectedItems);\n    // }\n\n\n    this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseDown);\n\n    if (!this.checkEditBoxAsTarget(evt) && canUserInteract(this.diagram) || canZoomPan(this.diagram) && !defaultTool(this.diagram)) {\n      if (this.action === 'Select' || this.action === 'Drag') {\n        this.diagram.updatePortVisibility(this.hoverElement, PortVisibility.Hover, true);\n      }\n\n      if ((this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool) && (evt.button === 2 || evt.buttons === 2)) {\n        // eslint-disable-next-line\n        var arg = {\n          element: cloneBlazorObject(this.diagram),\n          position: cloneBlazorObject(this.currentPosition),\n          count: evt.buttons,\n          actualObject: cloneBlazorObject(this.eventArgs.actualObject),\n          button: evt.button === 0 ? 'Left' : evt.button === 1 ? 'Middle' : 'Right'\n        };\n        this.inAction = false;\n        this.tool.mouseUp(this.eventArgs);\n      } else if (this.inAction === true && this.isMouseDown === true && (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool)) {\n        this.isMouseDown = true;\n        this.eventArgs = {};\n        this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n        this.eventArgs.position = this.currentPosition;\n        this.tool.mouseDown(this.eventArgs);\n      } else {\n        this.isMouseDown = true;\n        this.currentPosition = this.prevPosition = this.getMousePosition(evt);\n        this.eventArgs = {};\n\n        if (this.diagram.textEditing && !this.isMouseOnScrollBar(evt)) {\n          this.diagram.endEdit();\n          this.diagram.textEditing = false;\n        }\n\n        var target = void 0;\n        var objects = this.objectFinder.findObjectsUnderMouse(this.currentPosition, this.diagram, this.eventArgs, null, this.action);\n        var obj = this.objectFinder.findObjectUnderMouse(this.diagram, objects, this.action, this.inAction, this.eventArgs, this.currentPosition);\n        var sourceElement = null;\n\n        if (obj !== null) {\n          sourceElement = this.diagram.findElementUnderMouse(obj, this.currentPosition);\n\n          if (sourceElement) {\n            target = this.commandHandler.findTarget(sourceElement, obj);\n          }\n        }\n\n        this.action = this.diagram.findActionToBeDone(obj, sourceElement, this.currentPosition, target); //work around - correct it\n\n        var ctrlKey = this.isMetaKey(evt);\n\n        if (ctrlKey && evt.shiftKey && this.diagram.connectorEditingToolModule) {\n          this.action = 'SegmentEnd';\n        } else if ((ctrlKey || evt.shiftKey) && !canZoomPan(this.diagram)) {\n          this.action = 'Select';\n        }\n\n        this.tool = this.diagram.getTool(this.action);\n\n        if (!this.tool) {\n          this.action = 'Select';\n          this.tool = this.diagram.getTool(this.action);\n        }\n\n        this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n\n        if (ctrlKey || evt.shiftKey) {\n          var info = ctrlKey && evt.shiftKey ? {\n            ctrlKey: ctrlKey,\n            shiftKey: evt.shiftKey\n          } : {\n            ctrlKey: true\n          };\n          this.eventArgs.info = info;\n        }\n\n        this.eventArgs.position = this.currentPosition;\n        this.tool.mouseDown(this.eventArgs);\n        this.initialEventArgs = {\n          source: this.eventArgs.source,\n          sourceWrapper: this.eventArgs.sourceWrapper\n        };\n        this.initialEventArgs.position = this.currentPosition;\n        this.initialEventArgs.info = this.eventArgs.info;\n        this.inAction = false;\n\n        if (evt.type === 'touchstart') {\n          if (touches && touches.length >= 2) {\n            this.touchStartList = addTouchPointer(this.touchStartList, evt, touches);\n          }\n\n          if (!touches) {\n            evt.preventDefault();\n          }\n        }\n      }\n    }\n\n    if (!this.isForeignObject(evt.target) && !this.isForeignObject(evt.target, true) && !touches) {\n      evt.preventDefault();\n    }\n  };\n  /**   @private  */\n\n\n  DiagramEventHandler.prototype.mouseMoveExtend = function (e, obj) {\n    if (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool) {\n      this.tool.mouseMove(this.eventArgs);\n    }\n\n    if (this.diagram.scrollSettings.canAutoScroll) {\n      this.checkAutoScroll(e);\n    } else {\n      if (!this.blocked) {\n        this.tool.mouseMove(this.eventArgs);\n      }\n    }\n\n    if (this.eventArgs.target) {\n      this.hoverElement = this.eventArgs.target;\n    }\n\n    var isNode = this.eventArgs.target instanceof Node && obj instanceof Node ? false : true;\n\n    if (this.tool instanceof ConnectTool) {\n      this.diagram.updatePortVisibility(this.hoverElement instanceof Node ? this.hoverElement : this.hoverNode, PortVisibility.Connect | PortVisibility.Hover, isNode);\n    }\n\n    if (this.hoverElement instanceof Node && this.hoverNode instanceof Node && this.hoverNode && this.hoverNode.id !== this.hoverElement.id) {\n      this.diagram.updatePortVisibility(this.hoverNode, PortVisibility.Connect | PortVisibility.Hover, true);\n    }\n\n    this.hoverElement = isNode ? null : obj;\n    this.hoverNode = isNode ? null : obj;\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.checkAction = function (obj) {\n    if (this.action === 'LabelSelect' && this.eventArgs.sourceWrapper && (this.eventArgs.sourceWrapper instanceof TextElement || this.eventArgs.sourceWrapper instanceof DiagramHtmlElement)) {\n      var annotation = this.commandHandler.findTarget(this.eventArgs.sourceWrapper, this.eventArgs.source);\n\n      if (!isSelected(this.diagram, annotation, false, this.eventArgs.sourceWrapper) && canMove(annotation)) {\n        this.action = 'LabelDrag';\n        this.tool = this.getTool(this.action);\n        this.tool.mouseDown(this.initialEventArgs);\n      }\n    } else if (canMove(obj) && canSelect(obj) && this.initialEventArgs && this.initialEventArgs.source && this.action === 'Select') {\n      if (!isSelected(this.diagram, this.eventArgs.source, false) && this.eventArgs.source instanceof Selector) {\n        this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n      }\n\n      if (!(obj instanceof Connector) || obj instanceof Connector && !(contains(this.currentPosition, obj.sourcePoint, obj.hitPadding) || contains(this.currentPosition, obj.targetPoint, obj.hitPadding))) {\n        this.action = 'Drag';\n      }\n\n      this.tool = this.getTool(this.action);\n      this.tool.mouseDown(this.initialEventArgs);\n    }\n  };\n\n  DiagramEventHandler.prototype.isSwimlaneElements = function (obj) {\n    if (obj && (obj.isLane || obj.isPhase || obj.isHeader)) {\n      return false;\n    } else {\n      return true;\n    }\n  };\n  /* tslint:disable */\n\n  /** @private */\n\n\n  DiagramEventHandler.prototype.mouseMove = function (e, touches) {\n    this.focus = true;\n\n    if (this.isScrolling) {\n      e.preventDefault();\n      return;\n    }\n\n    if (canUserInteract(this.diagram) || canZoomPan(this.diagram) && !defaultTool(this.diagram)) {\n      this.currentPosition = this.getMousePosition(e);\n      var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n      var obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n      drawRulerMarkers(this.diagram, this.currentPosition);\n      var force = false;\n      var target = void 0;\n\n      if (e.type === 'touchmove') {\n        touches = e.touches;\n\n        if (touches && touches.length > 1) {\n          this.touchMoveList = addTouchPointer(this.touchMoveList, e, touches);\n\n          if (this.action !== 'PinchZoom') {\n            force = true;\n          }\n        }\n      }\n\n      if (Point.equals(this.currentPosition, this.prevPosition) === false || this.inAction) {\n        if (this.isMouseDown === false || force) {\n          this.eventArgs = {};\n          var sourceElement = null;\n\n          if (obj !== null) {\n            sourceElement = this.diagram.findElementUnderMouse(obj, this.currentPosition);\n\n            if (obj !== this.hoverElement) {\n              var content_1 = this.getContent();\n\n              if (this.hoverElement && this.hoverElement.tooltip.openOn === 'Auto' && content_1 !== '') {\n                this.elementLeave();\n              }\n\n              this.diagram.updatePortVisibility(this.hoverElement, PortVisibility.Hover, true);\n\n              if (obj instanceof Node) {\n                this.hoverNode = obj;\n              }\n\n              var canResetElement = true;\n\n              if (!this.isSwimlaneElements(obj) && this.hoverElement && this.isSwimlaneElements(this.hoverElement)) {\n                canResetElement = false;\n              }\n\n              this.hoverElement = canResetElement ? obj : this.hoverElement;\n\n              if (canResetElement) {\n                this.elementEnter(this.currentPosition, false);\n              } else {\n                this.hoverElement = obj;\n              }\n            } else if (!this.hoverElement && this.hoverElement === obj) {\n              this.elementEnter(this.currentPosition, true);\n            }\n\n            if (sourceElement) {\n              target = this.commandHandler.findTarget(sourceElement, obj);\n            }\n          }\n\n          this.action = this.diagram.findActionToBeDone(obj, sourceElement, this.currentPosition, target);\n          this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseEnter);\n          this.checkPreviousAction();\n          this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n          this.tool = this.getTool(this.action);\n          this.mouseEvents();\n\n          if (this.tool instanceof ConnectorDrawingTool || this.tool instanceof PolyLineDrawingTool || this.tool instanceof PolygonDrawingTool) {\n            this.tool.mouseMove(this.eventArgs);\n          } else if (touches && this.tool instanceof ZoomPanTool) {\n            this.tool.mouseDown(this.eventArgs);\n          }\n\n          this.updateCursor();\n          this.renderUmlHighLighter(this.eventArgs);\n          var isNode = false;\n\n          if (!(this.hoverElement && !(this.tool instanceof ZoomPanTool) && obj instanceof Node && this.isSwimlaneElements(obj) && (this.diagram.selectedItems.nodes.length === 0 || !isSelected(this.diagram, this.hoverElement)))) {\n            isNode = true;\n          }\n\n          this.diagram.updatePortVisibility(this.hoverElement, PortVisibility.Hover, isNode);\n          var content = this.getContent();\n\n          if (obj === null && this.hoverElement && this.hoverElement.tooltip.openOn === 'Auto' && content) {\n            this.hoverElement = null;\n            this.elementLeave();\n          }\n\n          force = false;\n        } else {\n          this.eventArgs.position = this.currentPosition;\n\n          if (this.action === 'Drag' && !isSelected(this.diagram, this.eventArgs.source, false) && this.eventArgs.source instanceof Selector) {\n            this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n          }\n\n          this.mouseEvents();\n\n          if (e.ctrlKey || e.shiftKey) {\n            var info = e.ctrlKey && e.shiftKey ? {\n              ctrlKey: e.ctrlKey,\n              shiftKey: e.shiftKey\n            } : {\n              ctrlKey: true\n            };\n            this.eventArgs.info = info;\n          }\n\n          this.checkAction(obj);\n          var padding = this.getConnectorPadding(this.eventArgs);\n          this.getMouseEventArgs(this.currentPosition, this.eventArgs, this.eventArgs.source, padding);\n          this.updateCursor();\n          this.inAction = true;\n          this.initialEventArgs = null;\n\n          if (this.action === 'Drag' || this.action === 'Rotate') {\n            this.diagram.diagramActions = this.diagram.diagramActions | DiagramAction.Interactions;\n          }\n\n          this.mouseMoveExtend(e, obj);\n        }\n\n        this.prevPosition = this.currentPosition;\n\n        if (!this.isForeignObject(e.target, true)) {\n          e.preventDefault();\n        }\n      }\n    }\n  };\n  /* tslint:enable */\n\n\n  DiagramEventHandler.prototype.getContent = function () {\n    var isPrivateTooltip = this.hoverElement instanceof Node && this.hoverElement.constraints & NodeConstraints.Tooltip || this.hoverElement instanceof Connector && this.hoverElement.constraints & ConnectorConstraints.Tooltip;\n    var content = isPrivateTooltip ? this.hoverElement.tooltip.content : this.diagram.tooltip.content;\n    return content;\n  };\n\n  DiagramEventHandler.prototype.checkAutoScroll = function (e) {\n    var autoScrollPosition = this.startAutoScroll(e);\n\n    if (!autoScrollPosition && this.doingAutoScroll) {\n      this.doingAutoScroll = false;\n      clearInterval(this.timeOutValue);\n    } else if (autoScrollPosition) {\n      if ((this.tool instanceof NodeDrawingTool || this.tool instanceof ConnectorDrawingTool || this.tool instanceof MoveTool || this.tool instanceof ResizeTool || this.tool instanceof SelectTool) && this.inAction) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var diagram_1 = this;\n        var delay_1 = 100;\n\n        if (this.diagram.scrollSettings.canAutoScroll && autoScrollPosition && !this.doingAutoScroll) {\n          this.doingAutoScroll = true;\n          this.timeOutValue = setInterval(function (args) {\n            diagram_1.doAutoScroll(autoScrollPosition, e, delay_1);\n          }, delay_1);\n        }\n      }\n    } else {\n      this.blocked = !this.tool.mouseMove(this.eventArgs);\n    }\n  };\n  /* tslint:disable */\n\n  /** @private */\n\n\n  DiagramEventHandler.prototype.mouseUp = function (evt) {\n    this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseUp);\n\n    if (this.diagram.mode === 'SVG' && canVitualize(this.diagram)) {\n      this.updateVirtualization();\n    }\n\n    this.diagram.previousSelectedObject = null;\n    this.diagram.diagramRenderer.rendererActions = this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions, RendererAction.DrawSelectorBorder);\n    var touches = evt.touches;\n\n    if (this.isScrolling) {\n      this.isScrolling = false;\n      evt.preventDefault();\n      return;\n    }\n\n    if (!this.checkEditBoxAsTarget(evt) && canUserInteract(this.diagram) || canZoomPan(this.diagram) && !defaultTool(this.diagram)) {\n      if (this.tool && (!(this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool) || (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool) && evt.detail === 2)) {\n        if (!this.isForeignObject(evt.target) && this.isMouseDown) {\n          document.getElementById(this.diagram.element.id + 'content').focus();\n        }\n\n        if (!this.inAction && evt.which !== 3) {\n          if (this.action === 'Drag') {\n            this.action = 'Select';\n            var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n            var obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n            var isMultipleSelect = true;\n\n            if (!evt.ctrlKey && this.isMouseDown && this.diagram.selectedItems.nodes.length + this.diagram.selectedItems.connectors.length > 1 && evt.which === 1 && !canPreventClearSelection(this.diagram.diagramActions)) {\n              isMultipleSelect = false;\n              this.commandHandler.clearSelection();\n            }\n\n            if (!isSelected(this.diagram, obj) || !isMultipleSelect) {\n              this.commandHandler.selectObjects([obj]);\n            }\n          }\n        }\n\n        var avoidDropChildren = false;\n        var history_1 = this.updateContainerProperties();\n        var isGroupAction = void 0;\n        this.addUmlNode();\n        this.inAction = false;\n        this.isMouseDown = false;\n        this.currentPosition = this.getMousePosition(evt);\n\n        if (this.diagram.selectedObject.helperObject) {\n          isGroupAction = this.updateContainerBounds();\n        }\n\n        if (this.tool && (this.tool.prevPosition || this.tool instanceof LabelTool)) {\n          this.eventArgs.position = this.currentPosition;\n          var padding = this.getConnectorPadding(this.eventArgs);\n          this.getMouseEventArgs(this.currentPosition, this.eventArgs, this.eventArgs.source, padding);\n          var ctrlKey = this.isMetaKey(evt);\n\n          if (ctrlKey || evt.shiftKey) {\n            var info = ctrlKey && evt.shiftKey ? {\n              ctrlKey: ctrlKey,\n              shiftKey: evt.shiftKey\n            } : {\n              ctrlKey: true\n            };\n            this.eventArgs.info = info;\n          }\n\n          if (this.diagram.diagramActions & DiagramAction.Interactions) {\n            this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.Interactions;\n          }\n\n          this.eventArgs.clickCount = evt.detail;\n\n          if (this.diagram.selectedObject.helperObject && (this.tool instanceof MoveTool || this.tool instanceof ResizeTool)) {\n            if (this.diagram.selectedObject.actualObject && this.diagram.selectedObject.actualObject.parentId !== '') {\n              var parentNode = this.diagram.getObject(this.diagram.selectedObject.actualObject.parentId);\n\n              if (parentNode && parentNode.isLane) {\n                this.commandHandler.isContainer = true;\n              }\n            }\n\n            avoidDropChildren = this.diagram.lineRoutingModule && this.diagram.nameTable[\"helper\"] && this.eventArgs.target && this.eventArgs.target.isLane && (this.eventArgs.source instanceof Selector && this.eventArgs.source.nodes.length > 0 && this.eventArgs.source.nodes[0].parentId === \"\" || this.eventArgs.source.parentId === \"\");\n\n            if (avoidDropChildren) {\n              this.diagram.diagramActions = this.diagram.diagramActions | DiagramAction.PreventLaneContainerUpdate;\n            }\n\n            this.tool.mouseUp(this.eventArgs, history_1.isPreventHistory);\n          } else {\n            this.tool.mouseUp(this.eventArgs);\n\n            if (this.diagram.checkMenu && (window.navigator.userAgent.indexOf('Linux') !== -1 || window.navigator.userAgent.indexOf('X11') !== -1)) {\n              this.diagram.contextMenuModule.contextMenu.open(evt.pageY, evt.pageX, this.diagram.element);\n              this.diagram.checkMenu = false;\n            }\n          }\n\n          if (history_1.hasStack) {\n            this.diagram.endGroupAction();\n          }\n        }\n\n        if (isGroupAction) {\n          this.diagram.endGroupAction();\n        }\n\n        this.updateContainerBounds(true);\n\n        if (this.eventArgs.clickCount !== 2) {\n          this.commandHandler.updateSelectedNodeProperties(this.eventArgs.source);\n\n          if (avoidDropChildren) {\n            this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.PreventLaneContainerUpdate;\n            var nodes = this.eventArgs.source instanceof Selector ? this.eventArgs.source.nodes : [this.eventArgs.source];\n\n            if (nodes) {\n              for (var i = 0; i < nodes.length; i++) {\n                if (!nodes[i].container) {\n                  this.commandHandler.dropChildToContainer(this.eventArgs.target, nodes[i]);\n                  this.commandHandler.renderContainerHelper(nodes[i]);\n                }\n              }\n            }\n          }\n        }\n\n        if (this.diagram.selectedObject && this.diagram.selectedObject.helperObject) {\n          this.diagram.remove(this.diagram.selectedObject.helperObject);\n          this.diagram.selectedObject = {\n            helperObject: undefined,\n            actualObject: undefined\n          }; // EJ2-42605 - Annotation undo redo not working properly if the line routing is enabled committed by sivakumar sekar\n          // committed to remove the diagram actions public method when line routing is enabled\n          // eslint-disable-next-line\n\n          if (this.diagram.diagramActions & DiagramAction.PublicMethod && this.diagram.constraints & DiagramConstraints.LineRouting) {\n            this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.PublicMethod;\n          }\n        }\n\n        this.blocked = false;\n\n        if (this.hoverElement) {\n          var portVisibility = PortVisibility.Connect;\n\n          if (isSelected(this.diagram, this.hoverElement)) {\n            portVisibility |= PortVisibility.Hover;\n          }\n\n          this.diagram.updatePortVisibility(this.hoverElement, portVisibility, true);\n          this.hoverElement = null;\n        }\n\n        this.touchStartList = null;\n        this.touchMoveList = null;\n\n        if (!(this.tool instanceof TextDrawingTool)) {\n          this.tool = null;\n        }\n      }\n\n      if (!touches) {\n        evt.preventDefault();\n      }\n\n      this.diagram.currentDrawingObject = undefined;\n      var selector = this.diagram.selectedItems;\n      var disbleRenderSelector = false;\n\n      if (this.commandHandler.isUserHandle(this.currentPosition)) {\n        if (this.isForeignObject(evt.target)) {\n          disbleRenderSelector = true;\n        }\n      }\n\n      if (!this.inAction && selector.wrapper && selector.userHandles.length > 0 && !disbleRenderSelector) {\n        this.diagram.renderSelector(true);\n      }\n\n      if (!this.inAction && !this.diagram.currentSymbol && this.eventArgs) {\n        var arg = {\n          element: cloneBlazorObject(this.eventArgs.source) || cloneBlazorObject(this.diagram),\n          position: cloneBlazorObject(this.eventArgs.position),\n          count: evt.detail,\n          actualObject: cloneBlazorObject(this.eventArgs.actualObject),\n          button: evt.button === 0 ? 'Left' : evt.button === 1 ? 'Middle' : 'Right'\n        };\n\n        if (isBlazor() && this.diagram.click) {\n          arg = this.getBlazorClickEventArgs(arg);\n        }\n\n        if (this.diagram.tool !== DiagramTools.ZoomPan) {\n          this.diagram.triggerEvent(DiagramEvent.click, arg);\n        }\n      }\n\n      this.eventArgs = {};\n    }\n\n    this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.PreventLaneContainerUpdate;\n    this.eventArgs = {};\n    this.diagram.commandHandler.removeStackHighlighter(); // end the corresponding tool\n  };\n  /* tslint:enable */\n\n\n  DiagramEventHandler.prototype.getConnectorPadding = function (eventArgs) {\n    var padding;\n    var targetObject = eventArgs.source;\n\n    if (targetObject && targetObject instanceof Selector && targetObject.connectors.length) {\n      var selectedConnector = targetObject.connectors[0];\n      padding = selectedConnector.constraints & ConnectorConstraints.ConnectToNearByPort ? selectedConnector.connectionPadding : 0;\n    }\n\n    return padding || 0;\n  };\n\n  DiagramEventHandler.prototype.getBlazorClickEventArgs = function (arg) {\n    arg = {\n      element: this.eventArgs.source ? {\n        selector: cloneBlazorObject(this.eventArgs.source)\n      } : {\n        diagram: cloneBlazorObject(this.diagram)\n      },\n      position: cloneBlazorObject(this.eventArgs.position),\n      count: arg.count,\n      actualObject: this.eventArgs.actualObject ? {\n        selector: cloneBlazorObject(this.eventArgs.actualObject)\n      } : {\n        diagram: cloneBlazorObject(this.diagram)\n      },\n      button: arg.button\n    };\n\n    if (this.eventArgs.source instanceof Node) {\n      arg.element.selector.nodes = [];\n      arg.element.selector.nodes.push(cloneBlazorObject(this.eventArgs.source));\n    } else if (this.eventArgs.source instanceof Connector) {\n      arg.element.selector.connectors = [];\n      arg.element.selector.connectors.push(cloneBlazorObject(this.eventArgs.source));\n    }\n\n    return arg;\n  };\n\n  DiagramEventHandler.prototype.addSwimLaneObject = function (selectedNode) {\n    var swimlaneNode;\n    var targetNode;\n    var shape;\n    var value;\n    var canInsert;\n    var index = 0;\n    var offset;\n    var actualShape = selectedNode.shape;\n    var objects = this.objectFinder.findObjectsUnderMouse(this.currentPosition, this.diagram, this.eventArgs, null, this.action);\n\n    if (!targetNode) {\n      targetNode = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n    }\n\n    this.diagram.clearSelectorLayer();\n\n    if (targetNode && !(targetNode.isLane || targetNode.isPhase || targetNode.isHeader)) {\n      for (var i = 0; i < objects.length; i++) {\n        var laneNode = this.diagram.nameTable[objects[i].id];\n\n        if (laneNode.isLane || laneNode.isPhase || laneNode.isHeader) {\n          targetNode = laneNode;\n        }\n      }\n    }\n\n    if (targetNode && (actualShape.isPhase || actualShape.isLane && targetNode.isLane)) {\n      var id = targetNode.parentId;\n      swimlaneNode = this.diagram.nameTable[id];\n    }\n\n    if (swimlaneNode) {\n      shape = swimlaneNode.shape;\n      canInsert = actualShape.isLane ? actualShape.orientation === shape.orientation : actualShape.orientation !== shape.orientation;\n    }\n\n    if (canInsert && targetNode) {\n      if (shape.header && shape.hasHeader && shape.orientation === 'Horizontal') {\n        index = 1;\n      }\n\n      if (shape.phases.length > 0) {\n        index += 1;\n      }\n\n      if (actualShape.isPhase) {\n        if (shape.orientation === 'Horizontal') {\n          offset = this.currentPosition.x - swimlaneNode.wrapper.bounds.x;\n        } else {\n          offset = this.currentPosition.y - (swimlaneNode.wrapper.bounds.y + shape.header.height);\n        }\n\n        var phases = {\n          id: randomId(),\n          offset: offset,\n          header: {\n            annotation: {\n              content: 'Phase'\n            }\n          }\n        };\n        this.diagram.addPhases(swimlaneNode, [phases]);\n      } else {\n        //const laneHeight: number = actualShape.lanes[0].header.height;\n        var lane = {\n          id: randomId(),\n          style: actualShape.lanes[0].style,\n          header: {\n            annotation: {\n              content: actualShape.lanes[0].header.annotation.content,\n              style: actualShape.lanes[0].header.annotation.style\n            },\n            style: actualShape.lanes[0].header.style\n          }\n        };\n        var orientation_1 = actualShape.orientation === 'Horizontal' ? true : false; // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\n        orientation_1 ? lane.height = actualShape.lanes[0].height : lane.width = actualShape.lanes[0].width;\n\n        if (shape.orientation === 'Horizontal') {\n          value = targetNode.rowIndex ? targetNode.rowIndex : this.diagram.nameTable[targetNode.parentId].rowIndex;\n\n          if (targetNode.wrapper.offsetY < this.currentPosition.y) {\n            value += 1;\n          }\n        } else {\n          value = targetNode.columnIndex ? targetNode.columnIndex : this.diagram.nameTable[targetNode.parentId].columnIndex;\n\n          if (this.currentPosition.x < targetNode.wrapper.bounds.center.x) {\n            value -= 1;\n          }\n        }\n\n        if (shape.lanes.length > value - index) {\n          lane.header.width = shape.lanes[value - index].header.width;\n          lane.header.height = shape.lanes[value - index].header.height;\n        } else {\n          lane.header.width = shape.lanes[value - index - 1].header.width;\n          lane.header.height = shape.lanes[value - index - 1].header.height;\n        }\n\n        this.diagram.addLanes(swimlaneNode, [lane], value - index);\n      }\n\n      this.commandHandler.select(swimlaneNode);\n    } else if (actualShape.isLane) {\n      var swimLaneobj = {\n        id: randomId(),\n        width: selectedNode.width,\n        height: selectedNode.height,\n        addInfo: selectedNode.addInfo,\n        shape: {\n          type: 'SwimLane',\n          header: {\n            annotation: {\n              content: 'Header'\n            },\n            height: 50,\n            style: actualShape.lanes[0].header.style\n          },\n          phases: [{\n            id: randomId(),\n            header: {\n              annotation: {\n                content: 'Phase'\n              }\n            }\n          }],\n          lanes: [{\n            id: randomId(),\n            height: selectedNode.height,\n            width: selectedNode.width,\n            style: actualShape.lanes[0].style,\n            header: {\n              annotation: {\n                content: actualShape.lanes[0].header.annotation.content,\n                style: actualShape.lanes[0].header.annotation.style\n              },\n              style: actualShape.lanes[0].header.style\n            }\n          }],\n          orientation: actualShape.orientation\n        }\n      };\n\n      if (actualShape.orientation === 'Vertical') {\n        swimLaneobj.width += 20;\n      }\n\n      swimLaneobj.offsetX = this.currentPosition.x + swimLaneobj.width / 2;\n      swimLaneobj.offsetY = this.currentPosition.y + swimLaneobj.height / 2;\n      this.diagram.add(swimLaneobj);\n    }\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.mouseLeave = function (evt) {\n    //Define what has to happen on mouse leave\n    if (this.tool && this.inAction) {\n      this.tool.mouseLeave(this.eventArgs);\n    }\n\n    if (this.diagram.selectedObject.helperObject) {\n      this.updateContainerProperties();\n      var isGroupAction = this.updateContainerBounds();\n\n      if (isGroupAction) {\n        this.diagram.endGroupAction();\n      }\n    }\n\n    if (this.eventArgs && this.eventArgs.source) {\n      this.diagram.updatePortVisibility(this.eventArgs.source, PortVisibility.Hover, true);\n      this.hoverElement = null;\n    }\n\n    if (this.eventArgs && !this.eventArgs.source && this.hoverElement) {\n      this.hoverElement = null;\n    }\n\n    if (this.tool instanceof ConnectTool && this.eventArgs && this.eventArgs.target && this.eventArgs.target instanceof Node) {\n      this.diagram.updatePortVisibility(this.eventArgs.target, PortVisibility.Hover | PortVisibility.Connect, true);\n      this.hoverElement = null;\n    }\n\n    var selector = this.diagram.selectedItems;\n\n    if (selector && selector.wrapper) {\n      this.diagram.renderSelector(true);\n    }\n\n    if (this.diagram.diagramActions & DiagramAction.Interactions || this.diagram.diagramActions & DiagramAction.ToolAction) {\n      this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.ToolAction;\n    }\n\n    this.isMouseDown = false;\n    this.focus = false;\n    this.touchStartList = null;\n    this.touchMoveList = null;\n    this.elementLeave();\n    this.commandHandler.removeSnap();\n    this.inAction = false;\n    this.eventArgs = {};\n\n    if (this.diagram.selectedObject && this.diagram.selectedObject.helperObject) {\n      this.diagram.remove(this.diagram.selectedObject.helperObject);\n      this.diagram.selectedObject = {\n        helperObject: undefined,\n        actualObject: undefined\n      };\n    }\n\n    this.tool = null;\n    removeRulerMarkers();\n\n    if (this.action === 'Rotate') {\n      this.diagram.diagramCanvas.classList.remove('e-diagram-rotate');\n    }\n\n    evt.preventDefault();\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.mouseWheel = function (evt) {\n    this.diagram.blazorActions |= BlazorAction.interaction; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var up = evt.wheelDelta > 0 || -40 * evt.detail > 0 ? true : false;\n    var mousePosition = this.getMousePosition(evt);\n    this.diagram.tooltipObject.close();\n    var ctrlKey = this.isMetaKey(evt);\n\n    if (ctrlKey) {\n      this.diagram.zoom(up ? 1.2 : 1 / 1.2, mousePosition);\n      evt.preventDefault();\n    } else {\n      var horizontalOffset = this.diagram.scroller.horizontalOffset;\n      var verticalOffset = this.diagram.scroller.verticalOffset;\n      var change = up ? 20 : -20;\n\n      if (this.tool && (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool)) {\n        this.eventArgs = {};\n        this.getMouseEventArgs(mousePosition, this.eventArgs);\n        this.eventArgs.position = mousePosition;\n        this.tool.mouseWheel(this.eventArgs);\n      }\n\n      this.diagram.scrollActions |= ScrollActions.Interaction;\n\n      if (evt.shiftKey) {\n        this.diagram.scroller.zoom(1, change, 0, mousePosition);\n      } else {\n        this.diagram.scroller.zoom(1, 0, change, mousePosition);\n      }\n\n      this.diagram.scrollActions &= ~ScrollActions.Interaction;\n\n      if (horizontalOffset !== this.diagram.scroller.horizontalOffset || verticalOffset !== this.diagram.scroller.verticalOffset) {\n        evt.preventDefault();\n      }\n    }\n\n    if (this.diagram.textEditing) {\n      this.diagram.isTriggerEvent = true;\n\n      if (this.diagram.activeLabel.parentId) {\n        var node = this.diagram.getObject(this.diagram.activeLabel.parentId);\n        this.diagram.startTextEdit(node, this.diagram.activeLabel.id);\n      }\n\n      this.diagram.isTriggerEvent = false;\n    }\n\n    this.diagram.blazorActions = this.diagram.blazorActions & ~BlazorAction.interaction;\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.keyDown = function (evt) {\n    if (!(this.diagram.diagramActions & DiagramAction.TextEdit) && !this.checkEditBoxAsTarget(evt) || evt.key === 'Escape' || evt.keyCode === 27) {\n      var i = void 0;\n      var inAction = 'inAction';\n      var command = void 0;\n      var keycode = evt.keyCode ? evt.keyCode : evt.which;\n      var key = evt.key;\n      var ctrlKey = this.isMetaKey(evt);\n\n      if (this.diagram.commandManager && this.diagram.commands) {\n        var commands = this.diagram.commands;\n\n        for (var _i = 0, _a = Object.keys(commands); _i < _a.length; _i++) {\n          var i_1 = _a[_i];\n          command = this.diagram.commands[i_1];\n\n          if (command && (command.gesture.keyModifiers || command.gesture.key)) {\n            if ((keycode === command.gesture.key || key === Keys[command.gesture.key] || this.isDeleteKey(key, i_1)) && (!command.gesture.keyModifiers && !evt.altKey && !evt.shiftKey && !ctrlKey || command.gesture.keyModifiers && (ctrlKey || evt.altKey || evt.shiftKey) && this.altKeyPressed(command.gesture.keyModifiers) && evt.altKey || this.shiftKeyPressed(command.gesture.keyModifiers) && evt.shiftKey || this.ctrlKeyPressed(command.gesture.keyModifiers) && ctrlKey)) {\n              var canExecute = getFunction(command.canExecute);\n\n              if (isBlazor() || canExecute && canExecute({\n                'keyDownEventArgs': KeyboardEvent,\n                parameter: command.parameter\n              })) {\n                evt.preventDefault();\n\n                if (evt.key === 'Escape') {\n                  if (this.checkEditBoxAsTarget(evt)) {\n                    document.getElementById(this.diagram.diagramCanvas.id).focus();\n                  } else if (this.diagram.currentSymbol) {\n                    var selectedSymbols = 'selectedSymbols';\n                    var source = 'sourceElement';\n                    var intDestroy = 'intDestroy';\n                    this.diagram.removeFromAQuad(this.diagram.currentSymbol);\n                    this.diagram.removeObjectsFromLayer(this.diagram.nameTable[this.diagram.currentSymbol.id]);\n                    this.diagram.removeElements(this.diagram.currentSymbol);\n                    removeChildNodes(this.diagram.currentSymbol, this.diagram);\n                    delete this.diagram.nameTable[this.diagram.currentSymbol.id];\n                    var sourceElement = this.diagram.droppable[source];\n                    sourceElement.draggable[intDestroy]();\n                    var element = this.diagram.droppable[selectedSymbols];\n                    element.parentNode.removeChild(element);\n                    var diagramActions = this.diagram.diagramActions;\n                    this.diagram.diagramActions = this.diagram.addConstraints(diagramActions, DiagramAction.PreventClearSelection);\n                    this.tool.mouseUp(this.eventArgs);\n                    this.diagram.diagramRenderer.rendererActions = this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions, RendererAction.DrawSelectorBorder);\n\n                    if (this.diagram.previousSelectedObject) {\n                      this.diagram.select(this.diagram.previousSelectedObject);\n                    }\n\n                    this.action = 'Select';\n                    this.diagram.previousSelectedObject = null;\n                    this.diagram.currentSymbol = null;\n                    this.diagram.diagramActions = this.diagram.removeConstraints(diagramActions, DiagramAction.PreventClearSelection);\n                    this.isMouseDown = false;\n                  } else if (this.inAction && this.diagram.drawingObject && this.tool && this.tool[inAction]) {\n                    this.tool.mouseUp(this.eventArgs);\n                    this.tool = null;\n                    this.isMouseDown = false;\n                  }\n                }\n\n                if (command.execute) {\n                  if (this.diagram.tool !== DiagramTools.ZoomPan) {\n                    // if (i === 'nudgeUp' || i === 'nudgeRight' || i === 'nudgeDown' || i === 'nudgeLeft') {\n                    //     command.execute()\n                    // } else {\n                    var execute = getFunction(command.execute);\n                    execute({\n                      'keyDownEventArgs': KeyboardEvent,\n                      parameter: command.parameter\n                    });\n                  } // }\n\n                }\n\n                if (isBlazor()) {\n                  var arg = {\n                    gesture: command.gesture\n                  };\n                  this.diagram.triggerEvent(DiagramEvent.commandExecute, arg);\n                }\n\n                break;\n              }\n            }\n          }\n        }\n      }\n    } // eslint-disable-next-line\n\n\n    var selectedObject = this.diagram.selectedItems.nodes.length ? this.diagram.selectedItems.nodes : this.diagram.selectedItems.connectors;\n    this.keyArgs = {\n      element: cloneBlazorObject(this.diagram.selectedItems),\n      key: evt.key,\n      keyCode: evt.keyCode ? evt.keyCode : evt.which\n    };\n    this.getKeyModifier(this.keyArgs, evt);\n\n    if (this.diagram.diagramActions & DiagramAction.TextEdit) {\n      this.getlabel(this.keyArgs, evt);\n    }\n\n    this.diagram.triggerEvent(DiagramEvent.keyDown, this.keyArgs);\n  };\n\n  DiagramEventHandler.prototype.getlabel = function (args, evt) {\n    var label = this.diagram.activeLabel;\n    args.target = this.diagram.element.id + '_editBox';\n    var node = this.diagram.nameTable[label.parentId];\n\n    if (document.getElementById(this.diagram.element.id + '_editBox')) {\n      args.text = document.getElementById(this.diagram.element.id + '_editBox').value;\n\n      for (var i = 0; i < node.annotations.length; i++) {\n        if (node.annotations[i].id === label.id) {\n          args.label = node.annotations[i];\n          break;\n        }\n      }\n    }\n  };\n\n  DiagramEventHandler.prototype.getKeyModifier = function (args, evt) {\n    args.keyModifiers = KeyModifiers.None;\n\n    if (evt.ctrlKey) {\n      args.keyModifiers |= KeyModifiers.Control;\n    }\n\n    if (evt.shiftKey) {\n      args.keyModifiers |= KeyModifiers.Shift;\n    }\n\n    if (evt.altKey) {\n      args.keyModifiers |= KeyModifiers.Alt;\n    }\n\n    if (this.isMetaKey(evt)) {\n      args.keyModifiers |= KeyModifiers.Meta;\n    }\n  };\n\n  DiagramEventHandler.prototype.keyUp = function (evt) {\n    this.keyArgs = {\n      element: cloneBlazorObject(this.diagram.selectedItems),\n      key: evt.key,\n      keyCode: evt.keyCode ? evt.keyCode : evt.which\n    };\n    var selectedObject = this.diagram.selectedItems.nodes.length ? this.diagram.selectedItems.nodes : this.diagram.selectedItems.connectors;\n    this.getKeyModifier(this.keyArgs, evt);\n\n    if (this.diagram.diagramActions & DiagramAction.TextEdit) {\n      this.getlabel(this.keyArgs, evt);\n    }\n\n    this.diagram.triggerEvent(DiagramEvent.keyUp, this.keyArgs);\n  };\n\n  DiagramEventHandler.prototype.startAutoScroll = function (e) {\n    var position = this.getMousePosition(e);\n    position.x *= this.diagram.scroller.currentZoom;\n    position.y *= this.diagram.scroller.currentZoom;\n    var rulerSize = getRulerSize(this.diagram);\n    var movingPosition;\n    var autoScrollBorder = this.diagram.scrollSettings.autoScrollBorder;\n\n    if (Browser.info.name === 'mozilla') {\n      if (this.diagram.scroller.viewPortWidth === 0) {\n        var bounds = document.getElementById(this.diagram.element.id).getBoundingClientRect();\n\n        if (bounds.width !== this.diagram.scroller.viewPortWidth) {\n          this.diagram.scroller.setViewPortSize(bounds.width, bounds.height);\n        }\n      }\n    }\n\n    if (this.diagram.scrollSettings.canAutoScroll) {\n      if (position.x + this.diagram.scroller.horizontalOffset + autoScrollBorder.right + rulerSize.width >= this.diagram.scroller.viewPortWidth - 18) {\n        movingPosition = 'right';\n      } else if (position.x + this.diagram.scroller.horizontalOffset < autoScrollBorder.left) {\n        movingPosition = 'left';\n      } else if (position.y + this.diagram.scroller.verticalOffset + autoScrollBorder.bottom + rulerSize.height > this.diagram.scroller.viewPortHeight - 18) {\n        movingPosition = 'bottom';\n      } else if (position.y + this.diagram.scroller.verticalOffset < autoScrollBorder.top) {\n        movingPosition = 'top';\n      }\n    }\n\n    return movingPosition;\n  };\n\n  DiagramEventHandler.prototype.doAutoScroll = function (option, e, delay, autoScroll) {\n    var position = option;\n\n    if ((this.tool instanceof NodeDrawingTool || this.tool instanceof ConnectorDrawingTool || this.tool instanceof MoveTool || this.tool instanceof ResizeTool || this.tool instanceof SelectTool) && this.inAction) {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var diagram = this;\n      var pos = this.getMousePosition(e);\n      var autoScrollBorder = this.diagram.scrollSettings.autoScrollBorder;\n      var newDelay = delay ? delay : 100;\n      var left = 0;\n      var top_1 = 0;\n      var point = {\n        x: pos.x,\n        y: pos.y\n      };\n\n      switch (position) {\n        case 'right':\n          point.x = pos.x + 10;\n          left = 10;\n          break;\n\n        case 'left':\n          point.x = pos.x - 10;\n          left = -10;\n          break;\n\n        case 'bottom':\n          point.y = pos.y + 10;\n          top_1 = 10;\n          break;\n\n        case 'top':\n          point.y = pos.y - 10;\n          top_1 = -10;\n          break;\n      }\n\n      this.eventArgs.position = {\n        x: point.x,\n        y: point.y\n      };\n      this.currentPosition = this.eventArgs.position;\n      var objects = this.objectFinder.findObjectsUnderMouse(this.currentPosition, this.diagram, this.eventArgs, null, this.action);\n      this.eventArgs.target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n      this.tool.mouseMove(this.eventArgs);\n      this.diagram.scrollActions |= ScrollActions.Interaction;\n      this.diagram.scroller.zoom(1, -left, -top_1, pos);\n      this.diagram.scrollActions &= ~ScrollActions.Interaction;\n    }\n  };\n\n  DiagramEventHandler.prototype.mouseEvents = function () {\n    var target = this.diagram.findObjectsUnderMouse(this.currentPosition);\n\n    for (var i = 0; i < target.length; i++) {\n      if (this.eventArgs.actualObject === target[i]) {\n        target.splice(i, 1);\n      }\n    }\n\n    var arg = {\n      targets: {}\n    };\n\n    if (!isBlazor()) {\n      arg = {\n        targets: cloneBlazorObject(target),\n        element: cloneBlazorObject(this.eventArgs.source === this.eventArgs.actualObject ? undefined : this.eventArgs.source),\n        actualObject: cloneBlazorObject(this.eventArgs.actualObject)\n      };\n    }\n\n    if (isBlazor() && (this.diagram.mouseEnter || this.diagram.mouseOver)) {\n      arg.actualObject = getObjectType(this.eventArgs.actualObject) === Connector ? {\n        connector: cloneBlazorObject(this.eventArgs.actualObject)\n      } : {\n        node: cloneBlazorObject(this.eventArgs.actualObject)\n      };\n      arg.targets.connector = [];\n      arg.targets.node = [];\n      this.getBlazorCollectionObject(target, arg);\n    }\n\n    if (this.lastObjectUnderMouse && this.diagram.mouseLeave && (!this.eventArgs.actualObject || this.lastObjectUnderMouse !== this.eventArgs.actualObject)) {\n      var arg_1 = {\n        targets: undefined,\n        element: cloneBlazorObject(this.lastObjectUnderMouse),\n        actualObject: undefined\n      };\n\n      if (isBlazor()) {\n        arg_1 = {\n          targets: undefined,\n          element: getObjectType(this.lastObjectUnderMouse) === Connector ? {\n            connector: cloneBlazorObject(target)\n          } : {\n            node: cloneBlazorObject(this.lastObjectUnderMouse)\n          },\n          actualObject: undefined\n        };\n      }\n\n      this.diagram.triggerEvent(DiagramEvent.mouseLeave, arg_1);\n      this.lastObjectUnderMouse = null;\n    }\n\n    if (!this.lastObjectUnderMouse && this.eventArgs.source || this.lastObjectUnderMouse !== this.eventArgs.actualObject) {\n      this.lastObjectUnderMouse = this.eventArgs.actualObject;\n\n      if (this.eventArgs.actualObject !== undefined) {\n        this.diagram.triggerEvent(DiagramEvent.mouseEnter, arg);\n      }\n    }\n\n    if (this.eventArgs.actualObject) {\n      this.diagram.triggerEvent(DiagramEvent.mouseOver, arg);\n    }\n  };\n\n  DiagramEventHandler.prototype.getBlazorCollectionObject = function (obj, arg1) {\n    if (obj) {\n      for (var i = 0; i < obj.length; i++) {\n        if (getObjectType(obj[i]) === Connector) {\n          arg1.targets.connector.push(cloneBlazorObject(obj[i]));\n        } else {\n          arg1.targets.node.push(cloneBlazorObject(obj[i]));\n        }\n      }\n    }\n  };\n\n  DiagramEventHandler.prototype.elementEnter = function (mousePosition, elementOver) {\n    if (!elementOver) {\n      var isPrivateTooltip = this.hoverElement instanceof Node && this.hoverElement.constraints & NodeConstraints.Tooltip || this.hoverElement instanceof Connector && this.hoverElement.constraints & ConnectorConstraints.Tooltip;\n      var content = this.getContent();\n\n      if (this.hoverElement.tooltip.openOn === 'Auto' && content !== '') {\n        updateTooltip(this.diagram, isPrivateTooltip ? this.hoverElement : undefined);\n      }\n\n      var offset = getTooltipOffset(this.diagram, mousePosition, this.hoverElement);\n\n      if (this.hoverElement.tooltip.openOn === 'Auto' && content !== '') {\n        this.diagram.tooltipObject.close();\n        this.diagram.tooltipObject.openOn = this.hoverElement.tooltip.openOn;\n        this.diagram.tooltipObject.offsetX = offset.x;\n        this.diagram.tooltipObject.offsetY = offset.y;\n\n        if (isBlazor()) {\n          this.diagram.tooltipObject.open(this.diagram.element, {});\n        } else {\n          this.diagram.tooltipObject.dataBind();\n        }\n      }\n\n      if (canEnableToolTip(this.hoverElement, this.diagram) && this.hoverElement.tooltip.openOn === 'Auto') {\n        this.diagram.tooltipObject.open(this.diagram.element);\n      }\n    }\n  };\n\n  DiagramEventHandler.prototype.elementLeave = function () {\n    if (this.diagram.tooltipObject && this.diagram.tooltipObject.openOn !== 'Custom') {\n      this.diagram.tooltipObject.close();\n    }\n  };\n\n  DiagramEventHandler.prototype.altKeyPressed = function (keyModifier) {\n    if (keyModifier & KeyModifiers.Alt) {\n      return true;\n    }\n\n    return false;\n  };\n\n  DiagramEventHandler.prototype.ctrlKeyPressed = function (keyModifier) {\n    if (keyModifier & KeyModifiers.Control) {\n      return true;\n    }\n\n    return false;\n  };\n\n  DiagramEventHandler.prototype.shiftKeyPressed = function (keyModifier) {\n    if (keyModifier & KeyModifiers.Shift) {\n      return true;\n    }\n\n    return false;\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.scrolled = function (evt) {\n    this.diagram.updateScrollOffset();\n\n    if (isBlazor() && this.diagram.realActions & RealAction.OverViewAction) {\n      this.diagram.setBlazorDiagramProps(false);\n    }\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.doubleClick = function (evt) {\n    if (canUserInteract(this.diagram)) {\n      var annotation = void 0;\n      var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n      var obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n\n      if (obj !== null && canUserInteract(this.diagram)) {\n        var node = obj;\n        annotation = this.diagram.findElementUnderMouse(obj, this.currentPosition);\n\n        if (this.tool && (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool)) {\n          var arg_2 = {\n            source: cloneBlazorObject(obj) || cloneBlazorObject(this.diagram),\n            position: this.currentPosition,\n            count: evt.detail\n          };\n          this.tool.mouseUp(this.eventArgs);\n          this.isMouseDown = false;\n          this.eventArgs = {};\n          this.tool = null;\n          evt.preventDefault();\n        } else {\n          var layer = this.diagram.commandHandler.getObjectLayer(obj.id);\n\n          if (layer && !layer.lock && layer.visible) {\n            if (!(this.diagram.diagramActions & DiagramAction.TextEdit)) {\n              var id = '';\n\n              if (obj.shape.shape === 'TextAnnotation') {\n                id = obj.wrapper.children[1].id.split('_')[1];\n              }\n\n              this.diagram.startTextEdit(obj, id || (annotation instanceof TextElement ? annotation.id.split(obj.id + '_')[1] : undefined));\n            }\n          }\n        }\n      }\n\n      var arg = {\n        source: cloneBlazorObject(obj) || cloneBlazorObject(this.diagram),\n        position: this.currentPosition,\n        count: evt.detail\n      };\n\n      if (isBlazor()) {\n        var selector = void 0;\n\n        if (obj instanceof Node) {\n          selector = {\n            nodes: [cloneBlazorObject(obj)]\n          };\n        } else if (obj instanceof Connector) {\n          selector = {\n            connectors: [cloneBlazorObject(obj)]\n          };\n        } else {\n          selector = cloneBlazorObject(obj);\n        }\n\n        arg = {\n          source: obj ? {\n            selector: selector\n          } : {\n            diagram: cloneBlazorObject(this.diagram)\n          },\n          position: this.currentPosition,\n          count: evt.detail\n        };\n      }\n\n      this.diagram.triggerEvent(DiagramEvent.doubleClick, arg);\n    }\n  };\n  /**\n   * @private\n   */\n\n\n  DiagramEventHandler.prototype.itemClick = function (actualTarget, diagram) {\n    var obj = actualTarget;\n\n    if (checkParentAsContainer(this.diagram, obj, true)) {\n      return obj;\n    }\n\n    return null;\n  };\n  /**\n   * @private\n   */\n\n\n  DiagramEventHandler.prototype.inputChange = function (evt) {\n    var minWidth = 90;\n    var maxWidth;\n    var minHeight = 12;\n    var fontsize;\n    var textWrapper;\n    var node;\n    var height;\n    var width;\n    var textBounds;\n    var textBoxWidth;\n    var transforms;\n    var scale;\n    var editTextBox = document.getElementById(this.diagram.element.id + '_editBox');\n    var editTextBoxDiv = document.getElementById(this.diagram.element.id + '_editTextBoxDiv');\n    var text = editTextBox.value;\n    var line = text.split('\\n');\n    node = this.diagram.selectedItems.nodes[0] ? this.diagram.selectedItems.nodes[0] : this.diagram.selectedItems.connectors[0];\n\n    if (!node && this.tool instanceof TextDrawingTool || node && node.shape.type === 'SwimLane') {\n      node = this.diagram.nameTable[this.diagram.activeLabel.parentId];\n    }\n\n    if (node && (node.shape.type !== 'Text' && node.annotations.length > 0 || node.shape.type === 'Text')) {\n      textWrapper = this.diagram.getWrapper(node.wrapper, this.diagram.activeLabel.id);\n      maxWidth = node.wrapper.bounds.width < textWrapper.bounds.width ? node.wrapper.bounds.width : textWrapper.bounds.width;\n      maxWidth = maxWidth > minWidth ? maxWidth : minWidth;\n      textBounds = measureHtmlText(textWrapper.style, text, undefined, undefined, maxWidth);\n      fontsize = Number(editTextBox.style.fontSize.split('px')[0]);\n\n      if (line.length > 1 && line[line.length - 1] === '') {\n        textBounds.height = textBounds.height + fontsize;\n      }\n\n      transforms = this.diagram.scroller.transform;\n      scale = canZoomTextEdit(this.diagram) ? transforms.scale : 1;\n      width = textBounds.width;\n      width = (minWidth > width ? minWidth : width) * scale;\n      height = (minHeight > textBounds.height ? minHeight : textBounds.height) * scale;\n      editTextBoxDiv.style.left = (textWrapper.bounds.center.x + transforms.tx) * transforms.scale - width / 2 - 2.5 + 'px';\n      editTextBoxDiv.style.top = (textWrapper.bounds.center.y + transforms.ty) * transforms.scale - height / 2 - 3 + 'px';\n      editTextBoxDiv.style.width = width + 'px';\n      editTextBoxDiv.style.height = height + 'px';\n      editTextBox.style.minHeight = minHeight + 'px';\n      editTextBox.style.minWidth = minWidth + 'px';\n      editTextBox.style.width = width + 'px';\n      editTextBox.style.height = height + 'px';\n    }\n  };\n  /**\n   * @private\n   */\n\n\n  DiagramEventHandler.prototype.isAddTextNode = function (node, focusOut) {\n    if (this.tool instanceof TextDrawingTool || focusOut) {\n      this.tool = null;\n\n      if (node && !canContinuousDraw(this.diagram)) {\n        this.diagram.drawingObject = undefined;\n        this.diagram.currentDrawingObject = undefined;\n      }\n\n      if (getObjectFromCollection(this.diagram.nodes, node.id) || getObjectFromCollection(this.diagram.connectors, node.id) || this.diagram.bpmnModule && this.diagram.bpmnModule.textAnnotationConnectors.indexOf(node) > -1) {\n        return false;\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n\n  DiagramEventHandler.prototype.checkEditBoxAsTarget = function (evt) {\n    if (evt.target && evt.target.id === this.diagram.element.id + '_editBox') {\n      return true;\n    }\n\n    return false;\n  };\n\n  DiagramEventHandler.prototype.getMouseEventArgs = function (position, args, source, padding) {\n    args.position = position;\n    var obj;\n    var objects;\n\n    if (!source) {\n      if (this.action === 'Drag' || this.action === 'ConnectorSourceEnd' || this.action === 'SegmentEnd' || this.action === 'OrthoThumb' || this.action === 'BezierSourceThumb' || this.action === 'BezierTargetThumb' || this.action === 'ConnectorTargetEnd' || this.action.indexOf('Rotate') !== -1 || this.action.indexOf('Resize') !== -1) {\n        obj = this.diagram.selectedItems;\n\n        if (!this.diagram.currentSymbol && this.action === 'Drag' && obj && this.diagram.selectedItems.nodes.length > 0 && this.diagram.selectedItems.nodes[0].shape.type === 'SwimLane') {\n          objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n          obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n        }\n      } else {\n        objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n        obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n      }\n    } else {\n      objects = this.diagram.findObjectsUnderMouse(this.currentPosition, source);\n      obj = this.diagram.findTargetObjectUnderMouse(objects, this.action, this.inAction, args.position, source);\n    }\n\n    if (obj && obj.isHeader) {\n      obj = this.diagram.nameTable[obj.parentId];\n      this.eventArgs.actualObject = obj;\n    }\n\n    var wrapper;\n\n    if (obj) {\n      wrapper = this.diagram.findElementUnderMouse(obj, this.currentPosition, padding);\n      var currentConnector = void 0;\n      var nearNode = void 0;\n      var i = void 0;\n\n      if ((wrapper && obj.ports && obj.ports.length && !checkPort(obj, wrapper) || !wrapper || !obj) && objects && objects.length && source instanceof Selector) {\n        currentConnector = source.connectors[0];\n\n        for (i = objects.length - 1; i >= 0; i--) {\n          nearNode = objects[i];\n\n          if (nearNode instanceof Node && currentConnector && currentConnector.connectionPadding) {\n            obj = nearNode;\n            wrapper = this.diagram.findElementUnderMouse(obj, this.currentPosition, padding);\n\n            if (currentConnector.constraints & ConnectorConstraints.ConnectToNearByPort && obj && obj.ports && obj.ports.length && checkPort(obj, wrapper)) {\n              break;\n            }\n\n            if (nearNode instanceof Node && currentConnector && currentConnector.connectionPadding && nearNode.wrapper.outerBounds.containsPoint(this.currentPosition) && currentConnector.constraints & ConnectorConstraints.ConnectToNearByNode && !(currentConnector.constraints & ConnectorConstraints.ConnectToNearByPort)) {\n              obj = nearNode;\n              wrapper = this.diagram.findElementUnderMouse(obj, this.currentPosition, 0);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    if (!source) {\n      args.source = obj;\n      args.sourceWrapper = wrapper;\n    } else {\n      args.target = obj;\n      args.targetWrapper = wrapper;\n    }\n\n    args.actualObject = this.eventArgs.actualObject;\n\n    if (args.source instanceof Selector && args.actualObject === undefined && (args.source.nodes.length > 0 || args.source.connectors.length > 0)) {\n      args.actualObject = args.source.nodes.length > 0 ? this.diagram.nameTable[args.source.nodes[0].id] : this.diagram.nameTable[args.source.connectors[0].id];\n    }\n\n    args.startTouches = this.touchStartList;\n    args.moveTouches = this.touchMoveList;\n    return args;\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.resetTool = function () {\n    this.action = 'Select';\n    this.hoverElement = null;\n    this.hoverNode = null;\n    this.tool = this.diagram.getTool(this.action);\n    this.updateCursor();\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.getTool = function (action) {\n    switch (action) {\n      case 'Select':\n        return new SelectTool(this.commandHandler, true);\n\n      case 'Drag':\n        return new MoveTool(this.commandHandler);\n\n      case 'Rotate':\n        return new RotateTool(this.commandHandler);\n\n      case 'LayoutAnimation':\n        return new ExpandTool(this.commandHandler);\n\n      case 'FixedUserHandle':\n        return new FixedUserHandleTool(this.commandHandler, true);\n\n      case 'Hyperlink':\n        return new LabelTool(this.commandHandler);\n\n      case 'ResizeSouthEast':\n      case 'ResizeSouthWest':\n      case 'ResizeNorthEast':\n      case 'ResizeNorthWest':\n      case 'ResizeSouth':\n      case 'ResizeNorth':\n      case 'ResizeWest':\n      case 'ResizeEast':\n        return new ResizeTool(this.commandHandler, action);\n\n      case 'ConnectorSourceEnd':\n      case 'ConnectorTargetEnd':\n      case 'BezierSourceThumb':\n      case 'BezierTargetThumb':\n        return new ConnectTool(this.commandHandler, action);\n\n      case 'SegmentEnd':\n      case 'OrthoThumb':\n        return new ConnectorEditing(this.commandHandler, action);\n\n      case 'Draw':\n        var shape = 'shape';\n        var basicShape = 'basicShape';\n        var type = findObjectType(this.diagram.drawingObject);\n\n        if (type === 'Node' && this.diagram.drawingObject.shape.type === 'Text') {\n          return new TextDrawingTool(this.commandHandler);\n        } else if (type === 'Node' && (this.diagram.drawingObject.shape[shape] === 'Polygon' || isBlazor() && this.diagram.drawingObject.shape[basicShape] === 'Polygon') && !this.diagram.drawingObject.shape.points) {\n          return new PolygonDrawingTool(this.commandHandler);\n        } else if (type === 'Node' || type === 'Node' && this.diagram.drawingObject.shape[shape] === 'Polygon' && this.diagram.drawingObject.shape.points) {\n          return new NodeDrawingTool(this.commandHandler, this.diagram.drawingObject);\n        } else if (type === 'Connector' && this.diagram.drawingObject.type === 'Polyline') {\n          return new PolyLineDrawingTool(this.commandHandler);\n        } else if (type === 'Connector') {\n          return new ConnectorDrawingTool(this.commandHandler, 'ConnectorSourceEnd', this.diagram.drawingObject);\n        }\n\n        break;\n\n      case 'Pan':\n        return new ZoomPanTool(this.commandHandler, false);\n\n      case 'PinchZoom':\n        return new ZoomPanTool(this.commandHandler, true);\n\n      case 'PortDrag':\n        return new MoveTool(this.commandHandler, 'Port');\n\n      case 'PortDraw':\n        return new ConnectorDrawingTool(this.commandHandler, 'ConnectorSourceEnd', this.diagram.drawingObject);\n\n      case 'LabelSelect':\n        return new SelectTool(this.commandHandler, true, 'LabelSelect');\n\n      case 'LabelDrag':\n        return new LabelDragTool(this.commandHandler);\n\n      case 'LabelResizeSouthEast':\n      case 'LabelResizeSouthWest':\n      case 'LabelResizeNorthEast':\n      case 'LabelResizeNorthWest':\n      case 'LabelResizeSouth':\n      case 'LabelResizeNorth':\n      case 'LabelResizeWest':\n      case 'LabelResizeEast':\n        return new LabelResizeTool(this.commandHandler, action);\n\n      case 'LabelRotate':\n        return new LabelRotateTool(this.commandHandler);\n      //for coverage\n      // case 'Custom':\n      //     return this.diagram.getTool(action);\n    }\n\n    return null;\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.getCursor = function (action) {\n    var object = this.diagram.selectedItems.annotation ? this.diagram.selectedItems.wrapper.children[0] : this.diagram.selectedItems;\n    var rotateAngle = this.diagram.selectedItems.annotation ? object.rotateAngle + object.parentTransform : object.rotateAngle;\n    return getCursor(action, rotateAngle);\n  }; //start region - interface betweend diagram and interaction\n\n  /** @private */\n\n\n  DiagramEventHandler.prototype.findElementUnderMouse = function (obj, position, padding) {\n    return this.objectFinder.findElementUnderSelectedItem(obj, position, padding);\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.findObjectsUnderMouse = function (position, source) {\n    return this.objectFinder.findObjectsUnderMouse(position, this.diagram, this.eventArgs, source);\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.findObjectUnderMouse = function (objects, action, inAction) {\n    return this.objectFinder.findObjectUnderMouse(this.diagram, objects, action, inAction, this.eventArgs, this.currentPosition);\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.findTargetUnderMouse = function (objects, action, inAction, position, source) {\n    return this.objectFinder.findObjectUnderMouse(this.diagram, objects, action, inAction, this.eventArgs, position, source);\n  };\n  /** @private */\n\n\n  DiagramEventHandler.prototype.findActionToBeDone = function (obj, wrapper, position, target) {\n    return findToolToActivate(obj, wrapper, this.currentPosition, this.diagram, this.touchStartList, this.touchMoveList, target);\n  };\n\n  DiagramEventHandler.prototype.updateContainerBounds = function (isAfterMouseUp) {\n    var isGroupAction = false;\n\n    if (this.diagram.selectedObject.helperObject && this.diagram.selectedObject.actualObject instanceof Node) {\n      var boundsUpdate = this.tool instanceof ResizeTool ? true : false;\n      var obj = this.diagram.selectedObject.actualObject;\n      var parentNode = this.diagram.nameTable[obj.parentId];\n\n      if (isAfterMouseUp) {\n        removeChildInContainer(this.diagram, obj, this.currentPosition, boundsUpdate);\n      } else {\n        if (!parentNode || parentNode && parentNode.shape.type !== 'SwimLane') {\n          this.diagram.updateDiagramObject(obj);\n        }\n\n        isGroupAction = updateCanvasBounds(this.diagram, obj, this.currentPosition, boundsUpdate);\n        this.diagram.updateSelector();\n\n        if (obj.isLane || obj.isPhase) {\n          this.diagram.clearSelection();\n          this.commandHandler.selectObjects([obj]);\n        }\n      }\n    }\n\n    return isGroupAction;\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  DiagramEventHandler.prototype.updateContainerProperties = function () {\n    var helperObject;\n    var isChangeProperties = false;\n    var hasStack;\n    var connectors;\n    var hasGroup = false;\n    var obj;\n    var history = {\n      hasStack: false,\n      isPreventHistory: false\n    };\n\n    if (this.diagram.selectedObject.helperObject) {\n      var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n      var target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n      helperObject = this.diagram.selectedObject.helperObject;\n      obj = this.diagram.selectedObject.actualObject;\n\n      if (obj instanceof Node) {\n        if (obj.shape.type === 'SwimLane') {\n          connectors = getConnectors(this.diagram, obj.wrapper.children[0], 0, true);\n        }\n\n        if (obj.shape.type !== 'SwimLane' && obj.parentId && this.diagram.getObject(obj.parentId).shape.type === 'SwimLane') {\n          if (target instanceof Node && this.diagram.getObject(target.parentId) && this.diagram.getObject(target.parentId).shape.type !== 'SwimLane') {\n            target = this.diagram.getObject(target.parentId);\n          }\n        }\n\n        if (this.currentAction === 'Drag' && obj.container && obj.container.type === 'Canvas' && obj.parentId && this.diagram.getObject(obj.parentId).shape.type === 'SwimLane' && target && target !== obj && target.container && target.container.type === 'Canvas' && target.isLane && obj.isLane && target.parentId === obj.parentId) {\n          laneInterChanged(this.diagram, obj, target, this.currentPosition);\n          history.isPreventHistory = true;\n        } else {\n          var parentNode = this.diagram.nameTable[obj.parentId];\n\n          if (!parentNode || parentNode && parentNode.shape.type !== 'SwimLane') {\n            if (parentNode && parentNode.isLane && obj.constraints & NodeConstraints.AllowMovingOutsideLane) {\n              var swimlane = this.diagram.getObject(parentNode.parentId);\n              var laneId = swimlane.id + swimlane.shape.lanes[0].id + '0';\n              var firstlane = this.diagram.getObject(laneId);\n              var x = firstlane.wrapper.bounds.x;\n              var y = firstlane.wrapper.bounds.y;\n              var width = swimlane.wrapper.bounds.bottomRight.x - x;\n              var height = swimlane.wrapper.bounds.bottomRight.y - y;\n              var swimlaneBounds = new Rect(x, y, width, height);\n\n              if (swimlaneBounds.containsPoint(this.currentPosition)) {\n                obj.offsetX = helperObject.offsetX;\n                obj.offsetY = helperObject.offsetY;\n                obj.width = helperObject.width;\n                obj.height = helperObject.height;\n                obj.rotateAngle = helperObject.rotateAngle;\n              }\n            } else {\n              obj.offsetX = helperObject.offsetX;\n              obj.offsetY = helperObject.offsetY;\n\n              if (obj && obj.shape && obj.shape.type !== 'UmlClassifier') {\n                if (obj.shape.type !== 'Bpmn' || obj.shape.type === 'Bpmn' && obj.shape.shape !== 'TextAnnotation') {\n                  obj.width = helperObject.width;\n                  obj.height = helperObject.height;\n                }\n              }\n\n              obj.rotateAngle = helperObject.rotateAngle;\n            }\n          }\n\n          var undoElement = void 0;\n\n          if (parentNode && parentNode.container && parentNode.container.type === 'Stack') {\n            this.diagram.startGroupAction();\n            hasGroup = true;\n          }\n\n          if (!target && parentNode && parentNode.container && parentNode.container.type === 'Stack' && this.action === 'Drag') {\n            var index = parentNode.wrapper.children.indexOf(obj.wrapper);\n            undoElement = {\n              targetIndex: undefined,\n              target: undefined,\n              sourceIndex: index,\n              source: clone(obj)\n            };\n\n            if (index > -1) {\n              var children = parentNode.children;\n              children.splice(children.indexOf(obj.id), 1);\n              this.diagram.nameTable[obj.id].parentId = '';\n              hasStack = true;\n              parentNode.wrapper.children.splice(index, 1);\n            }\n          }\n\n          moveChildInStack(obj, target, this.diagram, this.action);\n          parentNode = checkParentAsContainer(this.diagram, obj) ? this.diagram.nameTable[obj.parentId] : this.diagram.nameTable[obj.parentId] || obj;\n\n          if (parentNode && parentNode.container && parentNode.container.type === 'Canvas') {\n            parentNode.wrapper.maxWidth = parentNode.maxWidth = parentNode.wrapper.actualSize.width;\n            parentNode.wrapper.maxHeight = parentNode.maxHeight = parentNode.wrapper.actualSize.height;\n            isChangeProperties = true;\n          }\n\n          if (checkParentAsContainer(this.diagram, obj, true) && parentNode && parentNode.container.type === 'Canvas') {\n            checkChildNodeInContainer(this.diagram, obj);\n          } else {\n            history = this.updateContainerPropertiesExtend(parentNode, obj, connectors, helperObject, history);\n          }\n\n          if (this.diagram.lineRoutingModule && this.diagram.constraints & DiagramConstraints.LineRouting && !checkParentAsContainer(this.diagram, obj, true)) {\n            if (obj.children) {\n              this.diagram.realActions |= RealAction.EnableGroupAction;\n            }\n\n            this.diagram.nodePropertyChange(obj, {}, {\n              width: obj.width,\n              height: obj.height,\n              offsetX: obj.offsetX,\n              offsetY: obj.offsetY\n            });\n\n            if (obj.children) {\n              this.diagram.realActions &= ~RealAction.EnableGroupAction;\n            }\n          }\n\n          if (obj.shape.lanes) {\n            this.updateLaneChildNode(obj);\n          }\n\n          if (isChangeProperties) {\n            parentNode.maxWidth = parentNode.wrapper.maxWidth = undefined;\n            parentNode.maxHeight = parentNode.wrapper.maxHeight = undefined;\n          }\n\n          if (hasStack) {\n            this.diagram.nodePropertyChange(parentNode, {}, {\n              offsetX: parentNode.offsetX,\n              offsetY: parentNode.offsetY,\n              width: parentNode.width,\n              height: parentNode.height,\n              rotateAngle: parentNode.rotateAngle\n            });\n            var entry = {\n              redoObject: {\n                sourceIndex: undefined,\n                source: undoElement.source\n              },\n              type: 'StackChildPositionChanged',\n              undoObject: undoElement,\n              category: 'Internal'\n            };\n\n            if (!(this.diagram.diagramActions & DiagramAction.UndoRedo)) {\n              this.diagram.addHistoryEntry(entry);\n            }\n          }\n\n          if (obj && obj.container && (obj.container.type === 'Stack' || obj.container.type === 'Canvas' && obj.parentId === '')) {\n            if (obj && obj.shape && obj.shape.type === 'UmlClassifier') {\n              obj.wrapper.measureChildren = true;\n            }\n\n            this.diagram.nodePropertyChange(obj, {}, {\n              offsetX: obj.offsetX,\n              offsetY: obj.offsetY,\n              width: obj.width,\n              height: obj.height,\n              rotateAngle: obj.rotateAngle\n            });\n\n            if (obj && obj.shape && obj.shape.type === 'UmlClassifier') {\n              obj.wrapper.measureChildren = false;\n            }\n          }\n        }\n\n        updateConnectorsProperties(connectors, this.diagram);\n        history.hasStack = hasGroup;\n      }\n    }\n\n    if (obj && (obj.isPhase || obj.isLane || obj.shape && obj.shape.type === 'SwimLane')) {\n      this.diagram.updateDiagramElementQuad();\n    }\n\n    return history;\n  };\n\n  DiagramEventHandler.prototype.updateLaneChildNode = function (obj) {\n    for (var i = 0; i < obj.shape.lanes.length; i++) {\n      if (obj.shape.lanes[i].children && obj.shape.lanes[i].children.length > 0) {\n        for (var j = 0; j < obj.shape.lanes[i].children.length; j++) {\n          var id = obj.shape.lanes[i].children[j].id;\n          var childNode = this.diagram.nameTable[id];\n          childNode.offsetX = childNode.wrapper.offsetX;\n          childNode.offsetY = childNode.wrapper.offsetY;\n        }\n      }\n    }\n  };\n\n  DiagramEventHandler.prototype.updateContainerPropertiesExtend = function (parentNode, obj, connectors, helperObject, history) {\n    if (this.currentAction === 'ResizeEast' || this.currentAction === 'ResizeSouth' || obj.shape.type === 'SwimLane') {\n      var undoObj = cloneObject(obj);\n      var isUpdateRow = false;\n\n      if (parentNode && parentNode.container && parentNode.container.type === 'Grid') {\n        var shape = parentNode.shape.type === 'SwimLane' ? true : false;\n        var container = shape ? parentNode.wrapper.children[0] : parentNode.wrapper;\n        var padding = shape ? parentNode.shape.padding : undefined;\n        var x = parentNode.wrapper.bounds.x;\n        var y = parentNode.wrapper.bounds.y;\n\n        if (obj.columnIndex !== undefined && parentNode.container.orientation === 'Horizontal' && (shape && obj.isPhase || !shape && obj.rowIndex === 1) || parentNode.container.orientation === 'Vertical' && (!shape && obj.rowIndex > 0 && obj.columnIndex > 0 || shape && obj.isLane)) {\n          if (parentNode.container.orientation === 'Horizontal' && obj.isPhase && obj.wrapper.width > obj.maxWidth) {\n            obj.maxWidth = obj.wrapper.width;\n            obj.wrapper.maxWidth = obj.wrapper.width;\n          }\n\n          updateSwimLaneObject(this.diagram, obj, parentNode, helperObject);\n          container.updateColumnWidth(obj.columnIndex, helperObject.width, true, padding);\n\n          if (obj.isPhase) {\n            var id = parentNode.shape.phases[obj.columnIndex].header.id;\n            var node = this.diagram.nameTable[id];\n\n            if (node.maxWidth < helperObject.width) {\n              node.maxWidth = helperObject.width;\n              node.wrapper.maxWidth = helperObject.width;\n            }\n          }\n\n          if (parentNode.shape.type === 'SwimLane') {\n            parentNode.width = parentNode.width ? container.width : parentNode.width;\n            updateHeaderMaxWidth(this.diagram, parentNode);\n            parentNode.wrapper.width = parentNode.width;\n            connectors = getConnectors(this.diagram, container, obj.rowIndex, false);\n          }\n        } else if (obj.rowIndex !== undefined) {\n          isUpdateRow = true;\n          updateSwimLaneObject(this.diagram, obj, parentNode, helperObject);\n          container.updateRowHeight(obj.rowIndex, helperObject.height, true, padding);\n\n          if (parentNode.shape.type === 'SwimLane') {\n            parentNode.height = parentNode.height ? container.height : parentNode.height;\n            parentNode.wrapper.height = parentNode.height;\n            connectors = getConnectors(this.diagram, container, obj.rowIndex, true);\n          }\n        }\n\n        if (parentNode.shape.type === 'SwimLane') {\n          history.isPreventHistory = true;\n        }\n\n        this.diagram.nodePropertyChange(parentNode, {}, {\n          offsetX: parentNode.offsetX,\n          offsetY: parentNode.offsetY,\n          rotateAngle: parentNode.rotateAngle\n        });\n        this.diagram.drag(parentNode, x - parentNode.wrapper.bounds.x, y - parentNode.wrapper.bounds.y);\n      } else {\n        if (obj && obj.shape && obj.shape.type === 'UmlClassifier') {\n          obj.wrapper.measureChildren = true;\n        }\n\n        this.diagram.nodePropertyChange(obj, {}, {\n          offsetX: obj.offsetX,\n          offsetY: obj.offsetY,\n          width: obj.width,\n          height: obj.height,\n          rotateAngle: obj.rotateAngle\n        });\n        obj.wrapper.measureChildren = false;\n      }\n\n      obj.wrapper.measure(new Size(obj.wrapper.width, obj.wrapper.height));\n      obj.wrapper.arrange(obj.wrapper.desiredSize);\n\n      if (this.currentAction === 'ResizeEast' || this.currentAction === 'ResizeSouth') {\n        var redoObject = cloneObject(obj);\n        var entry = {\n          category: 'Internal',\n          type: isUpdateRow ? 'RowHeightChanged' : 'ColumnWidthChanged',\n          undoObject: undoObj,\n          redoObject: redoObject\n        };\n        this.diagram.addHistoryEntry(entry);\n      }\n    }\n\n    updateConnectorsProperties(connectors, this.diagram);\n    return history;\n  };\n\n  DiagramEventHandler.prototype.addUmlNode = function () {\n    var node = this.diagram.selectedItems.nodes[0];\n    var objects = this.diagram.findObjectsUnderMouse({\n      x: this.currentPosition.x + 20,\n      y: this.currentPosition.y\n    });\n    var target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n\n    if (!target) {\n      objects = this.diagram.findObjectsUnderMouse({\n        x: this.currentPosition.x - 20,\n        y: this.currentPosition.y\n      });\n      target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n    }\n\n    if (node && node.container && node.container.type === 'Stack' && target && target.parentId && target.parentId === node.id) {\n      var innerNode = target;\n      var adornerSvg = getAdornerLayerSvg(this.diagram.element.id);\n      var highlighter = adornerSvg.getElementById(adornerSvg.id + '_stack_highlighter');\n\n      if (highlighter) {\n        var index = node.wrapper.children.indexOf(target.wrapper) + 1;\n        this.diagram.enableServerDataBinding(false);\n        var temp = new Node(this.diagram, 'nodes', {\n          style: {\n            fill: node.style.fill,\n            strokeColor: node.style.strokeColor === 'black' ? '#ffffff00' : node.style.strokeColor\n          },\n          annotations: target.annotations,\n          verticalAlignment: 'Stretch',\n          horizontalAlignment: 'Stretch',\n          constraints: (NodeConstraints.Default | NodeConstraints.HideThumbs) & ~(NodeConstraints.Rotate | NodeConstraints.Drag | NodeConstraints.Resize),\n          minHeight: 25\n        }, true);\n        temp.annotations[0].content = ' + Name : Type';\n        var id = innerNode.id.split('_');\n        temp.id = randomId() + temp.id;\n        temp.parentId = node.id;\n        temp.zIndex = -1;\n        temp.umlIndex = index;\n        this.diagram.startGroupAction();\n        var redoElement = {\n          sourceIndex: node.wrapper.children.indexOf(temp.wrapper),\n          source: temp,\n          target: undefined,\n          targetIndex: undefined\n        };\n        this.diagram.enableServerDataBinding(true);\n        this.diagram.add(temp);\n        this.diagram.updateConnectorEdges(node);\n        this.diagram.clearSelection();\n        this.diagram.select([this.diagram.nameTable[temp.id]]);\n        this.diagram.endGroupAction();\n        this.diagram.startTextEdit();\n      }\n    }\n  };\n\n  return DiagramEventHandler;\n}();\n\nexport { DiagramEventHandler };\n/** @private */\n\nvar ObjectFinder =\n/** @class */\nfunction () {\n  function ObjectFinder() {}\n  /** @private */\n\n\n  ObjectFinder.prototype.findObjectsUnderMouse = function (pt, diagram, eventArgs, source, actions) {\n    // finds the collection of the object that is under the mouse;\n    var actualTarget = [];\n\n    if (source && source instanceof Selector) {\n      if (source.nodes.length + source.connectors.length === 1) {\n        source = source.nodes[0] || source.connectors[0];\n\n        if (source.children && source.children.length === 0) {\n          eventArgs.actualObject = source;\n        }\n      }\n    }\n\n    var container;\n    var bounds;\n    var child;\n    var matrix;\n    var endPadding = source && source instanceof Connector && (source.constraints & ConnectorConstraints.ConnectToNearByNode || source.constraints & ConnectorConstraints.ConnectToNearByPort) && source.connectionPadding || 0;\n    var objArray = diagram.spatialSearch.findObjects(new Rect(pt.x - 50 - endPadding, pt.y - 50 - endPadding, 100 + endPadding, 100 + endPadding));\n    var layerObjTable = {};\n    var layerTarger;\n\n    for (var _i = 0, objArray_1 = objArray; _i < objArray_1.length; _i++) {\n      var obj = objArray_1[_i];\n      var point = pt;\n      bounds = obj.wrapper.outerBounds;\n      var pointInBounds = obj.rotateAngle ? false : bounds.containsPoint(point, endPadding);\n\n      if ((obj !== source || diagram.currentDrawingObject instanceof Connector) && obj instanceof Connector ? obj !== diagram.currentDrawingObject : true && obj.wrapper.visible) {\n        var layer = diagram.commandHandler.getObjectLayer(obj.id);\n\n        if (layer && !layer.lock && layer.visible) {\n          layerTarger = layerObjTable[layer.zIndex] = layerObjTable[layer.zIndex] || [];\n\n          if (obj.rotateAngle) {\n            container = obj.wrapper;\n            bounds = cornersPointsBeforeRotation(container);\n\n            for (var _a = 0, _b = container.children; _a < _b.length; _a++) {\n              child = _b[_a];\n              matrix = identityMatrix();\n              rotateMatrix(matrix, -(child.rotateAngle + child.parentTransform), child.offsetX, child.offsetY);\n              point = transformPointByMatrix(matrix, pt);\n\n              if (cornersPointsBeforeRotation(child).containsPoint(point, endPadding)) {\n                pointInBounds = true;\n              }\n            }\n          }\n\n          if (!source || isSelected(diagram, obj) === false) {\n            if (canEnablePointerEvents(obj, diagram)) {\n              if (obj instanceof Connector ? isPointOverConnector(obj, pt) : pointInBounds) {\n                var padding = obj instanceof Connector ? obj.hitPadding || 0 : 0; //let element: DiagramElement;\n\n                var element = this.findElementUnderMouse(obj, pt, endPadding || padding);\n\n                if (element && obj.id !== 'helper') {\n                  insertObject(obj, 'zIndex', layerTarger);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    for (var _c = 0, _d = diagram.layers; _c < _d.length; _c++) {\n      var layer = _d[_c];\n      actualTarget = actualTarget.concat(layerObjTable[layer.zIndex] || []);\n\n      for (var _e = 0, actualTarget_1 = actualTarget; _e < actualTarget_1.length; _e++) {\n        var obj = actualTarget_1[_e];\n        var eventHandler = 'eventHandler';\n\n        if (obj.shape.type === 'Bpmn' && obj.processId && (!(diagram[eventHandler].tool instanceof MoveTool) || diagram[eventHandler].tool instanceof MoveTool && canAllowDrop(obj))) {\n          var index = actualTarget.indexOf(diagram.nameTable[obj.processId]);\n\n          if (index > -1) {\n            actualTarget.splice(index, 1);\n          }\n        }\n\n        if (obj.shape.type === 'UmlClassifier' && obj.container && obj.container.type === 'Stack') {\n          var index = actualTarget.indexOf(diagram.nameTable[diagram.nameTable[obj.id].wrapper.children[0].id]);\n\n          if (index > -1) {\n            actualTarget.splice(index, 1);\n          }\n        }\n      }\n    }\n\n    for (var i = 0; i < actualTarget.length; i++) {\n      var parentObj = diagram.nameTable[actualTarget[i].parentId];\n\n      if (parentObj) {\n        var portElement = this.findElementUnderMouse(parentObj, pt);\n\n        for (var j = 0; j < parentObj.ports.length; j++) {\n          if (portElement.id.match('_' + parentObj.ports[j].id + '$')) {\n            var port = parentObj.ports[j];\n\n            if (canDrag(port, diagram) || canDraw(port, diagram)) {\n              return actualTarget;\n            }\n          }\n        }\n      }\n\n      while (parentObj) {\n        var index = actualTarget.indexOf(parentObj);\n\n        if (index !== -1) {\n          actualTarget.splice(index, 1);\n        } else {\n          break;\n        }\n\n        parentObj = diagram.nameTable[parentObj.parentId];\n      }\n    }\n\n    this.checkSwimlane(actualTarget, diagram);\n\n    if (eventArgs && !eventArgs.source) {\n      for (var i = 0; i < actualTarget.length; i++) {\n        var parentNode = diagram.nameTable[actualTarget[i].parentId];\n\n        if (parentNode && parentNode.shape.type === 'SwimLane') {\n          for (var j = 0; j < actualTarget.length; j++) {\n            var connector = actualTarget[j];\n\n            if (connector instanceof Connector) {\n              actualTarget.splice(i, 1);\n            }\n          }\n        }\n      }\n    }\n\n    return actualTarget;\n  };\n  /** @private */\n\n\n  ObjectFinder.prototype.checkSwimlane = function (actualTarget, diagram) {\n    var isNode;\n\n    for (var m = 0; m < actualTarget.length; m++) {\n      var obj = actualTarget[m];\n      var parentNode = void 0;\n      var node = void 0;\n\n      if (obj instanceof Node) {\n        parentNode = actualTarget[m].parentId;\n        node = obj;\n      }\n\n      if (parentNode === '') {\n        isNode = true;\n      }\n\n      var parent_1 = diagram.nameTable[parentNode];\n\n      if (parent_1 && parent_1.isLane && diagram.nameTable[parent_1.parentId].zIndex > obj.zIndex) {\n        actualTarget[m] = parent_1;\n      }\n\n      if (m > 0 && isNode && node && (node.isLane || node.isPhase || node.isHeader)) {\n        if (actualTarget[m].zIndex < actualTarget[m - 1].zIndex) {\n          var swap = actualTarget[m];\n          actualTarget[m] = actualTarget[m - 1];\n          actualTarget[m - 1] = swap;\n        }\n      }\n    }\n\n    if (actualTarget.length >= 2) {\n      var parent_2 = '';\n\n      for (var i = actualTarget.length - 1; i >= 0; i--) {\n        if (actualTarget[i].parentId) {\n          var parent1 = findParentInSwimlane(actualTarget[i], diagram, parent_2);\n          var parent2 = findParentInSwimlane(actualTarget[i - 1], diagram, parent_2);\n          var parentNode1 = diagram.nameTable[parent1];\n          var parentNode2 = diagram.nameTable[parent2];\n\n          if (parentNode2 && parent1 !== parent2 && parentNode1.zIndex < parentNode2.zIndex) {\n            actualTarget.splice(i, 1);\n          }\n        }\n      }\n    }\n  };\n  /** @private */\n\n\n  ObjectFinder.prototype.isTarget = function (actualTarget, diagram, action) {\n    var connector = diagram.selectedItems.connectors[0];\n    var node;\n    node = action === 'ConnectorSourceEnd' ? diagram.nameTable[connector.targetID] : node = diagram.nameTable[connector.sourceID];\n\n    if (node && (!node.processId && !actualTarget.processId || node.processId !== actualTarget.processId)) {\n      if (node.processId !== actualTarget.processId) {\n        actualTarget = null;\n      }\n\n      if (actualTarget && actualTarget.parentId && diagram.nameTable[actualTarget.parentId].shape.type === 'UmlClassifier') {\n        actualTarget = diagram.nameTable[actualTarget.parentId];\n      }\n    }\n\n    if (action === 'ConnectorSourceEnd' && connector.targetID) {\n      var targetNode = diagram.nameTable[connector.targetID];\n\n      if (targetNode && targetNode.shape && targetNode.shape.shape === 'TextAnnotation') {\n        var id = connector.id.split('_');\n\n        if (targetNode.shape.type === 'Bpmn' && actualTarget.shape.type !== 'Bpmn' || id[0] === actualTarget.id || actualTarget.shape.shape === 'TextAnnotation') {\n          actualTarget = null;\n        }\n\n        if (actualTarget.parentId && diagram.nameTable[actualTarget.parentId].shape.type === 'UmlClassifier') {\n          actualTarget = diagram.nameTable[actualTarget.parentId];\n        }\n      }\n    }\n\n    return actualTarget;\n  };\n  /* tslint:disable */\n\n  /** @private */\n\n\n  ObjectFinder.prototype.findObjectUnderMouse = function (diagram, objects, action, inAction, eventArg, position, source) {\n    //we will get the wrapper object here\n    //we have to choose the object to be interacted with from the given wrapper\n    //Find the object that is under mouse\n    var eventHandler = 'eventHandler';\n    var endPoint = 'endPoint';\n    var inPort;\n    var outPort;\n    var actualTarget = null;\n\n    if (objects.length !== 0) {\n      if (source && source instanceof Selector) {\n        if (source.nodes.length + source.connectors.length === 1) {\n          source = source.nodes[0] || source.connectors[0];\n        }\n      }\n\n      if (action === 'ConnectorSourceEnd' && source || action === 'PortDraw' || (canDrawOnce(diagram) || canContinuousDraw(diagram)) && getObjectType(diagram.drawingObject) === Connector) {\n        var connector = diagram.selectedItems.connectors[0];\n\n        for (var i = objects.length - 1; i >= 0; i--) {\n          outPort = getInOutConnectPorts(objects[i], false);\n          inPort = getInOutConnectPorts(objects[i], true);\n          var tool = diagram[eventHandler].tool;\n          var portElement = this.findTargetElement(objects[i].wrapper, position, undefined);\n\n          if (action === 'Draw' && portElement && objects[i] instanceof Node && !checkPort(objects[i], portElement)) {\n            if (tool && tool[endPoint] === 'ConnectorSourceEnd' && !canOutConnect(objects[i]) || tool && tool[endPoint] === 'ConnectorTargetEnd' && !canInConnect(objects[i])) {\n              return actualTarget;\n            }\n          } // eslint-disable-next-line max-len\n\n\n          if (objects[i] instanceof Node && (canOutConnect(objects[i]) || canPortOutConnect(outPort) || canInConnect(objects[i]) || canPortInConnect(inPort) || action === 'PortDraw' && tool instanceof ConnectTool && tool[endPoint] === 'ConnectorTargetEnd' && (canInConnect(objects[i]) || canPortInConnect(inPort)))) {\n            actualTarget = objects[i];\n\n            if (connector) {\n              actualTarget = this.isTarget(actualTarget, diagram, action);\n            }\n\n            eventArg.actualObject = actualTarget;\n            return actualTarget;\n          }\n        }\n      } else if (action === 'ConnectorTargetEnd' && source) {\n        for (var i = objects.length - 1; i >= 0; i--) {\n          inPort = getInOutConnectPorts(objects[i], true);\n\n          if (objects[i] instanceof Node && (canInConnect(objects[i]) || canPortInConnect(inPort))) {\n            actualTarget = objects[i];\n            actualTarget = this.isTarget(actualTarget, diagram, action);\n            eventArg.actualObject = actualTarget;\n            return actualTarget;\n          }\n        }\n      } else if (source && (action === 'Drag' || diagram[eventHandler].tool instanceof MoveTool)) {\n        var index = 0;\n\n        for (var i = 0; i < objects.length; i++) {\n          var temp = objects[i];\n\n          if (source !== temp && (temp instanceof Connector || !position || temp.wrapper.bounds.containsPoint(position))) {\n            if (canAllowDrop(temp)) {\n              if (!actualTarget) {\n                actualTarget = temp;\n                index = actualTarget.zIndex;\n              } else {\n                actualTarget = index >= temp.zIndex ? actualTarget : temp;\n                index = Math.max(index, temp.zIndex);\n              }\n            }\n          }\n        }\n\n        if (actualTarget && actualTarget.shape.type === 'Bpmn') {\n          if (diagram.selectedItems.nodes.length > 0 && diagram.selectedItems.nodes[0].shape.type === 'Bpmn') {\n            // eslint-disable-next-line no-self-assign\n            actualTarget = actualTarget;\n          } else {\n            actualTarget = null;\n          }\n        }\n\n        if (actualTarget) {\n          eventArg.actualObject = actualTarget;\n        }\n\n        return actualTarget;\n      } else if ((action === 'Select' || action === 'Pan') && diagram[eventHandler].tool) {\n        for (var i = objects.length - 1; i >= 0; i--) {\n          if (objects[i] instanceof Connector) {\n            var objj1 = objects[i - 1];\n\n            if (objects[i - 1] instanceof Node && objj1.ports) {\n              var portElement = this.findTargetElement(objj1.wrapper, position, undefined);\n\n              if (portElement && (portElement.id.match('_icon_content_shape$') || portElement.id.match('_icon_content_rect$'))) {\n                return objj1;\n              }\n\n              for (var j = 0; j < objj1.ports.length; j++) {\n                if (portElement && portElement.id.match('_' + objj1.ports[j].id + '$')) {\n                  if (canDraw(objj1.ports[j], diagram)) {\n                    return objj1;\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        actualTarget = objects[objects.length - 1];\n        eventArg.actualObject = actualTarget;\n\n        if (!diagram[eventHandler].itemClick(actualTarget, true)) {\n          if (actualTarget.parentId) {\n            var obj = actualTarget;\n            var selected = isSelected(diagram, obj);\n\n            while (obj) {\n              if (isSelected(diagram, obj) && !selected) {\n                break;\n              }\n\n              actualTarget = obj;\n              obj = diagram.nameTable[obj.parentId];\n            }\n          }\n        }\n      } else if (action === 'Pan' || action === 'LayoutAnimation') {\n        for (var i = objects.length - 1; i >= 0; i--) {\n          if (objects[i] instanceof Node || objects[i] instanceof Connector) {\n            var portElement = this.findTargetElement(objects[i].wrapper, position, undefined);\n\n            if (action === 'Pan' || portElement && (portElement.id.match('_icon_content_shape$') || portElement.id.match('_icon_content_rect$'))) {\n              return objects[i];\n            }\n          }\n        }\n      } else {\n        actualTarget = objects[objects.length - 1];\n\n        if (eventArg && actualTarget) {\n          eventArg.actualObject = actualTarget;\n        }\n      }\n    }\n\n    return actualTarget;\n  };\n  /* tslint:enable */\n\n  /** @private */\n\n\n  ObjectFinder.prototype.findElementUnderSelectedItem = function (obj, position, padding) {\n    //rewrite this for multiple selection\n    if (obj instanceof Selector) {\n      if (obj.nodes.length === 1 && (!obj.connectors || !obj.connectors.length)) {\n        return this.findElementUnderMouse(obj.nodes[0], position);\n      } else if ((!obj.nodes || obj.nodes.length) && obj.connectors.length === 1) {\n        return this.findElementUnderMouse(obj.connectors[0], position);\n      }\n    } else {\n      return this.findElementUnderMouse(obj, position, padding);\n    }\n\n    return null;\n  };\n\n  ObjectFinder.prototype.findElementUnderMouse = function (obj, position, padding) {\n    return this.findTargetElement(obj.wrapper, position, padding);\n  };\n  /** @private */\n\n\n  ObjectFinder.prototype.findTargetElement = function (container, position, padding) {\n    for (var i = container.children.length - 1; i >= 0; i--) {\n      var element = container.children[i];\n\n      if (element && element.outerBounds.containsPoint(position, padding || 0)) {\n        if (element instanceof Container) {\n          var target = this.findTargetElement(element, position);\n\n          if (target) {\n            return target;\n          }\n        }\n\n        if (element.bounds.containsPoint(position, padding || 0)) {\n          return element;\n        }\n      }\n    }\n\n    if (container.bounds.containsPoint(position, padding) && container.style.fill !== 'none') {\n      return container;\n    }\n\n    return null;\n  };\n\n  return ObjectFinder;\n}();","map":{"version":3,"sources":["/Users/sergeismogliuk/Documents/Project/Project_node/Diplom/react-diplom/react-diplom/node_modules/@syncfusion/ej2-diagrams/src/diagram/interaction/event-handlers.js"],"names":["Browser","Point","Container","Connector","NodeDrawingTool","ConnectorDrawingTool","TextDrawingTool","PolygonDrawingTool","PolyLineDrawingTool","FixedUserHandleTool","Node","SelectTool","MoveTool","ResizeTool","RotateTool","ConnectTool","ExpandTool","LabelTool","ZoomPanTool","LabelDragTool","LabelResizeTool","LabelRotateTool","ConnectorEditing","Selector","findToolToActivate","isSelected","getCursor","contains","DiagramAction","KeyModifiers","Keys","DiagramEvent","DiagramTools","RendererAction","DiagramConstraints","BlazorAction","ScrollActions","isPointOverConnector","findObjectType","insertObject","getObjectFromCollection","getTooltipOffset","findParentInSwimlane","getObjectType","getInOutConnectPorts","removeChildNodes","cloneBlazorObject","checkPort","canZoomPan","canDraw","canDrag","canZoomTextEdit","canVitualize","canPreventClearSelection","canMove","canEnablePointerEvents","canSelect","canEnableToolTip","canOutConnect","canInConnect","canPortInConnect","canPortOutConnect","canAllowDrop","canUserInteract","defaultTool","updateTooltip","PortVisibility","NodeConstraints","ConnectorConstraints","RealAction","addTouchPointer","measureHtmlText","getAdornerLayerSvg","TextElement","Size","cloneObject","clone","Rect","identityMatrix","rotateMatrix","transformPointByMatrix","removeRulerMarkers","drawRulerMarkers","getRulerSize","updateRuler","canContinuousDraw","canDrawOnce","getFunction","cornersPointsBeforeRotation","updateCanvasBounds","checkChildNodeInContainer","checkParentAsContainer","removeChildInContainer","moveChildInStack","renderStackHighlighter","updateSwimLaneObject","getConnectors","updateHeaderMaxWidth","laneInterChanged","updateConnectorsProperties","DiagramHtmlElement","randomId","isBlazor","DiagramEventHandler","diagram","commandHandler","currentAction","previousAction","focus","isBlocked","isMouseDown","inAction","doingAutoScroll","objectFinder","tool","eventArgs","keyArgs","ObjectFinder","Object","defineProperty","prototype","get","set","action","DrawOnce","mouseUp","position","currentPosition","diagramCanvas","classList","add","remove","diagramActions","TextEdit","isUserHandle","ToolAction","setCursor","enumerable","configurable","blocked","getMousePosition","e","touchArg","offsetX","offsetY","type","indexOf","changedTouches","clientX","clientY","boundingRect","element","getBoundingClientRect","scrollLeft","left","width","scrollTop","top","height","scroller","transform","scale","tx","ty","x","y","windowResize","evt","_this","resizeTo","clearTimeout","setTimeout","updateViewPortSize","container","document","getElementById","id","bounds","setViewPortSize","getSizeValue","style","setSize","transformLayers","rulerSettings","showRulers","canHideResizers","updateCursor","selectedItems","nodes","length","connectors","list","concat","source","isForeignObject","target","isTextBox","foreignobject","parentNode","className","isMetaKey","navigator","platform","match","metaKey","ctrlKey","renderUmlHighLighter","args","removeStackHighlighter","node","shape","bound","wrapper","containsPoint","objects","findObjectsUnderMouse","findObjectUnderMouse","parentId","isVertical","nameTable","orientation","isDeleteKey","key","value","isMouseOnScrollBar","offsetHeight","offsetWidth","topLeft","topRight","bottomLeft","bottomRight","scrollHeight","toBounds","scrollWidth","updateVirtualization","delay","removeObjectInterval","setInterval","removeVirtualObjects","deleteVirtualObject","checkPreviousAction","userHandles","i","checkUserHandleEvent","onUserHandleMouseLeave","eventName","arg","undefined","name","onUserHandleMouseUp","onUserHandleMouseEnter","onUserHandleMouseDown","userHandleObject","triggerEvent","mouseDown","touches","isScrolling","preventDefault","checkEditBoxAsTarget","updatePortVisibility","hoverElement","Hover","button","buttons","count","actualObject","getMouseEventArgs","prevPosition","textEditing","endEdit","obj","sourceElement","findElementUnderMouse","findTarget","findActionToBeDone","shiftKey","connectorEditingToolModule","getTool","info","initialEventArgs","sourceWrapper","touchStartList","mouseMoveExtend","mouseMove","scrollSettings","canAutoScroll","checkAutoScroll","isNode","hoverNode","Connect","checkAction","annotation","sourcePoint","hitPadding","targetPoint","isSwimlaneElements","isLane","isPhase","isHeader","force","touchMoveList","equals","content_1","getContent","tooltip","openOn","elementLeave","canResetElement","elementEnter","mouseEvents","content","padding","getConnectorPadding","Interactions","isPrivateTooltip","constraints","Tooltip","autoScrollPosition","startAutoScroll","clearInterval","timeOutValue","diagram_1","delay_1","doAutoScroll","mode","previousSelectedObject","diagramRenderer","rendererActions","removeConstraints","DrawSelectorBorder","detail","which","isMultipleSelect","clearSelection","selectObjects","avoidDropChildren","history_1","updateContainerProperties","isGroupAction","addUmlNode","selectedObject","helperObject","updateContainerBounds","clickCount","getObject","isContainer","lineRoutingModule","PreventLaneContainerUpdate","isPreventHistory","checkMenu","window","userAgent","contextMenuModule","contextMenu","open","pageY","pageX","hasStack","endGroupAction","updateSelectedNodeProperties","dropChildToContainer","renderContainerHelper","PublicMethod","LineRouting","portVisibility","currentDrawingObject","selector","disbleRenderSelector","renderSelector","currentSymbol","click","getBlazorClickEventArgs","ZoomPan","targetObject","selectedConnector","ConnectToNearByPort","connectionPadding","push","addSwimLaneObject","selectedNode","swimlaneNode","targetNode","canInsert","index","offset","actualShape","clearSelectorLayer","laneNode","header","hasHeader","phases","addPhases","lane","lanes","orientation_1","rowIndex","columnIndex","center","addLanes","select","swimLaneobj","addInfo","mouseLeave","removeSnap","mouseWheel","blazorActions","interaction","up","wheelDelta","mousePosition","tooltipObject","close","zoom","horizontalOffset","verticalOffset","change","scrollActions","Interaction","isTriggerEvent","activeLabel","startTextEdit","keyDown","keyCode","command","keycode","commandManager","commands","_i","_a","keys","i_1","gesture","keyModifiers","altKey","altKeyPressed","shiftKeyPressed","ctrlKeyPressed","canExecute","KeyboardEvent","parameter","selectedSymbols","intDestroy","removeFromAQuad","removeObjectsFromLayer","removeElements","droppable","draggable","removeChild","addConstraints","PreventClearSelection","drawingObject","execute","commandExecute","getKeyModifier","getlabel","label","text","annotations","None","Control","Shift","Alt","Meta","keyUp","currentZoom","rulerSize","movingPosition","autoScrollBorder","viewPortWidth","right","bottom","viewPortHeight","option","autoScroll","pos","newDelay","top_1","point","splice","targets","mouseEnter","mouseOver","connector","getBlazorCollectionObject","lastObjectUnderMouse","arg_1","arg1","elementOver","dataBind","keyModifier","scrolled","updateScrollOffset","realActions","OverViewAction","setBlazorDiagramProps","doubleClick","arg_2","layer","getObjectLayer","lock","visible","children","split","itemClick","actualTarget","inputChange","minWidth","maxWidth","minHeight","fontsize","textWrapper","textBounds","textBoxWidth","transforms","editTextBox","editTextBoxDiv","line","getWrapper","Number","fontSize","isAddTextNode","focusOut","bpmnModule","textAnnotationConnectors","findTargetObjectUnderMouse","currentConnector","nearNode","ports","outerBounds","ConnectToNearByNode","targetWrapper","startTouches","moveTouches","resetTool","basicShape","points","object","rotateAngle","parentTransform","findElementUnderSelectedItem","findTargetUnderMouse","isAfterMouseUp","boundsUpdate","updateDiagramObject","updateSelector","isChangeProperties","hasGroup","history","AllowMovingOutsideLane","swimlane","laneId","firstlane","swimlaneBounds","undoElement","startGroupAction","targetIndex","sourceIndex","actualSize","maxHeight","updateContainerPropertiesExtend","EnableGroupAction","nodePropertyChange","updateLaneChildNode","entry","redoObject","undoObject","category","UndoRedo","addHistoryEntry","measureChildren","updateDiagramElementQuad","j","childNode","undoObj","isUpdateRow","updateColumnWidth","updateRowHeight","drag","measure","arrange","desiredSize","innerNode","adornerSvg","highlighter","enableServerDataBinding","temp","fill","strokeColor","verticalAlignment","horizontalAlignment","Default","HideThumbs","Rotate","Drag","Resize","zIndex","umlIndex","redoElement","updateConnectorEdges","pt","actions","child","matrix","endPadding","objArray","spatialSearch","findObjects","layerObjTable","layerTarger","objArray_1","pointInBounds","_b","_c","_d","layers","_e","actualTarget_1","eventHandler","processId","parentObj","portElement","port","checkSwimlane","m","parent_1","swap","parent_2","parent1","parent2","parentNode1","parentNode2","isTarget","targetID","sourceID","eventArg","endPoint","inPort","outPort","findTargetElement","Math","max","objj1","selected"],"mappings":"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","sourcesContent":["/* eslint-disable jsdoc/require-returns */\n/* eslint-disable jsdoc/require-param */\n/* eslint-disable valid-jsdoc */\n/* eslint-disable no-case-declarations */\nimport { Browser } from '@syncfusion/ej2-base';\nimport { Point } from '../primitives/point';\nimport { Container } from '../core/containers/container';\nimport { Connector } from '../objects/connector';\nimport { NodeDrawingTool, ConnectorDrawingTool, TextDrawingTool } from './tool';\nimport { PolygonDrawingTool, PolyLineDrawingTool, FixedUserHandleTool } from './tool';\nimport { Node } from '../objects/node';\nimport { SelectTool, MoveTool, ResizeTool, RotateTool, ConnectTool, ExpandTool, LabelTool, ZoomPanTool } from './tool';\nimport { LabelDragTool, LabelResizeTool, LabelRotateTool } from './tool';\nimport { ConnectorEditing } from './connector-editing';\nimport { Selector } from '../objects/node';\nimport { findToolToActivate, isSelected, getCursor, contains } from './actions';\nimport { DiagramAction, KeyModifiers, Keys, DiagramEvent, DiagramTools, RendererAction, DiagramConstraints } from '../enum/enum';\nimport { BlazorAction, ScrollActions } from '../enum/enum';\nimport { isPointOverConnector, findObjectType, insertObject, getObjectFromCollection, getTooltipOffset, findParentInSwimlane } from '../utility/diagram-util';\nimport { getObjectType, getInOutConnectPorts, removeChildNodes, cloneBlazorObject, checkPort } from '../utility/diagram-util';\nimport { canZoomPan, canDraw, canDrag, canZoomTextEdit, canVitualize, canPreventClearSelection } from './../utility/constraints-util';\nimport { canMove, canEnablePointerEvents, canSelect, canEnableToolTip } from './../utility/constraints-util';\nimport { canOutConnect, canInConnect, canPortInConnect, canPortOutConnect, canAllowDrop, canUserInteract, defaultTool } from './../utility/constraints-util';\nimport { updateTooltip } from '../objects/tooltip';\nimport { PortVisibility, NodeConstraints, ConnectorConstraints, RealAction } from '../enum/enum';\nimport { addTouchPointer, measureHtmlText, getAdornerLayerSvg } from '../utility/dom-util';\nimport { TextElement } from '../core/elements/text-element';\nimport { Size } from '../primitives/size';\nimport { cloneObject as clone, cloneObject } from './../utility/base-util';\nimport { Rect } from '../primitives/rect';\nimport { identityMatrix, rotateMatrix, transformPointByMatrix } from './../primitives/matrix';\nimport { removeRulerMarkers, drawRulerMarkers, getRulerSize, updateRuler } from '../ruler/ruler';\nimport { canContinuousDraw, canDrawOnce } from '../utility/constraints-util';\nimport { getFunction, cornersPointsBeforeRotation } from '../utility/base-util';\nimport { updateCanvasBounds, checkChildNodeInContainer, checkParentAsContainer, removeChildInContainer } from './container-interaction';\nimport { moveChildInStack, renderStackHighlighter } from './container-interaction';\nimport { updateSwimLaneObject } from '../utility/swim-lane-util';\nimport { getConnectors, updateHeaderMaxWidth, laneInterChanged, updateConnectorsProperties } from '../utility/swim-lane-util';\nimport { DiagramHtmlElement } from '../core/elements/html-element';\nimport { randomId } from '../index';\nimport { isBlazor } from '@syncfusion/ej2-base';\n/**\n * This module handles the mouse and touch events\n */\nvar DiagramEventHandler = /** @class */ (function () {\n    /** @private */\n    function DiagramEventHandler(diagram, commandHandler) {\n        this.currentAction = 'None';\n        this.previousAction = 'None';\n        /**   @private  */\n        this.focus = false;\n        this.isBlocked = false;\n        this.isMouseDown = false;\n        this.inAction = false;\n        this.doingAutoScroll = false;\n        this.diagram = null;\n        this.objectFinder = null;\n        this.tool = null;\n        this.eventArgs = null;\n        this.keyArgs = {};\n        this.diagram = diagram;\n        this.objectFinder = new ObjectFinder();\n        this.commandHandler = commandHandler;\n    }\n    Object.defineProperty(DiagramEventHandler.prototype, \"action\", {\n        get: function () {\n            return this.currentAction;\n        },\n        set: function (action) {\n            if (action !== this.currentAction) {\n                if (this.currentAction === 'PortDraw') {\n                    this.diagram.tool &= ~DiagramTools.DrawOnce;\n                    if (this.tool) {\n                        this.tool.mouseUp({ position: this.currentPosition });\n                    }\n                    this.tool = null;\n                }\n                if (action === 'Rotate' || action === 'LabelRotate') {\n                    this.diagram.diagramCanvas.classList.add('e-diagram-rotate');\n                }\n                else if (this.currentAction === 'Rotate' || this.currentAction === 'LabelRotate') {\n                    this.diagram.diagramCanvas.classList.remove('e-diagram-rotate');\n                }\n                this.currentAction = action;\n                if (this.currentAction !== 'None' && this.currentAction !== 'Select' &&\n                    !(this.diagram.diagramActions & DiagramAction.TextEdit) || this.commandHandler.isUserHandle(this.currentPosition)) {\n                    this.diagram.diagramActions = this.diagram.diagramActions | DiagramAction.ToolAction;\n                }\n                else {\n                    this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.ToolAction;\n                }\n                this.diagram.setCursor(this.diagram.getCursor(action, this.inAction));\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DiagramEventHandler.prototype, \"blocked\", {\n        get: function () {\n            return this.isBlocked;\n        },\n        set: function (blocked) {\n            this.isBlocked = blocked;\n            if (this.blocked) {\n                this.diagram.setCursor('not-allowed');\n            }\n            else {\n                this.diagram.setCursor(this.diagram.getCursor(this.action, this.inAction));\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /** @private */\n    DiagramEventHandler.prototype.getMousePosition = function (e) {\n        var touchArg;\n        var offsetX;\n        var offsetY;\n        if (e.type.indexOf('touch') !== -1) {\n            touchArg = e;\n            offsetX = touchArg.changedTouches[0].clientX;\n            offsetY = touchArg.changedTouches[0].clientY;\n        }\n        else {\n            offsetX = e.clientX;\n            offsetY = e.clientY;\n        }\n        var position = new Size();\n        position = getRulerSize(this.diagram);\n        var boundingRect = this.diagram.element.getBoundingClientRect();\n        offsetX = offsetX + this.diagram.diagramCanvas.scrollLeft - boundingRect.left - position.width;\n        offsetY = offsetY + this.diagram.diagramCanvas.scrollTop - boundingRect.top - position.height;\n        offsetX /= this.diagram.scroller.transform.scale;\n        offsetY /= this.diagram.scroller.transform.scale;\n        offsetX -= this.diagram.scroller.transform.tx;\n        offsetY -= this.diagram.scroller.transform.ty;\n        return { x: offsetX, y: offsetY };\n    };\n    /**\n     * @private\n     */\n    DiagramEventHandler.prototype.windowResize = function (evt) {\n        var _this = this;\n        if (this.resizeTo) {\n            clearTimeout(this.resizeTo);\n        }\n        this.resizeTo = setTimeout(function () {\n            _this.updateViewPortSize(_this.diagram.element);\n        }, 300);\n        return false;\n    };\n    /**\n     * @private\n     */\n    DiagramEventHandler.prototype.updateViewPortSize = function (element) {\n        var container = document.getElementById(element.id);\n        if (container) {\n            var bounds = container.getBoundingClientRect();\n            this.diagram.scroller.setViewPortSize(bounds.width, bounds.height);\n            var position = new Size();\n            position = getRulerSize(this.diagram);\n            var width = this.diagram.getSizeValue(this.diagram.width, position.width);\n            var height = this.diagram.getSizeValue(this.diagram.height, position.height);\n            this.diagram.diagramCanvas.style.width = width;\n            this.diagram.diagramCanvas.style.height = height;\n            this.diagram.scroller.setSize();\n            this.diagram.transformLayers();\n            if (this.diagram.rulerSettings.showRulers) {\n                updateRuler(this.diagram);\n            }\n        }\n    };\n    /** @private */\n    DiagramEventHandler.prototype.canHideResizers = function () {\n        return ((this.tool instanceof MoveTool || this.tool instanceof RotateTool) && this.isMouseDown);\n    };\n    /** @private */\n    DiagramEventHandler.prototype.updateCursor = function () {\n        if ((this.diagram.selectedItems.nodes.length === 1 || this.diagram.selectedItems.connectors.length === 1)) {\n            var list = [];\n            list = list.concat(this.diagram.selectedItems.nodes, this.diagram.selectedItems.connectors);\n            // Bug fix - EJ2-44495 -Node does not gets selected on slight movement of mouse when drag constraints disabled for node\n            this.blocked = (this.eventArgs && this.eventArgs.source && !canMove(this.eventArgs.source)) ? false :\n                (this.isMouseDown && list.length === 1 && this.tool instanceof SelectTool && !canMove(list[0]));\n        }\n    };\n    DiagramEventHandler.prototype.isForeignObject = function (target, isTextBox) {\n        var foreignobject = target;\n        if (foreignobject) {\n            while (foreignobject.parentNode !== null) {\n                if (typeof foreignobject.className === 'string' &&\n                    ((!isTextBox && foreignobject.className.indexOf('foreign-object') !== -1) ||\n                        (isTextBox && foreignobject.className.indexOf('e-diagram-text-edit') !== -1))) {\n                    return foreignobject;\n                }\n                else {\n                    foreignobject = foreignobject.parentNode;\n                }\n            }\n        }\n        return null;\n    };\n    DiagramEventHandler.prototype.isMetaKey = function (evt) {\n        return navigator.platform.match('Mac') ? evt.metaKey : evt.ctrlKey;\n    };\n    DiagramEventHandler.prototype.renderUmlHighLighter = function (args) {\n        this.diagram.commandHandler.removeStackHighlighter();\n        var node = this.diagram.selectedItems.nodes[0];\n        if (node && node.container && node.container.type === 'Stack' && node.shape.type === 'UmlClassifier') {\n            var bound = node.wrapper.bounds;\n            if (!bound.containsPoint(this.currentPosition)) {\n                // eslint-disable-next-line max-len\n                var objects = this.diagram.findObjectsUnderMouse({ x: this.currentPosition.x - 20, y: this.currentPosition.y });\n                var target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n                if (target && target.parentId && (target.parentId === node.id)) {\n                    // eslint-disable-next-line max-len\n                    var isVertical = this.diagram.nameTable[target.parentId].container.orientation === 'Vertical';\n                    renderStackHighlighter(target.wrapper, isVertical, args.position, this.diagram, true);\n                }\n            }\n        }\n    };\n    DiagramEventHandler.prototype.isDeleteKey = function (key, value) {\n        return (navigator.platform.match('Mac') && key === 'Backspace' && value === 'delete');\n    };\n    DiagramEventHandler.prototype.isMouseOnScrollBar = function (evt) {\n        var x = evt.offsetX;\n        var y = evt.offsetY;\n        var diagramCanvas = this.diagram.diagramCanvas;\n        var height = diagramCanvas.offsetHeight;\n        var width = diagramCanvas.offsetWidth;\n        var topLeft;\n        var topRight;\n        var bottomLeft;\n        var bottomRight;\n        var bounds;\n        if (height < diagramCanvas.scrollHeight) {\n            //default scrollbar width in browser is '17pixels'.\n            topLeft = { x: (width - 17), y: 0 };\n            topRight = { x: width, y: 0 };\n            bottomLeft = { x: (width - 17), y: height };\n            bottomRight = { x: width, y: height };\n            bounds = Rect.toBounds([topLeft, topRight, bottomLeft, bottomRight]);\n            if (bounds.containsPoint({ x: x, y: y })) {\n                return true;\n            }\n        }\n        if (width < diagramCanvas.scrollWidth) {\n            topLeft = { x: 0, y: (height - 17) };\n            topRight = { x: width, y: (height - 17) };\n            bottomLeft = { x: 0, y: height };\n            bottomRight = { x: width, y: height };\n            bounds = Rect.toBounds([topLeft, topRight, bottomLeft, bottomRight]);\n            if (bounds.containsPoint({ x: x, y: y })) {\n                return true;\n            }\n        }\n        return false;\n    };\n    /**   @private  */\n    DiagramEventHandler.prototype.updateVirtualization = function () {\n        var _this = this;\n        var delay = 50;\n        //let removeObjectInterval: Object;\n        var removeObjectInterval = setInterval(function (args) {\n            _this.diagram.removeVirtualObjects(removeObjectInterval);\n        }, delay);\n        setTimeout(function () {\n            _this.diagram.deleteVirtualObject = true;\n        }, delay);\n    };\n    DiagramEventHandler.prototype.checkPreviousAction = function () {\n        if (this.action !== this.previousAction && this.diagram.selectedItems.userHandles.length) {\n            for (var i = 0; i < this.diagram.selectedItems.userHandles.length; i++) {\n                if (this.previousAction && this.diagram.selectedItems.userHandles[i]) {\n                    this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseLeave);\n                    this.previousAction = 'None';\n                }\n            }\n        }\n    };\n    DiagramEventHandler.prototype.checkUserHandleEvent = function (eventName) {\n        if (this.diagram.selectedItems && this.diagram.selectedItems.userHandles.length > 0) {\n            var currentAction = (eventName === DiagramEvent.onUserHandleMouseLeave) ? this.previousAction : this.action;\n            var arg = { element: undefined };\n            for (var i = 0; i < this.diagram.selectedItems.userHandles.length; i++) {\n                if ((currentAction === this.diagram.selectedItems.userHandles[i].name) ||\n                    (eventName === DiagramEvent.onUserHandleMouseUp && currentAction === 'Select')) {\n                    arg.element = this.diagram.selectedItems.userHandles[i];\n                    if (eventName === DiagramEvent.onUserHandleMouseEnter) {\n                        this.previousAction = this.action;\n                    }\n                    if (eventName === DiagramEvent.onUserHandleMouseDown) {\n                        this.userHandleObject = this.diagram.selectedItems.userHandles[i].name;\n                    }\n                    var element = document.getElementById(this.diagram.selectedItems.userHandles[i].name + '_userhandle');\n                    if (eventName === DiagramEvent.onUserHandleMouseUp) {\n                        if (this.commandHandler.isUserHandle(this.currentPosition)\n                            && element && element.id === this.userHandleObject + '_userhandle') {\n                            this.diagram.triggerEvent(eventName, arg);\n                        }\n                    }\n                    else {\n                        this.diagram.triggerEvent(eventName, arg);\n                    }\n                }\n            }\n        }\n    };\n    DiagramEventHandler.prototype.mouseDown = function (evt) {\n        this.focus = true;\n        //let touches: TouchList;\n        var touches = evt.touches;\n        if (this.isMouseOnScrollBar(evt)) {\n            this.isScrolling = true;\n            evt.preventDefault();\n            return;\n        }\n        // commanded by gowtham- unwanted cloning of selectedItems\n        // if (isBlazor()) {\n        //     this.commandHandler.oldSelectedObjects = cloneObject(this.diagram.selectedItems);\n        // }\n        this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseDown);\n        if (!this.checkEditBoxAsTarget(evt) && (canUserInteract(this.diagram)) ||\n            (canZoomPan(this.diagram) && !defaultTool(this.diagram))) {\n            if (this.action === 'Select' || this.action === 'Drag') {\n                this.diagram.updatePortVisibility(this.hoverElement, PortVisibility.Hover, true);\n            }\n            if (((this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool)\n                && (evt.button === 2 || evt.buttons === 2))) {\n                // eslint-disable-next-line\n                var arg = {\n                    element: cloneBlazorObject(this.diagram), position: cloneBlazorObject(this.currentPosition),\n                    count: evt.buttons, actualObject: cloneBlazorObject(this.eventArgs.actualObject),\n                    button: (evt.button === 0) ? 'Left' : (evt.button === 1) ? 'Middle' : 'Right'\n                };\n                this.inAction = false;\n                this.tool.mouseUp(this.eventArgs);\n            }\n            else if (((this.inAction === true) && this.isMouseDown === true &&\n                (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool))) {\n                this.isMouseDown = true;\n                this.eventArgs = {};\n                this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n                this.eventArgs.position = this.currentPosition;\n                this.tool.mouseDown(this.eventArgs);\n            }\n            else {\n                this.isMouseDown = true;\n                this.currentPosition = this.prevPosition = this.getMousePosition(evt);\n                this.eventArgs = {};\n                if (this.diagram.textEditing && !this.isMouseOnScrollBar(evt)) {\n                    this.diagram.endEdit();\n                    this.diagram.textEditing = false;\n                }\n                var target = void 0;\n                var objects = this.objectFinder.findObjectsUnderMouse(this.currentPosition, this.diagram, this.eventArgs, null, this.action);\n                var obj = this.objectFinder.findObjectUnderMouse(this.diagram, objects, this.action, this.inAction, this.eventArgs, this.currentPosition);\n                var sourceElement = null;\n                if (obj !== null) {\n                    sourceElement = this.diagram.findElementUnderMouse(obj, this.currentPosition);\n                    if (sourceElement) {\n                        target = this.commandHandler.findTarget(sourceElement, obj);\n                    }\n                }\n                this.action = this.diagram.findActionToBeDone(obj, sourceElement, this.currentPosition, target);\n                //work around - correct it\n                var ctrlKey = this.isMetaKey(evt);\n                if (ctrlKey && evt.shiftKey && this.diagram.connectorEditingToolModule) {\n                    this.action = 'SegmentEnd';\n                }\n                else if ((ctrlKey || evt.shiftKey) && (!canZoomPan(this.diagram))) {\n                    this.action = 'Select';\n                }\n                this.tool = this.diagram.getTool(this.action);\n                if (!this.tool) {\n                    this.action = 'Select';\n                    this.tool = this.diagram.getTool(this.action);\n                }\n                this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n                if (ctrlKey || evt.shiftKey) {\n                    var info = (ctrlKey && evt.shiftKey) ? { ctrlKey: ctrlKey, shiftKey: evt.shiftKey } : { ctrlKey: true };\n                    this.eventArgs.info = info;\n                }\n                this.eventArgs.position = this.currentPosition;\n                this.tool.mouseDown(this.eventArgs);\n                this.initialEventArgs = { source: this.eventArgs.source, sourceWrapper: this.eventArgs.sourceWrapper };\n                this.initialEventArgs.position = this.currentPosition;\n                this.initialEventArgs.info = this.eventArgs.info;\n                this.inAction = false;\n                if (evt.type === 'touchstart') {\n                    if (touches && touches.length >= 2) {\n                        this.touchStartList = addTouchPointer(this.touchStartList, evt, touches);\n                    }\n                    if (!touches) {\n                        evt.preventDefault();\n                    }\n                }\n            }\n        }\n        if (!this.isForeignObject(evt.target) && !this.isForeignObject(evt.target, true) && (!touches)) {\n            evt.preventDefault();\n        }\n    };\n    /**   @private  */\n    DiagramEventHandler.prototype.mouseMoveExtend = function (e, obj) {\n        if (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool) {\n            this.tool.mouseMove(this.eventArgs);\n        }\n        if (this.diagram.scrollSettings.canAutoScroll) {\n            this.checkAutoScroll(e);\n        }\n        else {\n            if (!this.blocked) {\n                (this.tool.mouseMove(this.eventArgs));\n            }\n        }\n        if (this.eventArgs.target) {\n            this.hoverElement = this.eventArgs.target;\n        }\n        var isNode = this.eventArgs.target instanceof Node && obj instanceof Node ? false : true;\n        if (this.tool instanceof ConnectTool) {\n            this.diagram.updatePortVisibility(this.hoverElement instanceof Node ? this.hoverElement : this.hoverNode, PortVisibility.Connect | PortVisibility.Hover, isNode);\n        }\n        if (this.hoverElement instanceof Node\n            && this.hoverNode instanceof Node && this.hoverNode && this.hoverNode.id !== this.hoverElement.id) {\n            this.diagram.updatePortVisibility(this.hoverNode, PortVisibility.Connect | PortVisibility.Hover, true);\n        }\n        this.hoverElement = isNode ? null : obj;\n        this.hoverNode = isNode ? null : obj;\n    };\n    /** @private */\n    DiagramEventHandler.prototype.checkAction = function (obj) {\n        if (this.action === 'LabelSelect' && this.eventArgs.sourceWrapper &&\n            (this.eventArgs.sourceWrapper instanceof TextElement || this.eventArgs.sourceWrapper instanceof DiagramHtmlElement)) {\n            var annotation = this.commandHandler.findTarget(this.eventArgs.sourceWrapper, this.eventArgs.source);\n            if (!isSelected(this.diagram, annotation, false, this.eventArgs.sourceWrapper) && canMove(annotation)) {\n                this.action = 'LabelDrag';\n                this.tool = this.getTool(this.action);\n                this.tool.mouseDown(this.initialEventArgs);\n            }\n        }\n        else if (canMove(obj) && canSelect(obj) && this.initialEventArgs &&\n            this.initialEventArgs.source && this.action === 'Select') {\n            if (!isSelected(this.diagram, this.eventArgs.source, false) &&\n                this.eventArgs.source instanceof Selector) {\n                this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n            }\n            if (!(obj instanceof Connector) || (obj instanceof Connector &&\n                !(contains(this.currentPosition, obj.sourcePoint, obj.hitPadding) ||\n                    contains(this.currentPosition, obj.targetPoint, obj.hitPadding)))) {\n                this.action = 'Drag';\n            }\n            this.tool = this.getTool(this.action);\n            this.tool.mouseDown(this.initialEventArgs);\n        }\n    };\n    DiagramEventHandler.prototype.isSwimlaneElements = function (obj) {\n        if (obj && (obj.isLane || obj.isPhase || obj.isHeader)) {\n            return false;\n        }\n        else {\n            return true;\n        }\n    };\n    /* tslint:disable */\n    /** @private */\n    DiagramEventHandler.prototype.mouseMove = function (e, touches) {\n        this.focus = true;\n        if (this.isScrolling) {\n            e.preventDefault();\n            return;\n        }\n        if (canUserInteract(this.diagram) || (canZoomPan(this.diagram) && !defaultTool(this.diagram))) {\n            this.currentPosition = this.getMousePosition(e);\n            var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n            var obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n            drawRulerMarkers(this.diagram, this.currentPosition);\n            var force = false;\n            var target = void 0;\n            if (e.type === 'touchmove') {\n                touches = e.touches;\n                if (touches && touches.length > 1) {\n                    this.touchMoveList = addTouchPointer(this.touchMoveList, e, touches);\n                    if (this.action !== 'PinchZoom') {\n                        force = true;\n                    }\n                }\n            }\n            if (Point.equals(this.currentPosition, this.prevPosition) === false || this.inAction) {\n                if (this.isMouseDown === false || force) {\n                    this.eventArgs = {};\n                    var sourceElement = null;\n                    if (obj !== null) {\n                        sourceElement = this.diagram.findElementUnderMouse(obj, this.currentPosition);\n                        if (obj !== this.hoverElement) {\n                            var content_1 = this.getContent();\n                            if (this.hoverElement && this.hoverElement.tooltip.openOn === 'Auto' && content_1 !== '') {\n                                this.elementLeave();\n                            }\n                            this.diagram.updatePortVisibility(this.hoverElement, PortVisibility.Hover, true);\n                            if (obj instanceof Node) {\n                                this.hoverNode = obj;\n                            }\n                            var canResetElement = true;\n                            if (!this.isSwimlaneElements(obj)\n                                && (this.hoverElement && this.isSwimlaneElements(this.hoverElement))) {\n                                canResetElement = false;\n                            }\n                            this.hoverElement = canResetElement ? obj : this.hoverElement;\n                            if (canResetElement) {\n                                this.elementEnter(this.currentPosition, false);\n                            }\n                            else {\n                                this.hoverElement = obj;\n                            }\n                        }\n                        else if (!this.hoverElement && this.hoverElement === obj) {\n                            this.elementEnter(this.currentPosition, true);\n                        }\n                        if (sourceElement) {\n                            target = this.commandHandler.findTarget(sourceElement, obj);\n                        }\n                    }\n                    this.action = this.diagram.findActionToBeDone(obj, sourceElement, this.currentPosition, target);\n                    this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseEnter);\n                    this.checkPreviousAction();\n                    this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n                    this.tool = this.getTool(this.action);\n                    this.mouseEvents();\n                    if (this.tool instanceof ConnectorDrawingTool ||\n                        this.tool instanceof PolyLineDrawingTool ||\n                        this.tool instanceof PolygonDrawingTool) {\n                        this.tool.mouseMove(this.eventArgs);\n                    }\n                    else if (touches && this.tool instanceof ZoomPanTool) {\n                        this.tool.mouseDown(this.eventArgs);\n                    }\n                    this.updateCursor();\n                    this.renderUmlHighLighter(this.eventArgs);\n                    var isNode = false;\n                    if (!(this.hoverElement && (!(this.tool instanceof ZoomPanTool))\n                        && (obj instanceof Node && this.isSwimlaneElements(obj)) &&\n                        (this.diagram.selectedItems.nodes.length === 0 || !isSelected(this.diagram, this.hoverElement)))) {\n                        isNode = true;\n                    }\n                    this.diagram.updatePortVisibility(this.hoverElement, PortVisibility.Hover, isNode);\n                    var content = this.getContent();\n                    if (obj === null && this.hoverElement && this.hoverElement.tooltip.openOn === 'Auto' && content) {\n                        this.hoverElement = null;\n                        this.elementLeave();\n                    }\n                    force = false;\n                }\n                else {\n                    this.eventArgs.position = this.currentPosition;\n                    if (this.action === 'Drag' && !isSelected(this.diagram, this.eventArgs.source, false) &&\n                        this.eventArgs.source instanceof Selector) {\n                        this.getMouseEventArgs(this.currentPosition, this.eventArgs);\n                    }\n                    this.mouseEvents();\n                    if (e.ctrlKey || e.shiftKey) {\n                        var info = (e.ctrlKey && e.shiftKey) ? { ctrlKey: e.ctrlKey, shiftKey: e.shiftKey } : { ctrlKey: true };\n                        this.eventArgs.info = info;\n                    }\n                    this.checkAction(obj);\n                    var padding = this.getConnectorPadding(this.eventArgs);\n                    this.getMouseEventArgs(this.currentPosition, this.eventArgs, this.eventArgs.source, padding);\n                    this.updateCursor();\n                    this.inAction = true;\n                    this.initialEventArgs = null;\n                    if (this.action === 'Drag' || this.action === 'Rotate') {\n                        this.diagram.diagramActions = this.diagram.diagramActions | DiagramAction.Interactions;\n                    }\n                    this.mouseMoveExtend(e, obj);\n                }\n                this.prevPosition = this.currentPosition;\n                if (!this.isForeignObject(e.target, true)) {\n                    e.preventDefault();\n                }\n            }\n        }\n    };\n    /* tslint:enable */\n    DiagramEventHandler.prototype.getContent = function () {\n        var isPrivateTooltip = ((this.hoverElement instanceof Node) &&\n            this.hoverElement.constraints & NodeConstraints.Tooltip) ||\n            ((this.hoverElement instanceof Connector) &&\n                this.hoverElement.constraints & ConnectorConstraints.Tooltip);\n        var content = isPrivateTooltip ? this.hoverElement.tooltip.content :\n            this.diagram.tooltip.content;\n        return content;\n    };\n    DiagramEventHandler.prototype.checkAutoScroll = function (e) {\n        var autoScrollPosition = this.startAutoScroll(e);\n        if (!autoScrollPosition && this.doingAutoScroll) {\n            this.doingAutoScroll = false;\n            clearInterval(this.timeOutValue);\n        }\n        else if (autoScrollPosition) {\n            if ((this.tool instanceof NodeDrawingTool || this.tool instanceof ConnectorDrawingTool\n                || this.tool instanceof MoveTool || this.tool instanceof ResizeTool\n                || this.tool instanceof SelectTool) && this.inAction) {\n                // eslint-disable-next-line @typescript-eslint/no-this-alias\n                var diagram_1 = this;\n                var delay_1 = 100;\n                if (this.diagram.scrollSettings.canAutoScroll && autoScrollPosition && !this.doingAutoScroll) {\n                    this.doingAutoScroll = true;\n                    this.timeOutValue = setInterval(function (args) {\n                        diagram_1.doAutoScroll(autoScrollPosition, e, delay_1);\n                    }, delay_1);\n                }\n            }\n        }\n        else {\n            this.blocked = !(this.tool.mouseMove(this.eventArgs));\n        }\n    };\n    /* tslint:disable */\n    /** @private */\n    DiagramEventHandler.prototype.mouseUp = function (evt) {\n        this.checkUserHandleEvent(DiagramEvent.onUserHandleMouseUp);\n        if (this.diagram.mode === 'SVG' && canVitualize(this.diagram)) {\n            this.updateVirtualization();\n        }\n        this.diagram.previousSelectedObject = null;\n        this.diagram.diagramRenderer.rendererActions =\n            this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions, RendererAction.DrawSelectorBorder);\n        var touches = evt.touches;\n        if (this.isScrolling) {\n            this.isScrolling = false;\n            evt.preventDefault();\n            return;\n        }\n        if (!this.checkEditBoxAsTarget(evt) && (canUserInteract(this.diagram))\n            || (canZoomPan(this.diagram) && !defaultTool(this.diagram))) {\n            if (this.tool && (!(this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool) ||\n                ((this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool)\n                    && evt.detail === 2))) {\n                if (!this.isForeignObject(evt.target) && this.isMouseDown) {\n                    document.getElementById(this.diagram.element.id + 'content').focus();\n                }\n                if (!this.inAction && evt.which !== 3) {\n                    if (this.action === 'Drag') {\n                        this.action = 'Select';\n                        var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n                        var obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n                        var isMultipleSelect = true;\n                        if ((!evt.ctrlKey && this.isMouseDown\n                            && (this.diagram.selectedItems.nodes.length + this.diagram.selectedItems.connectors.length) > 1)\n                            && evt.which === 1 && !canPreventClearSelection(this.diagram.diagramActions)) {\n                            isMultipleSelect = false;\n                            this.commandHandler.clearSelection();\n                        }\n                        if (!isSelected(this.diagram, obj) || (!isMultipleSelect)) {\n                            this.commandHandler.selectObjects([obj]);\n                        }\n                    }\n                }\n                var avoidDropChildren = false;\n                var history_1 = this.updateContainerProperties();\n                var isGroupAction = void 0;\n                this.addUmlNode();\n                this.inAction = false;\n                this.isMouseDown = false;\n                this.currentPosition = this.getMousePosition(evt);\n                if (this.diagram.selectedObject.helperObject) {\n                    isGroupAction = this.updateContainerBounds();\n                }\n                if (this.tool && (this.tool.prevPosition || this.tool instanceof LabelTool)) {\n                    this.eventArgs.position = this.currentPosition;\n                    var padding = this.getConnectorPadding(this.eventArgs);\n                    this.getMouseEventArgs(this.currentPosition, this.eventArgs, this.eventArgs.source, padding);\n                    var ctrlKey = this.isMetaKey(evt);\n                    if (ctrlKey || evt.shiftKey) {\n                        var info = (ctrlKey && evt.shiftKey) ? { ctrlKey: ctrlKey, shiftKey: evt.shiftKey } :\n                            { ctrlKey: true };\n                        this.eventArgs.info = info;\n                    }\n                    if (this.diagram.diagramActions & DiagramAction.Interactions) {\n                        this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.Interactions;\n                    }\n                    this.eventArgs.clickCount = evt.detail;\n                    if (this.diagram.selectedObject.helperObject && (this.tool instanceof MoveTool || this.tool instanceof ResizeTool)) {\n                        if (this.diagram.selectedObject.actualObject &&\n                            this.diagram.selectedObject.actualObject.parentId !== '') {\n                            var parentNode = this.diagram.getObject(this.diagram.selectedObject.actualObject.parentId);\n                            if (parentNode && parentNode.isLane) {\n                                this.commandHandler.isContainer = true;\n                            }\n                        }\n                        avoidDropChildren = this.diagram.lineRoutingModule\n                            && this.diagram.nameTable[\"helper\"] && this.eventArgs.target && this.eventArgs.target.isLane\n                            && ((this.eventArgs.source instanceof Selector && this.eventArgs.source.nodes.length > 0\n                                && this.eventArgs.source.nodes[0].parentId === \"\") || (this.eventArgs.source.parentId === \"\"));\n                        if (avoidDropChildren) {\n                            this.diagram.diagramActions = this.diagram.diagramActions | DiagramAction.PreventLaneContainerUpdate;\n                        }\n                        this.tool.mouseUp(this.eventArgs, history_1.isPreventHistory);\n                    }\n                    else {\n                        this.tool.mouseUp(this.eventArgs);\n                        if (this.diagram.checkMenu && (window.navigator.userAgent.indexOf('Linux') !== -1 || window.navigator.userAgent.indexOf('X11') !== -1)) {\n                            this.diagram.contextMenuModule.contextMenu.open(evt.pageY, evt.pageX, this.diagram.element);\n                            this.diagram.checkMenu = false;\n                        }\n                    }\n                    if (history_1.hasStack) {\n                        this.diagram.endGroupAction();\n                    }\n                }\n                if (isGroupAction) {\n                    this.diagram.endGroupAction();\n                }\n                this.updateContainerBounds(true);\n                if (this.eventArgs.clickCount !== 2) {\n                    this.commandHandler.updateSelectedNodeProperties(this.eventArgs.source);\n                    if (avoidDropChildren) {\n                        this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.PreventLaneContainerUpdate;\n                        var nodes = this.eventArgs.source instanceof Selector\n                            ? this.eventArgs.source.nodes : [this.eventArgs.source];\n                        if (nodes) {\n                            for (var i = 0; i < nodes.length; i++) {\n                                if (!nodes[i].container) {\n                                    this.commandHandler.dropChildToContainer(this.eventArgs.target, nodes[i]);\n                                    this.commandHandler.renderContainerHelper(nodes[i]);\n                                }\n                            }\n                        }\n                    }\n                }\n                if (this.diagram.selectedObject && this.diagram.selectedObject.helperObject) {\n                    this.diagram.remove(this.diagram.selectedObject.helperObject);\n                    this.diagram.selectedObject = { helperObject: undefined, actualObject: undefined };\n                    // EJ2-42605 - Annotation undo redo not working properly if the line routing is enabled committed by sivakumar sekar\n                    // committed to remove the diagram actions public method when line routing is enabled\n                    // eslint-disable-next-line\n                    if ((this.diagram.diagramActions & DiagramAction.PublicMethod) && (this.diagram.constraints & DiagramConstraints.LineRouting)) {\n                        this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.PublicMethod;\n                    }\n                }\n                this.blocked = false;\n                if (this.hoverElement) {\n                    var portVisibility = PortVisibility.Connect;\n                    if (isSelected(this.diagram, this.hoverElement)) {\n                        portVisibility |= PortVisibility.Hover;\n                    }\n                    this.diagram.updatePortVisibility(this.hoverElement, portVisibility, true);\n                    this.hoverElement = null;\n                }\n                this.touchStartList = null;\n                this.touchMoveList = null;\n                if (!(this.tool instanceof TextDrawingTool)) {\n                    this.tool = null;\n                }\n            }\n            if (!touches) {\n                evt.preventDefault();\n            }\n            this.diagram.currentDrawingObject = undefined;\n            var selector = this.diagram.selectedItems;\n            var disbleRenderSelector = false;\n            if (this.commandHandler.isUserHandle(this.currentPosition)) {\n                if (this.isForeignObject(evt.target)) {\n                    disbleRenderSelector = true;\n                }\n            }\n            if (!this.inAction && selector.wrapper && selector.userHandles.length > 0 && !disbleRenderSelector) {\n                this.diagram.renderSelector(true);\n            }\n            if (!this.inAction && !this.diagram.currentSymbol && this.eventArgs) {\n                var arg = {\n                    element: cloneBlazorObject(this.eventArgs.source) || cloneBlazorObject(this.diagram),\n                    position: cloneBlazorObject(this.eventArgs.position), count: evt.detail,\n                    actualObject: cloneBlazorObject(this.eventArgs.actualObject),\n                    button: (evt.button === 0) ? 'Left' : (evt.button === 1) ? 'Middle' : 'Right'\n                };\n                if (isBlazor() && this.diagram.click) {\n                    arg = this.getBlazorClickEventArgs(arg);\n                }\n                if (this.diagram.tool !== DiagramTools.ZoomPan) {\n                    this.diagram.triggerEvent(DiagramEvent.click, arg);\n                }\n            }\n            this.eventArgs = {};\n        }\n        this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.PreventLaneContainerUpdate;\n        this.eventArgs = {};\n        this.diagram.commandHandler.removeStackHighlighter(); // end the corresponding tool\n    };\n    /* tslint:enable */\n    DiagramEventHandler.prototype.getConnectorPadding = function (eventArgs) {\n        var padding;\n        var targetObject = eventArgs.source;\n        if (targetObject && (targetObject instanceof Selector) && targetObject.connectors.length) {\n            var selectedConnector = targetObject.connectors[0];\n            padding = (selectedConnector.constraints & ConnectorConstraints.ConnectToNearByPort) ? selectedConnector.connectionPadding : 0;\n        }\n        return padding || 0;\n    };\n    DiagramEventHandler.prototype.getBlazorClickEventArgs = function (arg) {\n        arg = {\n            element: this.eventArgs.source ? { selector: cloneBlazorObject(this.eventArgs.source) } :\n                { diagram: cloneBlazorObject(this.diagram) },\n            position: cloneBlazorObject(this.eventArgs.position), count: arg.count,\n            actualObject: this.eventArgs.actualObject ? { selector: cloneBlazorObject(this.eventArgs.actualObject) } :\n                { diagram: cloneBlazorObject(this.diagram) },\n            button: arg.button\n        };\n        if (this.eventArgs.source instanceof Node) {\n            arg.element.selector.nodes = [];\n            arg.element.selector.nodes.push(cloneBlazorObject(this.eventArgs.source));\n        }\n        else if (this.eventArgs.source instanceof Connector) {\n            arg.element.selector.connectors = [];\n            arg.element.selector.connectors.push(cloneBlazorObject(this.eventArgs.source));\n        }\n        return arg;\n    };\n    DiagramEventHandler.prototype.addSwimLaneObject = function (selectedNode) {\n        var swimlaneNode;\n        var targetNode;\n        var shape;\n        var value;\n        var canInsert;\n        var index = 0;\n        var offset;\n        var actualShape = selectedNode.shape;\n        var objects = this.objectFinder.findObjectsUnderMouse(this.currentPosition, this.diagram, this.eventArgs, null, this.action);\n        if (!targetNode) {\n            targetNode = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n        }\n        this.diagram.clearSelectorLayer();\n        if (targetNode && !(targetNode.isLane || targetNode.isPhase || targetNode.isHeader)) {\n            for (var i = 0; i < objects.length; i++) {\n                var laneNode = this.diagram.nameTable[objects[i].id];\n                if (laneNode.isLane || laneNode.isPhase || laneNode.isHeader) {\n                    targetNode = laneNode;\n                }\n            }\n        }\n        if (targetNode && (actualShape.isPhase || (actualShape.isLane && targetNode.isLane))) {\n            var id = targetNode.parentId;\n            swimlaneNode = this.diagram.nameTable[id];\n        }\n        if (swimlaneNode) {\n            shape = swimlaneNode.shape;\n            canInsert = (actualShape.isLane) ? actualShape.orientation === shape.orientation :\n                actualShape.orientation !== shape.orientation;\n        }\n        if (canInsert && targetNode) {\n            if (shape.header && shape.hasHeader && shape.orientation === 'Horizontal') {\n                index = 1;\n            }\n            if (shape.phases.length > 0) {\n                index += 1;\n            }\n            if (actualShape.isPhase) {\n                if (shape.orientation === 'Horizontal') {\n                    offset = this.currentPosition.x - swimlaneNode.wrapper.bounds.x;\n                }\n                else {\n                    offset = this.currentPosition.y - (swimlaneNode.wrapper.bounds.y + shape.header.height);\n                }\n                var phases = { id: randomId(), offset: offset, header: { annotation: { content: 'Phase' } } };\n                this.diagram.addPhases(swimlaneNode, [phases]);\n            }\n            else {\n                //const laneHeight: number = actualShape.lanes[0].header.height;\n                var lane = {\n                    id: randomId(), style: actualShape.lanes[0].style, header: {\n                        annotation: {\n                            content: actualShape.lanes[0].header.annotation.content,\n                            style: actualShape.lanes[0].header.annotation.style\n                        },\n                        style: actualShape.lanes[0].header.style\n                    }\n                };\n                var orientation_1 = (actualShape.orientation === 'Horizontal') ? true : false;\n                // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n                orientation_1 ? lane.height = actualShape.lanes[0].height : lane.width = actualShape.lanes[0].width;\n                if (shape.orientation === 'Horizontal') {\n                    value = targetNode.rowIndex ? targetNode.rowIndex :\n                        this.diagram.nameTable[targetNode.parentId].rowIndex;\n                    if (targetNode.wrapper.offsetY < this.currentPosition.y) {\n                        value += 1;\n                    }\n                }\n                else {\n                    value = targetNode.columnIndex ? targetNode.columnIndex :\n                        this.diagram.nameTable[targetNode.parentId].columnIndex;\n                    if (this.currentPosition.x < targetNode.wrapper.bounds.center.x) {\n                        value -= 1;\n                    }\n                }\n                if (shape.lanes.length > (value - index)) {\n                    lane.header.width = shape.lanes[value - index].header.width;\n                    lane.header.height = shape.lanes[value - index].header.height;\n                }\n                else {\n                    lane.header.width = shape.lanes[value - index - 1].header.width;\n                    lane.header.height = shape.lanes[value - index - 1].header.height;\n                }\n                this.diagram.addLanes(swimlaneNode, [lane], value - index);\n            }\n            this.commandHandler.select(swimlaneNode);\n        }\n        else if (actualShape.isLane) {\n            var swimLaneobj = {\n                id: randomId(), width: selectedNode.width, height: selectedNode.height, addInfo: selectedNode.addInfo,\n                shape: {\n                    type: 'SwimLane', header: {\n                        annotation: { content: 'Header' }, height: 50, style: actualShape.lanes[0].header.style\n                    },\n                    phases: [{ id: randomId(), header: { annotation: { content: 'Phase' } } }],\n                    lanes: [{\n                            id: randomId(), height: selectedNode.height, width: selectedNode.width, style: actualShape.lanes[0].style,\n                            header: {\n                                annotation: {\n                                    content: actualShape.lanes[0].header.annotation.content,\n                                    style: actualShape.lanes[0].header.annotation.style\n                                },\n                                style: actualShape.lanes[0].header.style\n                            }\n                        }], orientation: actualShape.orientation\n                }\n            };\n            if (actualShape.orientation === 'Vertical') {\n                swimLaneobj.width += 20;\n            }\n            swimLaneobj.offsetX = this.currentPosition.x + (swimLaneobj.width / 2);\n            swimLaneobj.offsetY = this.currentPosition.y + (swimLaneobj.height / 2);\n            this.diagram.add(swimLaneobj);\n        }\n    };\n    /** @private */\n    DiagramEventHandler.prototype.mouseLeave = function (evt) {\n        //Define what has to happen on mouse leave\n        if (this.tool && this.inAction) {\n            this.tool.mouseLeave(this.eventArgs);\n        }\n        if (this.diagram.selectedObject.helperObject) {\n            this.updateContainerProperties();\n            var isGroupAction = this.updateContainerBounds();\n            if (isGroupAction) {\n                this.diagram.endGroupAction();\n            }\n        }\n        if (this.eventArgs && this.eventArgs.source) {\n            this.diagram.updatePortVisibility(this.eventArgs.source, PortVisibility.Hover, true);\n            this.hoverElement = null;\n        }\n        if (this.eventArgs && !this.eventArgs.source && this.hoverElement) {\n            this.hoverElement = null;\n        }\n        if (this.tool instanceof ConnectTool && this.eventArgs && this.eventArgs.target && this.eventArgs.target instanceof Node) {\n            this.diagram.updatePortVisibility(this.eventArgs.target, PortVisibility.Hover | PortVisibility.Connect, true);\n            this.hoverElement = null;\n        }\n        var selector = this.diagram.selectedItems;\n        if (selector && selector.wrapper) {\n            this.diagram.renderSelector(true);\n        }\n        if (this.diagram.diagramActions & DiagramAction.Interactions || this.diagram.diagramActions & DiagramAction.ToolAction) {\n            this.diagram.diagramActions = this.diagram.diagramActions & ~DiagramAction.ToolAction;\n        }\n        this.isMouseDown = false;\n        this.focus = false;\n        this.touchStartList = null;\n        this.touchMoveList = null;\n        this.elementLeave();\n        this.commandHandler.removeSnap();\n        this.inAction = false;\n        this.eventArgs = {};\n        if (this.diagram.selectedObject && this.diagram.selectedObject.helperObject) {\n            this.diagram.remove(this.diagram.selectedObject.helperObject);\n            this.diagram.selectedObject = { helperObject: undefined, actualObject: undefined };\n        }\n        this.tool = null;\n        removeRulerMarkers();\n        if (this.action === 'Rotate') {\n            this.diagram.diagramCanvas.classList.remove('e-diagram-rotate');\n        }\n        evt.preventDefault();\n    };\n    /** @private */\n    DiagramEventHandler.prototype.mouseWheel = function (evt) {\n        this.diagram.blazorActions |= BlazorAction.interaction;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var up = (evt.wheelDelta > 0 || -40 * evt.detail > 0) ? true : false;\n        var mousePosition = this.getMousePosition(evt);\n        this.diagram.tooltipObject.close();\n        var ctrlKey = this.isMetaKey(evt);\n        if (ctrlKey) {\n            this.diagram.zoom(up ? (1.2) : 1 / (1.2), mousePosition);\n            evt.preventDefault();\n        }\n        else {\n            var horizontalOffset = this.diagram.scroller.horizontalOffset;\n            var verticalOffset = this.diagram.scroller.verticalOffset;\n            var change = up ? 20 : -20;\n            if (this.tool && (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool)) {\n                this.eventArgs = {};\n                this.getMouseEventArgs(mousePosition, this.eventArgs);\n                this.eventArgs.position = mousePosition;\n                this.tool.mouseWheel(this.eventArgs);\n            }\n            this.diagram.scrollActions |= ScrollActions.Interaction;\n            if (evt.shiftKey) {\n                this.diagram.scroller.zoom(1, change, 0, mousePosition);\n            }\n            else {\n                this.diagram.scroller.zoom(1, 0, change, mousePosition);\n            }\n            this.diagram.scrollActions &= ~ScrollActions.Interaction;\n            if (horizontalOffset !== this.diagram.scroller.horizontalOffset\n                || verticalOffset !== this.diagram.scroller.verticalOffset) {\n                evt.preventDefault();\n            }\n        }\n        if (this.diagram.textEditing) {\n            this.diagram.isTriggerEvent = true;\n            if (this.diagram.activeLabel.parentId) {\n                var node = this.diagram.getObject(this.diagram.activeLabel.parentId);\n                this.diagram.startTextEdit(node, this.diagram.activeLabel.id);\n            }\n            this.diagram.isTriggerEvent = false;\n        }\n        this.diagram.blazorActions = this.diagram.blazorActions & ~BlazorAction.interaction;\n    };\n    /** @private */\n    DiagramEventHandler.prototype.keyDown = function (evt) {\n        if (!(this.diagram.diagramActions & DiagramAction.TextEdit) &&\n            !(this.checkEditBoxAsTarget(evt)) || (evt.key === 'Escape' || evt.keyCode === 27)) {\n            var i = void 0;\n            var inAction = 'inAction';\n            var command = void 0;\n            var keycode = evt.keyCode ? evt.keyCode : evt.which;\n            var key = evt.key;\n            var ctrlKey = this.isMetaKey(evt);\n            if (this.diagram.commandManager && this.diagram.commands) {\n                var commands = this.diagram.commands;\n                for (var _i = 0, _a = Object.keys(commands); _i < _a.length; _i++) {\n                    var i_1 = _a[_i];\n                    command = this.diagram.commands[i_1];\n                    if (command && (command.gesture.keyModifiers || command.gesture.key)) {\n                        if ((keycode === command.gesture.key || (key === Keys[command.gesture.key])\n                            || this.isDeleteKey(key, i_1))\n                            && (((!command.gesture.keyModifiers) && (!evt.altKey) && (!evt.shiftKey) && (!ctrlKey)) ||\n                                (command.gesture.keyModifiers && (ctrlKey || evt.altKey || evt.shiftKey) &&\n                                    (this.altKeyPressed(command.gesture.keyModifiers) && evt.altKey) ||\n                                    (this.shiftKeyPressed(command.gesture.keyModifiers) && evt.shiftKey) ||\n                                    (this.ctrlKeyPressed(command.gesture.keyModifiers) && ctrlKey)))) {\n                            var canExecute = getFunction(command.canExecute);\n                            if (isBlazor() || (canExecute &&\n                                canExecute({\n                                    'keyDownEventArgs': KeyboardEvent,\n                                    parameter: command.parameter\n                                }))) {\n                                evt.preventDefault();\n                                if (evt.key === 'Escape') {\n                                    if (this.checkEditBoxAsTarget(evt)) {\n                                        document.getElementById(this.diagram.diagramCanvas.id).focus();\n                                    }\n                                    else if (this.diagram.currentSymbol) {\n                                        var selectedSymbols = 'selectedSymbols';\n                                        var source = 'sourceElement';\n                                        var intDestroy = 'intDestroy';\n                                        this.diagram.removeFromAQuad(this.diagram.currentSymbol);\n                                        this.diagram.removeObjectsFromLayer(this.diagram.nameTable[this.diagram.currentSymbol.id]);\n                                        this.diagram.removeElements(this.diagram.currentSymbol);\n                                        removeChildNodes(this.diagram.currentSymbol, this.diagram);\n                                        delete this.diagram.nameTable[this.diagram.currentSymbol.id];\n                                        var sourceElement = this.diagram.droppable[source];\n                                        sourceElement.draggable[intDestroy]();\n                                        var element = this.diagram.droppable[selectedSymbols];\n                                        element.parentNode.removeChild(element);\n                                        var diagramActions = this.diagram.diagramActions;\n                                        this.diagram.diagramActions =\n                                            this.diagram.addConstraints(diagramActions, DiagramAction.PreventClearSelection);\n                                        this.tool.mouseUp(this.eventArgs);\n                                        this.diagram.diagramRenderer.rendererActions = this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions, RendererAction.DrawSelectorBorder);\n                                        if (this.diagram.previousSelectedObject) {\n                                            this.diagram.select(this.diagram.previousSelectedObject);\n                                        }\n                                        this.action = 'Select';\n                                        this.diagram.previousSelectedObject = null;\n                                        this.diagram.currentSymbol = null;\n                                        this.diagram.diagramActions =\n                                            this.diagram.removeConstraints(diagramActions, DiagramAction.PreventClearSelection);\n                                        this.isMouseDown = false;\n                                    }\n                                    else if (this.inAction && this.diagram.drawingObject && this.tool && this.tool[inAction]) {\n                                        this.tool.mouseUp(this.eventArgs);\n                                        this.tool = null;\n                                        this.isMouseDown = false;\n                                    }\n                                }\n                                if (command.execute) {\n                                    if (this.diagram.tool !== DiagramTools.ZoomPan) {\n                                        // if (i === 'nudgeUp' || i === 'nudgeRight' || i === 'nudgeDown' || i === 'nudgeLeft') {\n                                        //     command.execute()\n                                        // } else {\n                                        var execute = getFunction(command.execute);\n                                        execute({ 'keyDownEventArgs': KeyboardEvent, parameter: command.parameter });\n                                    }\n                                    // }\n                                }\n                                if (isBlazor()) {\n                                    var arg = { gesture: command.gesture };\n                                    this.diagram.triggerEvent(DiagramEvent.commandExecute, arg);\n                                }\n                                break;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        // eslint-disable-next-line\n        var selectedObject = (this.diagram.selectedItems.nodes.length) ?\n            this.diagram.selectedItems.nodes : this.diagram.selectedItems.connectors;\n        this.keyArgs = {\n            element: cloneBlazorObject(this.diagram.selectedItems),\n            key: evt.key, keyCode: evt.keyCode ? evt.keyCode : evt.which\n        };\n        this.getKeyModifier(this.keyArgs, evt);\n        if ((this.diagram.diagramActions & DiagramAction.TextEdit)) {\n            this.getlabel(this.keyArgs, evt);\n        }\n        this.diagram.triggerEvent(DiagramEvent.keyDown, this.keyArgs);\n    };\n    DiagramEventHandler.prototype.getlabel = function (args, evt) {\n        var label = this.diagram.activeLabel;\n        args.target = this.diagram.element.id + '_editBox';\n        var node = this.diagram.nameTable[label.parentId];\n        if (document.getElementById(this.diagram.element.id + '_editBox')) {\n            args.text = document.getElementById(this.diagram.element.id + '_editBox').value;\n            for (var i = 0; i < node.annotations.length; i++) {\n                if (node.annotations[i].id === label.id) {\n                    args.label = node.annotations[i];\n                    break;\n                }\n            }\n        }\n    };\n    DiagramEventHandler.prototype.getKeyModifier = function (args, evt) {\n        args.keyModifiers = KeyModifiers.None;\n        if (evt.ctrlKey) {\n            args.keyModifiers |= KeyModifiers.Control;\n        }\n        if (evt.shiftKey) {\n            args.keyModifiers |= KeyModifiers.Shift;\n        }\n        if (evt.altKey) {\n            args.keyModifiers |= KeyModifiers.Alt;\n        }\n        if (this.isMetaKey(evt)) {\n            args.keyModifiers |= KeyModifiers.Meta;\n        }\n    };\n    DiagramEventHandler.prototype.keyUp = function (evt) {\n        this.keyArgs = {\n            element: cloneBlazorObject(this.diagram.selectedItems), key: evt.key, keyCode: evt.keyCode ? evt.keyCode : evt.which\n        };\n        var selectedObject = (this.diagram.selectedItems.nodes.length) ?\n            this.diagram.selectedItems.nodes : this.diagram.selectedItems.connectors;\n        this.getKeyModifier(this.keyArgs, evt);\n        if ((this.diagram.diagramActions & DiagramAction.TextEdit)) {\n            this.getlabel(this.keyArgs, evt);\n        }\n        this.diagram.triggerEvent(DiagramEvent.keyUp, this.keyArgs);\n    };\n    DiagramEventHandler.prototype.startAutoScroll = function (e) {\n        var position = this.getMousePosition(e);\n        position.x *= this.diagram.scroller.currentZoom;\n        position.y *= this.diagram.scroller.currentZoom;\n        var rulerSize = getRulerSize(this.diagram);\n        var movingPosition;\n        var autoScrollBorder = this.diagram.scrollSettings.autoScrollBorder;\n        if (Browser.info.name === 'mozilla') {\n            if (this.diagram.scroller.viewPortWidth === 0) {\n                var bounds = document.getElementById(this.diagram.element.id).getBoundingClientRect();\n                if (bounds.width !== this.diagram.scroller.viewPortWidth) {\n                    this.diagram.scroller.setViewPortSize(bounds.width, bounds.height);\n                }\n            }\n        }\n        if (this.diagram.scrollSettings.canAutoScroll) {\n            if (position.x + this.diagram.scroller.horizontalOffset + autoScrollBorder.right + rulerSize.width >=\n                this.diagram.scroller.viewPortWidth - 18) {\n                movingPosition = 'right';\n            }\n            else if (position.x + this.diagram.scroller.horizontalOffset < autoScrollBorder.left) {\n                movingPosition = 'left';\n            }\n            else if (position.y + this.diagram.scroller.verticalOffset + autoScrollBorder.bottom + rulerSize.height >\n                this.diagram.scroller.viewPortHeight - 18) {\n                movingPosition = 'bottom';\n            }\n            else if (position.y + this.diagram.scroller.verticalOffset < autoScrollBorder.top) {\n                movingPosition = 'top';\n            }\n        }\n        return movingPosition;\n    };\n    DiagramEventHandler.prototype.doAutoScroll = function (option, e, delay, autoScroll) {\n        var position = option;\n        if ((this.tool instanceof NodeDrawingTool || this.tool instanceof ConnectorDrawingTool\n            || this.tool instanceof MoveTool || this.tool instanceof ResizeTool\n            || this.tool instanceof SelectTool) && this.inAction) {\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            var diagram = this;\n            var pos = this.getMousePosition(e);\n            var autoScrollBorder = this.diagram.scrollSettings.autoScrollBorder;\n            var newDelay = delay ? delay : 100;\n            var left = 0;\n            var top_1 = 0;\n            var point = { x: pos.x, y: pos.y };\n            switch (position) {\n                case 'right':\n                    point.x = pos.x + 10;\n                    left = 10;\n                    break;\n                case 'left':\n                    point.x = pos.x - 10;\n                    left = -10;\n                    break;\n                case 'bottom':\n                    point.y = pos.y + 10;\n                    top_1 = 10;\n                    break;\n                case 'top':\n                    point.y = pos.y - 10;\n                    top_1 = -10;\n                    break;\n            }\n            this.eventArgs.position = { x: point.x, y: point.y };\n            this.currentPosition = this.eventArgs.position;\n            var objects = this.objectFinder.findObjectsUnderMouse(this.currentPosition, this.diagram, this.eventArgs, null, this.action);\n            this.eventArgs.target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n            this.tool.mouseMove(this.eventArgs);\n            this.diagram.scrollActions |= ScrollActions.Interaction;\n            this.diagram.scroller.zoom(1, -left, -top_1, pos);\n            this.diagram.scrollActions &= ~ScrollActions.Interaction;\n        }\n    };\n    DiagramEventHandler.prototype.mouseEvents = function () {\n        var target = this.diagram.findObjectsUnderMouse(this.currentPosition);\n        for (var i = 0; i < target.length; i++) {\n            if (this.eventArgs.actualObject === target[i]) {\n                target.splice(i, 1);\n            }\n        }\n        var arg = {\n            targets: {}\n        };\n        if (!isBlazor()) {\n            arg = {\n                targets: cloneBlazorObject(target),\n                element: cloneBlazorObject((this.eventArgs.source === this.eventArgs.actualObject) ? undefined : this.eventArgs.source),\n                actualObject: cloneBlazorObject(this.eventArgs.actualObject)\n            };\n        }\n        if (isBlazor() && (this.diagram.mouseEnter || this.diagram.mouseOver)) {\n            arg.actualObject = getObjectType(this.eventArgs.actualObject) === Connector ? {\n                connector: cloneBlazorObject(this.eventArgs.actualObject)\n            }\n                : {\n                    node: cloneBlazorObject(this.eventArgs.actualObject)\n                };\n            arg.targets.connector = [];\n            arg.targets.node = [];\n            this.getBlazorCollectionObject(target, arg);\n        }\n        if (this.lastObjectUnderMouse && this.diagram.mouseLeave\n            && (!this.eventArgs.actualObject || (this.lastObjectUnderMouse !== this.eventArgs.actualObject))) {\n            var arg_1 = {\n                targets: undefined, element: cloneBlazorObject(this.lastObjectUnderMouse), actualObject: undefined\n            };\n            if (isBlazor()) {\n                arg_1 = {\n                    targets: undefined,\n                    element: getObjectType(this.lastObjectUnderMouse) === Connector ? { connector: cloneBlazorObject(target) }\n                        : {\n                            node: cloneBlazorObject(this.lastObjectUnderMouse)\n                        },\n                    actualObject: undefined\n                };\n            }\n            this.diagram.triggerEvent(DiagramEvent.mouseLeave, arg_1);\n            this.lastObjectUnderMouse = null;\n        }\n        if (!this.lastObjectUnderMouse && this.eventArgs.source || (this.lastObjectUnderMouse !== this.eventArgs.actualObject)) {\n            this.lastObjectUnderMouse = this.eventArgs.actualObject;\n            if (this.eventArgs.actualObject !== undefined) {\n                this.diagram.triggerEvent(DiagramEvent.mouseEnter, arg);\n            }\n        }\n        if (this.eventArgs.actualObject) {\n            this.diagram.triggerEvent(DiagramEvent.mouseOver, arg);\n        }\n    };\n    DiagramEventHandler.prototype.getBlazorCollectionObject = function (obj, arg1) {\n        if (obj) {\n            for (var i = 0; i < obj.length; i++) {\n                if (getObjectType(obj[i]) === Connector) {\n                    arg1.targets.connector.push(cloneBlazorObject(obj[i]));\n                }\n                else {\n                    arg1.targets.node.push(cloneBlazorObject(obj[i]));\n                }\n            }\n        }\n    };\n    DiagramEventHandler.prototype.elementEnter = function (mousePosition, elementOver) {\n        if (!elementOver) {\n            var isPrivateTooltip = ((this.hoverElement instanceof Node) &&\n                this.hoverElement.constraints & NodeConstraints.Tooltip) ||\n                ((this.hoverElement instanceof Connector) && this.hoverElement.constraints & ConnectorConstraints.Tooltip);\n            var content = this.getContent();\n            if (this.hoverElement.tooltip.openOn === 'Auto' && content !== '') {\n                updateTooltip(this.diagram, isPrivateTooltip ? this.hoverElement : undefined);\n            }\n            var offset = getTooltipOffset(this.diagram, mousePosition, this.hoverElement);\n            if (this.hoverElement.tooltip.openOn === 'Auto' && content !== '') {\n                this.diagram.tooltipObject.close();\n                this.diagram.tooltipObject.openOn = this.hoverElement.tooltip.openOn;\n                this.diagram.tooltipObject.offsetX = offset.x;\n                this.diagram.tooltipObject.offsetY = offset.y;\n                if (isBlazor()) {\n                    this.diagram.tooltipObject.open(this.diagram.element, {});\n                }\n                else {\n                    this.diagram.tooltipObject.dataBind();\n                }\n            }\n            if (canEnableToolTip(this.hoverElement, this.diagram) && this.hoverElement.tooltip.openOn === 'Auto') {\n                this.diagram.tooltipObject.open(this.diagram.element);\n            }\n        }\n    };\n    DiagramEventHandler.prototype.elementLeave = function () {\n        if (this.diagram.tooltipObject && this.diagram.tooltipObject.openOn !== 'Custom') {\n            this.diagram.tooltipObject.close();\n        }\n    };\n    DiagramEventHandler.prototype.altKeyPressed = function (keyModifier) {\n        if (keyModifier & KeyModifiers.Alt) {\n            return true;\n        }\n        return false;\n    };\n    DiagramEventHandler.prototype.ctrlKeyPressed = function (keyModifier) {\n        if (keyModifier & KeyModifiers.Control) {\n            return true;\n        }\n        return false;\n    };\n    DiagramEventHandler.prototype.shiftKeyPressed = function (keyModifier) {\n        if (keyModifier & KeyModifiers.Shift) {\n            return true;\n        }\n        return false;\n    };\n    /** @private */\n    DiagramEventHandler.prototype.scrolled = function (evt) {\n        this.diagram.updateScrollOffset();\n        if (isBlazor() && (this.diagram.realActions & RealAction.OverViewAction)) {\n            this.diagram.setBlazorDiagramProps(false);\n        }\n    };\n    /** @private */\n    DiagramEventHandler.prototype.doubleClick = function (evt) {\n        if (canUserInteract(this.diagram)) {\n            var annotation = void 0;\n            var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n            var obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n            if (obj !== null && canUserInteract(this.diagram)) {\n                var node = obj;\n                annotation = this.diagram.findElementUnderMouse(obj, this.currentPosition);\n                if (this.tool && (this.tool instanceof PolygonDrawingTool || this.tool instanceof PolyLineDrawingTool)) {\n                    var arg_2 = {\n                        source: cloneBlazorObject(obj) || cloneBlazorObject(this.diagram),\n                        position: this.currentPosition, count: evt.detail\n                    };\n                    this.tool.mouseUp(this.eventArgs);\n                    this.isMouseDown = false;\n                    this.eventArgs = {};\n                    this.tool = null;\n                    evt.preventDefault();\n                }\n                else {\n                    var layer = this.diagram.commandHandler.getObjectLayer(obj.id);\n                    if (layer && !layer.lock && layer.visible) {\n                        if (!(this.diagram.diagramActions & DiagramAction.TextEdit)) {\n                            var id = '';\n                            if (obj.shape.shape === 'TextAnnotation') {\n                                id = obj.wrapper.children[1].id.split('_')[1];\n                            }\n                            this.diagram.startTextEdit(obj, id || (annotation instanceof TextElement ?\n                                (annotation.id).split(obj.id + '_')[1] : undefined));\n                        }\n                    }\n                }\n            }\n            var arg = {\n                source: cloneBlazorObject(obj) || cloneBlazorObject(this.diagram),\n                position: this.currentPosition, count: evt.detail\n            };\n            if (isBlazor()) {\n                var selector = void 0;\n                if (obj instanceof Node) {\n                    selector = { nodes: [cloneBlazorObject(obj)] };\n                }\n                else if (obj instanceof Connector) {\n                    selector = { connectors: [cloneBlazorObject(obj)] };\n                }\n                else {\n                    selector = cloneBlazorObject(obj);\n                }\n                arg = {\n                    source: obj ? { selector: selector } : { diagram: cloneBlazorObject(this.diagram) },\n                    position: this.currentPosition, count: evt.detail\n                };\n            }\n            this.diagram.triggerEvent(DiagramEvent.doubleClick, arg);\n        }\n    };\n    /**\n     * @private\n     */\n    DiagramEventHandler.prototype.itemClick = function (actualTarget, diagram) {\n        var obj = actualTarget;\n        if (checkParentAsContainer(this.diagram, obj, true)) {\n            return obj;\n        }\n        return null;\n    };\n    /**\n     * @private\n     */\n    DiagramEventHandler.prototype.inputChange = function (evt) {\n        var minWidth = 90;\n        var maxWidth;\n        var minHeight = 12;\n        var fontsize;\n        var textWrapper;\n        var node;\n        var height;\n        var width;\n        var textBounds;\n        var textBoxWidth;\n        var transforms;\n        var scale;\n        var editTextBox = document.getElementById(this.diagram.element.id + '_editBox');\n        var editTextBoxDiv = document.getElementById(this.diagram.element.id + '_editTextBoxDiv');\n        var text = (editTextBox.value);\n        var line = text.split('\\n');\n        node = (this.diagram.selectedItems.nodes[0]) ? this.diagram.selectedItems.nodes[0] : this.diagram.selectedItems.connectors[0];\n        if ((!node && this.tool instanceof TextDrawingTool) || (node && node.shape.type === 'SwimLane')) {\n            node = this.diagram.nameTable[this.diagram.activeLabel.parentId];\n        }\n        if (node && ((node.shape.type !== 'Text' && node.annotations.length > 0) || (node.shape.type === 'Text'))) {\n            textWrapper = this.diagram.getWrapper(node.wrapper, this.diagram.activeLabel.id);\n            maxWidth = node.wrapper.bounds.width < textWrapper.bounds.width ? node.wrapper.bounds.width : textWrapper.bounds.width;\n            maxWidth = maxWidth > minWidth ? maxWidth : minWidth;\n            textBounds = measureHtmlText(textWrapper.style, text, undefined, undefined, maxWidth);\n            fontsize = Number((editTextBox.style.fontSize).split('px')[0]);\n            if (line.length > 1 && line[line.length - 1] === '') {\n                textBounds.height = textBounds.height + fontsize;\n            }\n            transforms = this.diagram.scroller.transform;\n            scale = canZoomTextEdit(this.diagram) ? transforms.scale : 1;\n            width = textBounds.width;\n            width = ((minWidth > width) ? minWidth : width) * scale;\n            height = ((minHeight > textBounds.height) ? minHeight : textBounds.height) * scale;\n            editTextBoxDiv.style.left = ((((textWrapper.bounds.center.x + transforms.tx) * transforms.scale) - width / 2) - 2.5) + 'px';\n            editTextBoxDiv.style.top = ((((textWrapper.bounds.center.y + transforms.ty) * transforms.scale) - height / 2) - 3) + 'px';\n            editTextBoxDiv.style.width = width + 'px';\n            editTextBoxDiv.style.height = height + 'px';\n            editTextBox.style.minHeight = minHeight + 'px';\n            editTextBox.style.minWidth = minWidth + 'px';\n            editTextBox.style.width = width + 'px';\n            editTextBox.style.height = height + 'px';\n        }\n    };\n    /**\n     * @private\n     */\n    DiagramEventHandler.prototype.isAddTextNode = function (node, focusOut) {\n        if (this.tool instanceof TextDrawingTool || focusOut) {\n            this.tool = null;\n            if (node && (!(canContinuousDraw(this.diagram)))) {\n                this.diagram.drawingObject = undefined;\n                this.diagram.currentDrawingObject = undefined;\n            }\n            if (getObjectFromCollection(this.diagram.nodes, node.id) ||\n                getObjectFromCollection(this.diagram.connectors, node.id) ||\n                (this.diagram.bpmnModule && this.diagram.bpmnModule.textAnnotationConnectors.indexOf(node) > -1)) {\n                return false;\n            }\n            return true;\n        }\n        return false;\n    };\n    DiagramEventHandler.prototype.checkEditBoxAsTarget = function (evt) {\n        if ((evt.target && evt.target.id === this.diagram.element.id + '_editBox')) {\n            return true;\n        }\n        return false;\n    };\n    DiagramEventHandler.prototype.getMouseEventArgs = function (position, args, source, padding) {\n        args.position = position;\n        var obj;\n        var objects;\n        if (!source) {\n            if (this.action === 'Drag' || this.action === 'ConnectorSourceEnd' || this.action === 'SegmentEnd' ||\n                this.action === 'OrthoThumb' || this.action === 'BezierSourceThumb' || this.action === 'BezierTargetThumb' ||\n                this.action === 'ConnectorTargetEnd' || this.action.indexOf('Rotate') !== -1 || this.action.indexOf('Resize') !== -1) {\n                obj = this.diagram.selectedItems;\n                if (!this.diagram.currentSymbol && this.action === 'Drag' && obj && this.diagram.selectedItems.nodes.length > 0 &&\n                    this.diagram.selectedItems.nodes[0].shape.type === 'SwimLane') {\n                    objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n                    obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n                }\n            }\n            else {\n                objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n                obj = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n            }\n        }\n        else {\n            objects = this.diagram.findObjectsUnderMouse(this.currentPosition, source);\n            obj = this.diagram.findTargetObjectUnderMouse(objects, this.action, this.inAction, args.position, source);\n        }\n        if (obj && obj.isHeader) {\n            obj = this.diagram.nameTable[obj.parentId];\n            this.eventArgs.actualObject = obj;\n        }\n        var wrapper;\n        if (obj) {\n            wrapper = this.diagram.findElementUnderMouse(obj, this.currentPosition, padding);\n            var currentConnector = void 0;\n            var nearNode = void 0;\n            var i = void 0;\n            if ((wrapper && obj.ports && obj.ports.length && !checkPort(obj, wrapper) || !wrapper ||\n                !obj) && objects && objects.length && (source instanceof Selector)) {\n                currentConnector = source.connectors[0];\n                for (i = objects.length - 1; i >= 0; i--) {\n                    nearNode = objects[i];\n                    if ((nearNode instanceof Node) && currentConnector && currentConnector.connectionPadding) {\n                        obj = nearNode;\n                        wrapper = this.diagram.findElementUnderMouse(obj, this.currentPosition, padding);\n                        if (((currentConnector.constraints & ConnectorConstraints.ConnectToNearByPort) && obj &&\n                            obj.ports && obj.ports.length && checkPort(obj, wrapper))) {\n                            break;\n                        }\n                        if ((nearNode instanceof Node) && currentConnector && currentConnector.connectionPadding\n                            && nearNode.wrapper.outerBounds.containsPoint(this.currentPosition) &&\n                            (currentConnector.constraints & ConnectorConstraints.ConnectToNearByNode) &&\n                            !(currentConnector.constraints & ConnectorConstraints.ConnectToNearByPort)) {\n                            obj = nearNode;\n                            wrapper = this.diagram.findElementUnderMouse(obj, this.currentPosition, 0);\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n        if (!source) {\n            args.source = obj;\n            args.sourceWrapper = wrapper;\n        }\n        else {\n            args.target = obj;\n            args.targetWrapper = wrapper;\n        }\n        args.actualObject = this.eventArgs.actualObject;\n        if (args.source instanceof Selector && args.actualObject === undefined &&\n            (args.source.nodes.length > 0 || args.source.connectors.length > 0)) {\n            args.actualObject = args.source.nodes.length > 0 ? this.diagram.nameTable[args.source.nodes[0].id]\n                : this.diagram.nameTable[args.source.connectors[0].id];\n        }\n        args.startTouches = this.touchStartList;\n        args.moveTouches = this.touchMoveList;\n        return args;\n    };\n    /** @private */\n    DiagramEventHandler.prototype.resetTool = function () {\n        this.action = 'Select';\n        this.hoverElement = null;\n        this.hoverNode = null;\n        this.tool = this.diagram.getTool(this.action);\n        this.updateCursor();\n    };\n    /** @private */\n    DiagramEventHandler.prototype.getTool = function (action) {\n        switch (action) {\n            case 'Select':\n                return new SelectTool(this.commandHandler, true);\n            case 'Drag':\n                return new MoveTool(this.commandHandler);\n            case 'Rotate':\n                return new RotateTool(this.commandHandler);\n            case 'LayoutAnimation':\n                return new ExpandTool(this.commandHandler);\n            case 'FixedUserHandle':\n                return new FixedUserHandleTool(this.commandHandler, true);\n            case 'Hyperlink':\n                return new LabelTool(this.commandHandler);\n            case 'ResizeSouthEast':\n            case 'ResizeSouthWest':\n            case 'ResizeNorthEast':\n            case 'ResizeNorthWest':\n            case 'ResizeSouth':\n            case 'ResizeNorth':\n            case 'ResizeWest':\n            case 'ResizeEast':\n                return new ResizeTool(this.commandHandler, action);\n            case 'ConnectorSourceEnd':\n            case 'ConnectorTargetEnd':\n            case 'BezierSourceThumb':\n            case 'BezierTargetThumb':\n                return new ConnectTool(this.commandHandler, action);\n            case 'SegmentEnd':\n            case 'OrthoThumb':\n                return new ConnectorEditing(this.commandHandler, action);\n            case 'Draw':\n                var shape = 'shape';\n                var basicShape = 'basicShape';\n                var type = findObjectType(this.diagram.drawingObject);\n                if (type === 'Node' && this.diagram.drawingObject.shape.type === 'Text') {\n                    return new TextDrawingTool(this.commandHandler);\n                }\n                else if (type === 'Node' && (this.diagram.drawingObject.shape[shape] === 'Polygon' ||\n                    (isBlazor() && this.diagram.drawingObject.shape[basicShape] === 'Polygon')) &&\n                    !(this.diagram.drawingObject.shape.points)) {\n                    return new PolygonDrawingTool(this.commandHandler);\n                }\n                else if (type === 'Node' ||\n                    (type === 'Node' && this.diagram.drawingObject.shape[shape] === 'Polygon' &&\n                        (this.diagram.drawingObject.shape.points))) {\n                    return new NodeDrawingTool(this.commandHandler, this.diagram.drawingObject);\n                }\n                else if (type === 'Connector' && this.diagram.drawingObject.type === 'Polyline') {\n                    return new PolyLineDrawingTool(this.commandHandler);\n                }\n                else if (type === 'Connector') {\n                    return new ConnectorDrawingTool(this.commandHandler, 'ConnectorSourceEnd', this.diagram.drawingObject);\n                }\n                break;\n            case 'Pan':\n                return new ZoomPanTool(this.commandHandler, false);\n            case 'PinchZoom':\n                return new ZoomPanTool(this.commandHandler, true);\n            case 'PortDrag':\n                return new MoveTool(this.commandHandler, 'Port');\n            case 'PortDraw':\n                return new ConnectorDrawingTool(this.commandHandler, 'ConnectorSourceEnd', this.diagram.drawingObject);\n            case 'LabelSelect':\n                return new SelectTool(this.commandHandler, true, 'LabelSelect');\n            case 'LabelDrag':\n                return new LabelDragTool(this.commandHandler);\n            case 'LabelResizeSouthEast':\n            case 'LabelResizeSouthWest':\n            case 'LabelResizeNorthEast':\n            case 'LabelResizeNorthWest':\n            case 'LabelResizeSouth':\n            case 'LabelResizeNorth':\n            case 'LabelResizeWest':\n            case 'LabelResizeEast':\n                return new LabelResizeTool(this.commandHandler, action);\n            case 'LabelRotate':\n                return new LabelRotateTool(this.commandHandler);\n            //for coverage\n            // case 'Custom':\n            //     return this.diagram.getTool(action);\n        }\n        return null;\n    };\n    /** @private */\n    DiagramEventHandler.prototype.getCursor = function (action) {\n        var object = (this.diagram.selectedItems.annotation) ?\n            this.diagram.selectedItems.wrapper.children[0] : this.diagram.selectedItems;\n        var rotateAngle = (this.diagram.selectedItems.annotation) ?\n            (object.rotateAngle + object.parentTransform) : object.rotateAngle;\n        return getCursor(action, rotateAngle);\n    };\n    //start region - interface betweend diagram and interaction\n    /** @private */\n    DiagramEventHandler.prototype.findElementUnderMouse = function (obj, position, padding) {\n        return this.objectFinder.findElementUnderSelectedItem(obj, position, padding);\n    };\n    /** @private */\n    DiagramEventHandler.prototype.findObjectsUnderMouse = function (position, source) {\n        return this.objectFinder.findObjectsUnderMouse(position, this.diagram, this.eventArgs, source);\n    };\n    /** @private */\n    DiagramEventHandler.prototype.findObjectUnderMouse = function (objects, action, inAction) {\n        return this.objectFinder.findObjectUnderMouse(this.diagram, objects, action, inAction, this.eventArgs, this.currentPosition);\n    };\n    /** @private */\n    DiagramEventHandler.prototype.findTargetUnderMouse = function (objects, action, inAction, position, source) {\n        return this.objectFinder.findObjectUnderMouse(this.diagram, objects, action, inAction, this.eventArgs, position, source);\n    };\n    /** @private */\n    DiagramEventHandler.prototype.findActionToBeDone = function (obj, wrapper, position, target) {\n        return findToolToActivate(obj, wrapper, this.currentPosition, this.diagram, this.touchStartList, this.touchMoveList, target);\n    };\n    DiagramEventHandler.prototype.updateContainerBounds = function (isAfterMouseUp) {\n        var isGroupAction = false;\n        if (this.diagram.selectedObject.helperObject && this.diagram.selectedObject.actualObject instanceof Node) {\n            var boundsUpdate = (this.tool instanceof ResizeTool) ? true : false;\n            var obj = this.diagram.selectedObject.actualObject;\n            var parentNode = this.diagram.nameTable[obj.parentId];\n            if (isAfterMouseUp) {\n                removeChildInContainer(this.diagram, obj, this.currentPosition, boundsUpdate);\n            }\n            else {\n                if (!parentNode || (parentNode && parentNode.shape.type !== 'SwimLane')) {\n                    this.diagram.updateDiagramObject(obj);\n                }\n                isGroupAction = updateCanvasBounds(this.diagram, obj, this.currentPosition, boundsUpdate);\n                this.diagram.updateSelector();\n                if (obj.isLane || obj.isPhase) {\n                    this.diagram.clearSelection();\n                    this.commandHandler.selectObjects([obj]);\n                }\n            }\n        }\n        return isGroupAction;\n    };\n    // tslint:disable-next-line:max-func-body-length\n    DiagramEventHandler.prototype.updateContainerProperties = function () {\n        var helperObject;\n        var isChangeProperties = false;\n        var hasStack;\n        var connectors;\n        var hasGroup = false;\n        var obj;\n        var history = { hasStack: false, isPreventHistory: false };\n        if (this.diagram.selectedObject.helperObject) {\n            var objects = this.diagram.findObjectsUnderMouse(this.currentPosition);\n            var target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n            helperObject = this.diagram.selectedObject.helperObject;\n            obj = this.diagram.selectedObject.actualObject;\n            if (obj instanceof Node) {\n                if (obj.shape.type === 'SwimLane') {\n                    connectors = getConnectors(this.diagram, obj.wrapper.children[0], 0, true);\n                }\n                if (obj.shape.type !== 'SwimLane' && obj.parentId &&\n                    this.diagram.getObject(obj.parentId).shape.type === 'SwimLane') {\n                    if (target instanceof Node && this.diagram.getObject(target.parentId) &&\n                        this.diagram.getObject(target.parentId).shape.type !== 'SwimLane') {\n                        target = this.diagram.getObject(target.parentId);\n                    }\n                }\n                if (this.currentAction === 'Drag' && obj.container && obj.container.type === 'Canvas' && obj.parentId &&\n                    this.diagram.getObject(obj.parentId).shape.type === 'SwimLane' && target && target !== obj &&\n                    target.container && target.container.type === 'Canvas' && target.isLane &&\n                    obj.isLane && target.parentId === obj.parentId) {\n                    laneInterChanged(this.diagram, obj, target, this.currentPosition);\n                    history.isPreventHistory = true;\n                }\n                else {\n                    var parentNode = this.diagram.nameTable[obj.parentId];\n                    if (!parentNode || (parentNode && parentNode.shape.type !== 'SwimLane')) {\n                        if (parentNode && parentNode.isLane && (obj.constraints & NodeConstraints.AllowMovingOutsideLane)) {\n                            var swimlane = this.diagram.getObject(parentNode.parentId);\n                            var laneId = swimlane.id + swimlane.shape.lanes[0].id + '0';\n                            var firstlane = this.diagram.getObject(laneId);\n                            var x = firstlane.wrapper.bounds.x;\n                            var y = firstlane.wrapper.bounds.y;\n                            var width = swimlane.wrapper.bounds.bottomRight.x - x;\n                            var height = swimlane.wrapper.bounds.bottomRight.y - y;\n                            var swimlaneBounds = new Rect(x, y, width, height);\n                            if (swimlaneBounds.containsPoint(this.currentPosition)) {\n                                obj.offsetX = helperObject.offsetX;\n                                obj.offsetY = helperObject.offsetY;\n                                obj.width = helperObject.width;\n                                obj.height = helperObject.height;\n                                obj.rotateAngle = helperObject.rotateAngle;\n                            }\n                        }\n                        else {\n                            obj.offsetX = helperObject.offsetX;\n                            obj.offsetY = helperObject.offsetY;\n                            if (obj && obj.shape && obj.shape.type !== 'UmlClassifier') {\n                                if (obj.shape.type !== 'Bpmn' ||\n                                    (obj.shape.type === 'Bpmn' && obj.shape.shape !== 'TextAnnotation')) {\n                                    obj.width = helperObject.width;\n                                    obj.height = helperObject.height;\n                                }\n                            }\n                            obj.rotateAngle = helperObject.rotateAngle;\n                        }\n                    }\n                    var undoElement = void 0;\n                    if (parentNode && parentNode.container && parentNode.container.type === 'Stack') {\n                        this.diagram.startGroupAction();\n                        hasGroup = true;\n                    }\n                    if (!target && parentNode && parentNode.container && parentNode.container.type === 'Stack' && this.action === 'Drag') {\n                        var index = parentNode.wrapper.children.indexOf(obj.wrapper);\n                        undoElement = { targetIndex: undefined, target: undefined, sourceIndex: index, source: clone(obj) };\n                        if (index > -1) {\n                            var children = parentNode.children;\n                            children.splice(children.indexOf(obj.id), 1);\n                            this.diagram.nameTable[obj.id].parentId = '';\n                            hasStack = true;\n                            parentNode.wrapper.children.splice(index, 1);\n                        }\n                    }\n                    moveChildInStack(obj, target, this.diagram, this.action);\n                    parentNode = checkParentAsContainer(this.diagram, obj) ? this.diagram.nameTable[obj.parentId] :\n                        (this.diagram.nameTable[obj.parentId] || obj);\n                    if (parentNode && parentNode.container && parentNode.container.type === 'Canvas') {\n                        parentNode.wrapper.maxWidth = parentNode.maxWidth = parentNode.wrapper.actualSize.width;\n                        parentNode.wrapper.maxHeight = parentNode.maxHeight = parentNode.wrapper.actualSize.height;\n                        isChangeProperties = true;\n                    }\n                    if (checkParentAsContainer(this.diagram, obj, true) && parentNode && parentNode.container.type === 'Canvas') {\n                        checkChildNodeInContainer(this.diagram, obj);\n                    }\n                    else {\n                        history = this.updateContainerPropertiesExtend(parentNode, obj, connectors, helperObject, history);\n                    }\n                    if ((this.diagram.lineRoutingModule && (this.diagram.constraints & DiagramConstraints.LineRouting))\n                        && (!checkParentAsContainer(this.diagram, obj, true))) {\n                        if (obj.children) {\n                            this.diagram.realActions |= RealAction.EnableGroupAction;\n                        }\n                        this.diagram.nodePropertyChange(obj, {}, {\n                            width: obj.width, height: obj.height,\n                            offsetX: obj.offsetX, offsetY: obj.offsetY\n                        });\n                        if (obj.children) {\n                            this.diagram.realActions &= ~RealAction.EnableGroupAction;\n                        }\n                    }\n                    if (obj.shape.lanes) {\n                        this.updateLaneChildNode(obj);\n                    }\n                    if (isChangeProperties) {\n                        parentNode.maxWidth = parentNode.wrapper.maxWidth = undefined;\n                        parentNode.maxHeight = parentNode.wrapper.maxHeight = undefined;\n                    }\n                    if (hasStack) {\n                        this.diagram.nodePropertyChange(parentNode, {}, {\n                            offsetX: parentNode.offsetX, offsetY: parentNode.offsetY, width: parentNode.width, height: parentNode.height,\n                            rotateAngle: parentNode.rotateAngle\n                        });\n                        var entry = {\n                            redoObject: { sourceIndex: undefined, source: undoElement.source },\n                            type: 'StackChildPositionChanged', undoObject: undoElement, category: 'Internal'\n                        };\n                        if (!(this.diagram.diagramActions & DiagramAction.UndoRedo)) {\n                            this.diagram.addHistoryEntry(entry);\n                        }\n                    }\n                    if (obj && obj.container && (obj.container.type === 'Stack' ||\n                        (obj.container.type === 'Canvas' && obj.parentId === ''))) {\n                        if (obj && obj.shape && obj.shape.type === 'UmlClassifier') {\n                            obj.wrapper.measureChildren = true;\n                        }\n                        this.diagram.nodePropertyChange(obj, {}, {\n                            offsetX: obj.offsetX, offsetY: obj.offsetY, width: obj.width, height: obj.height, rotateAngle: obj.rotateAngle\n                        });\n                        if (obj && obj.shape && obj.shape.type === 'UmlClassifier') {\n                            obj.wrapper.measureChildren = false;\n                        }\n                    }\n                }\n                updateConnectorsProperties(connectors, this.diagram);\n                history.hasStack = hasGroup;\n            }\n        }\n        if (obj && (obj.isPhase || obj.isLane ||\n            (obj.shape && obj.shape.type === 'SwimLane'))) {\n            this.diagram.updateDiagramElementQuad();\n        }\n        return history;\n    };\n    DiagramEventHandler.prototype.updateLaneChildNode = function (obj) {\n        for (var i = 0; i < (obj.shape.lanes.length); i++) {\n            if (obj.shape.lanes[i].children && obj.shape.lanes[i].children.length > 0) {\n                for (var j = 0; j < obj.shape.lanes[i].children.length; j++) {\n                    var id = obj.shape.lanes[i].children[j].id;\n                    var childNode = this.diagram.nameTable[id];\n                    childNode.offsetX = childNode.wrapper.offsetX;\n                    childNode.offsetY = childNode.wrapper.offsetY;\n                }\n            }\n        }\n    };\n    DiagramEventHandler.prototype.updateContainerPropertiesExtend = function (parentNode, obj, connectors, helperObject, history) {\n        if (this.currentAction === 'ResizeEast' || this.currentAction === 'ResizeSouth' || obj.shape.type === 'SwimLane') {\n            var undoObj = cloneObject(obj);\n            var isUpdateRow = false;\n            if (parentNode && parentNode.container && parentNode.container.type === 'Grid') {\n                var shape = parentNode.shape.type === 'SwimLane' ? true : false;\n                var container = (shape ? parentNode.wrapper.children[0] : parentNode.wrapper);\n                var padding = shape ? parentNode.shape.padding : undefined;\n                var x = parentNode.wrapper.bounds.x;\n                var y = parentNode.wrapper.bounds.y;\n                if (obj.columnIndex !== undefined && (parentNode.container.orientation === 'Horizontal' &&\n                    ((shape && obj.isPhase) || (!shape && obj.rowIndex === 1))) ||\n                    (parentNode.container.orientation === 'Vertical' &&\n                        ((!shape && obj.rowIndex > 0 && obj.columnIndex > 0) || (shape && obj.isLane)))) {\n                    if (parentNode.container.orientation === 'Horizontal' && obj.isPhase && obj.wrapper.width > obj.maxWidth) {\n                        obj.maxWidth = obj.wrapper.width;\n                        obj.wrapper.maxWidth = obj.wrapper.width;\n                    }\n                    updateSwimLaneObject(this.diagram, obj, parentNode, helperObject);\n                    container.updateColumnWidth(obj.columnIndex, helperObject.width, true, padding);\n                    if (obj.isPhase) {\n                        var id = parentNode.shape.phases[obj.columnIndex].header.id;\n                        var node = this.diagram.nameTable[id];\n                        if (node.maxWidth < helperObject.width) {\n                            node.maxWidth = helperObject.width;\n                            node.wrapper.maxWidth = helperObject.width;\n                        }\n                    }\n                    if (parentNode.shape.type === 'SwimLane') {\n                        parentNode.width = (parentNode.width) ? container.width : parentNode.width;\n                        updateHeaderMaxWidth(this.diagram, parentNode);\n                        parentNode.wrapper.width = parentNode.width;\n                        connectors = getConnectors(this.diagram, container, obj.rowIndex, false);\n                    }\n                }\n                else if (obj.rowIndex !== undefined) {\n                    isUpdateRow = true;\n                    updateSwimLaneObject(this.diagram, obj, parentNode, helperObject);\n                    container.updateRowHeight(obj.rowIndex, helperObject.height, true, padding);\n                    if (parentNode.shape.type === 'SwimLane') {\n                        parentNode.height = (parentNode.height) ? container.height : parentNode.height;\n                        parentNode.wrapper.height = parentNode.height;\n                        connectors = getConnectors(this.diagram, container, obj.rowIndex, true);\n                    }\n                }\n                if (parentNode.shape.type === 'SwimLane') {\n                    history.isPreventHistory = true;\n                }\n                this.diagram.nodePropertyChange(parentNode, {}, {\n                    offsetX: parentNode.offsetX, offsetY: parentNode.offsetY,\n                    rotateAngle: parentNode.rotateAngle\n                });\n                this.diagram.drag(parentNode, x - parentNode.wrapper.bounds.x, y - parentNode.wrapper.bounds.y);\n            }\n            else {\n                if (obj && obj.shape && obj.shape.type === 'UmlClassifier') {\n                    obj.wrapper.measureChildren = true;\n                }\n                this.diagram.nodePropertyChange(obj, {}, {\n                    offsetX: obj.offsetX, offsetY: obj.offsetY, width: obj.width, height: obj.height, rotateAngle: obj.rotateAngle\n                });\n                obj.wrapper.measureChildren = false;\n            }\n            obj.wrapper.measure(new Size(obj.wrapper.width, obj.wrapper.height));\n            obj.wrapper.arrange(obj.wrapper.desiredSize);\n            if (this.currentAction === 'ResizeEast' || this.currentAction === 'ResizeSouth') {\n                var redoObject = cloneObject(obj);\n                var entry = {\n                    category: 'Internal',\n                    type: (isUpdateRow) ? 'RowHeightChanged' : 'ColumnWidthChanged',\n                    undoObject: undoObj, redoObject: redoObject\n                };\n                this.diagram.addHistoryEntry(entry);\n            }\n        }\n        updateConnectorsProperties(connectors, this.diagram);\n        return history;\n    };\n    DiagramEventHandler.prototype.addUmlNode = function () {\n        var node = this.diagram.selectedItems.nodes[0];\n        var objects = this.diagram.findObjectsUnderMouse({ x: this.currentPosition.x + 20, y: this.currentPosition.y });\n        var target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n        if (!target) {\n            objects = this.diagram.findObjectsUnderMouse({ x: this.currentPosition.x - 20, y: this.currentPosition.y });\n            target = this.diagram.findObjectUnderMouse(objects, this.action, this.inAction);\n        }\n        if (node && node.container && node.container.type === 'Stack' && target && target.parentId\n            && target.parentId === node.id) {\n            var innerNode = target;\n            var adornerSvg = getAdornerLayerSvg(this.diagram.element.id);\n            var highlighter = adornerSvg.getElementById(adornerSvg.id + '_stack_highlighter');\n            if (highlighter) {\n                var index = node.wrapper.children.indexOf(target.wrapper) + 1;\n                this.diagram.enableServerDataBinding(false);\n                var temp = new Node(this.diagram, 'nodes', {\n                    style: {\n                        fill: node.style.fill,\n                        strokeColor: (node.style.strokeColor === 'black') ? '#ffffff00' : node.style.strokeColor\n                    },\n                    annotations: target.annotations, verticalAlignment: 'Stretch', horizontalAlignment: 'Stretch',\n                    constraints: (NodeConstraints.Default | NodeConstraints.HideThumbs) & ~(NodeConstraints.Rotate | NodeConstraints.Drag | NodeConstraints.Resize),\n                    minHeight: 25\n                }, true);\n                temp.annotations[0].content = ' + Name : Type';\n                var id = innerNode.id.split('_');\n                temp.id = randomId() + temp.id;\n                temp.parentId = node.id;\n                temp.zIndex = -1;\n                temp.umlIndex = index;\n                this.diagram.startGroupAction();\n                var redoElement = {\n                    sourceIndex: node.wrapper.children.indexOf(temp.wrapper), source: temp,\n                    target: undefined, targetIndex: undefined\n                };\n                this.diagram.enableServerDataBinding(true);\n                this.diagram.add(temp);\n                this.diagram.updateConnectorEdges(node);\n                this.diagram.clearSelection();\n                this.diagram.select([this.diagram.nameTable[temp.id]]);\n                this.diagram.endGroupAction();\n                this.diagram.startTextEdit();\n            }\n        }\n    };\n    return DiagramEventHandler;\n}());\nexport { DiagramEventHandler };\n/** @private */\nvar ObjectFinder = /** @class */ (function () {\n    function ObjectFinder() {\n    }\n    /** @private */\n    ObjectFinder.prototype.findObjectsUnderMouse = function (pt, diagram, eventArgs, source, actions) {\n        // finds the collection of the object that is under the mouse;\n        var actualTarget = [];\n        if (source && source instanceof Selector) {\n            if (source.nodes.length + source.connectors.length === 1) {\n                source = (source.nodes[0] || source.connectors[0]);\n                if (source.children && source.children.length === 0) {\n                    eventArgs.actualObject = source;\n                }\n            }\n        }\n        var container;\n        var bounds;\n        var child;\n        var matrix;\n        var endPadding = (source && (source instanceof Connector) &&\n            ((source.constraints & ConnectorConstraints.ConnectToNearByNode) ||\n                (source.constraints & ConnectorConstraints.ConnectToNearByPort)) && source.connectionPadding) || 0;\n        var objArray = diagram.spatialSearch.findObjects(new Rect(pt.x - 50 - endPadding, pt.y - 50 - endPadding, 100 + endPadding, 100 + endPadding));\n        var layerObjTable = {};\n        var layerTarger;\n        for (var _i = 0, objArray_1 = objArray; _i < objArray_1.length; _i++) {\n            var obj = objArray_1[_i];\n            var point = pt;\n            bounds = obj.wrapper.outerBounds;\n            var pointInBounds = (obj.rotateAngle) ? false : bounds.containsPoint(point, endPadding);\n            if ((obj !== source || diagram.currentDrawingObject instanceof Connector) &&\n                (obj instanceof Connector) ? obj !== diagram.currentDrawingObject : true && obj.wrapper.visible) {\n                var layer = diagram.commandHandler.getObjectLayer(obj.id);\n                if (layer && !layer.lock && layer.visible) {\n                    layerTarger = layerObjTable[layer.zIndex] = layerObjTable[layer.zIndex] || [];\n                    if (obj.rotateAngle) {\n                        container = obj.wrapper;\n                        bounds = cornersPointsBeforeRotation(container);\n                        for (var _a = 0, _b = container.children; _a < _b.length; _a++) {\n                            child = _b[_a];\n                            matrix = identityMatrix();\n                            rotateMatrix(matrix, -(child.rotateAngle + child.parentTransform), child.offsetX, child.offsetY);\n                            point = transformPointByMatrix(matrix, pt);\n                            if (cornersPointsBeforeRotation(child).containsPoint(point, endPadding)) {\n                                pointInBounds = true;\n                            }\n                        }\n                    }\n                    if (!source || (isSelected(diagram, obj) === false)) {\n                        if (canEnablePointerEvents(obj, diagram)) {\n                            if ((obj instanceof Connector) ? isPointOverConnector(obj, pt) : pointInBounds) {\n                                var padding = (obj instanceof Connector) ? obj.hitPadding || 0 : 0; //let element: DiagramElement;\n                                var element = this.findElementUnderMouse(obj, pt, endPadding || padding);\n                                if (element && obj.id !== 'helper') {\n                                    insertObject(obj, 'zIndex', layerTarger);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        for (var _c = 0, _d = diagram.layers; _c < _d.length; _c++) {\n            var layer = _d[_c];\n            actualTarget = actualTarget.concat(layerObjTable[layer.zIndex] || []);\n            for (var _e = 0, actualTarget_1 = actualTarget; _e < actualTarget_1.length; _e++) {\n                var obj = actualTarget_1[_e];\n                var eventHandler = 'eventHandler';\n                if (obj.shape.type === 'Bpmn' && obj.processId && (!(diagram[eventHandler].tool instanceof MoveTool) ||\n                    (diagram[eventHandler].tool instanceof MoveTool) && canAllowDrop(obj))) {\n                    var index = actualTarget.indexOf(diagram.nameTable[obj.processId]);\n                    if (index > -1) {\n                        actualTarget.splice(index, 1);\n                    }\n                }\n                if (obj.shape.type === 'UmlClassifier' && obj.container && obj.container.type === 'Stack') {\n                    var index = actualTarget.indexOf(diagram.nameTable[diagram.nameTable[obj.id].wrapper.children[0].id]);\n                    if (index > -1) {\n                        actualTarget.splice(index, 1);\n                    }\n                }\n            }\n        }\n        for (var i = 0; i < actualTarget.length; i++) {\n            var parentObj = diagram.nameTable[actualTarget[i].parentId];\n            if (parentObj) {\n                var portElement = this.findElementUnderMouse(parentObj, pt);\n                for (var j = 0; j < parentObj.ports.length; j++) {\n                    if (portElement.id.match('_' + parentObj.ports[j].id + '$')) {\n                        var port = parentObj.ports[j];\n                        if (canDrag(port, diagram) || canDraw(port, diagram)) {\n                            return actualTarget;\n                        }\n                    }\n                }\n            }\n            while (parentObj) {\n                var index = actualTarget.indexOf(parentObj);\n                if (index !== -1) {\n                    actualTarget.splice(index, 1);\n                }\n                else {\n                    break;\n                }\n                parentObj = diagram.nameTable[parentObj.parentId];\n            }\n        }\n        this.checkSwimlane(actualTarget, diagram);\n        if (eventArgs && !eventArgs.source) {\n            for (var i = 0; i < actualTarget.length; i++) {\n                var parentNode = diagram.nameTable[actualTarget[i].parentId];\n                if (parentNode && parentNode.shape.type === 'SwimLane') {\n                    for (var j = 0; j < actualTarget.length; j++) {\n                        var connector = actualTarget[j];\n                        if (connector instanceof Connector) {\n                            actualTarget.splice(i, 1);\n                        }\n                    }\n                }\n            }\n        }\n        return actualTarget;\n    };\n    /** @private */\n    ObjectFinder.prototype.checkSwimlane = function (actualTarget, diagram) {\n        var isNode;\n        for (var m = 0; m < actualTarget.length; m++) {\n            var obj = actualTarget[m];\n            var parentNode = void 0;\n            var node = void 0;\n            if (obj instanceof Node) {\n                parentNode = actualTarget[m].parentId;\n                node = obj;\n            }\n            if (parentNode === '') {\n                isNode = true;\n            }\n            var parent_1 = diagram.nameTable[parentNode];\n            if (parent_1 && parent_1.isLane && diagram.nameTable[parent_1.parentId].zIndex > obj.zIndex) {\n                actualTarget[m] = parent_1;\n            }\n            if (m > 0 && isNode && node && (node.isLane || node.isPhase || node.isHeader)) {\n                if (actualTarget[m].zIndex < actualTarget[m - 1].zIndex) {\n                    var swap = actualTarget[m];\n                    actualTarget[m] = actualTarget[m - 1];\n                    actualTarget[m - 1] = swap;\n                }\n            }\n        }\n        if (actualTarget.length >= 2) {\n            var parent_2 = '';\n            for (var i = actualTarget.length - 1; i >= 0; i--) {\n                if (actualTarget[i].parentId) {\n                    var parent1 = findParentInSwimlane(actualTarget[i], diagram, parent_2);\n                    var parent2 = findParentInSwimlane(actualTarget[i - 1], diagram, parent_2);\n                    var parentNode1 = diagram.nameTable[parent1];\n                    var parentNode2 = diagram.nameTable[parent2];\n                    if (parentNode2 && parent1 !== parent2 && parentNode1.zIndex < parentNode2.zIndex) {\n                        actualTarget.splice(i, 1);\n                    }\n                }\n            }\n        }\n    };\n    /** @private */\n    ObjectFinder.prototype.isTarget = function (actualTarget, diagram, action) {\n        var connector = diagram.selectedItems.connectors[0];\n        var node;\n        node = action === 'ConnectorSourceEnd' ? diagram.nameTable[connector.targetID] :\n            node = diagram.nameTable[connector.sourceID];\n        if (node && (!node.processId && !actualTarget.processId || node.processId !== actualTarget.processId)) {\n            if (node.processId !== actualTarget.processId) {\n                actualTarget = null;\n            }\n            if (actualTarget && actualTarget.parentId &&\n                diagram.nameTable[actualTarget.parentId].shape.type === 'UmlClassifier') {\n                actualTarget = diagram.nameTable[actualTarget.parentId];\n            }\n        }\n        if (action === 'ConnectorSourceEnd' && connector.targetID) {\n            var targetNode = diagram.nameTable[connector.targetID];\n            if (targetNode && targetNode.shape && (targetNode.shape.shape === 'TextAnnotation')) {\n                var id = connector.id.split('_');\n                if (((targetNode.shape.type === 'Bpmn') && actualTarget.shape.type !== 'Bpmn') || (id[0] === actualTarget.id) ||\n                    actualTarget.shape.shape === 'TextAnnotation') {\n                    actualTarget = null;\n                }\n                if (actualTarget.parentId &&\n                    diagram.nameTable[actualTarget.parentId].shape.type === 'UmlClassifier') {\n                    actualTarget = diagram.nameTable[actualTarget.parentId];\n                }\n            }\n        }\n        return actualTarget;\n    };\n    /* tslint:disable */\n    /** @private */\n    ObjectFinder.prototype.findObjectUnderMouse = function (diagram, objects, action, inAction, eventArg, position, source) {\n        //we will get the wrapper object here\n        //we have to choose the object to be interacted with from the given wrapper\n        //Find the object that is under mouse\n        var eventHandler = 'eventHandler';\n        var endPoint = 'endPoint';\n        var inPort;\n        var outPort;\n        var actualTarget = null;\n        if (objects.length !== 0) {\n            if (source && source instanceof Selector) {\n                if (source.nodes.length + source.connectors.length === 1) {\n                    source = (source.nodes[0] || source.connectors[0]);\n                }\n            }\n            if ((action === 'ConnectorSourceEnd' && source || action === 'PortDraw') ||\n                ((canDrawOnce(diagram) || canContinuousDraw(diagram)) && getObjectType(diagram.drawingObject) === Connector)) {\n                var connector = diagram.selectedItems.connectors[0];\n                for (var i = objects.length - 1; i >= 0; i--) {\n                    outPort = getInOutConnectPorts(objects[i], false);\n                    inPort = getInOutConnectPorts(objects[i], true);\n                    var tool = diagram[eventHandler].tool;\n                    var portElement = this.findTargetElement(objects[i].wrapper, position, undefined);\n                    if (action === 'Draw' && portElement && (objects[i] instanceof Node) && !checkPort(objects[i], portElement)) {\n                        if (((tool && tool[endPoint] === 'ConnectorSourceEnd') && !canOutConnect(objects[i])) ||\n                            ((tool && tool[endPoint] === 'ConnectorTargetEnd') && !canInConnect(objects[i]))) {\n                            return actualTarget;\n                        }\n                    }\n                    // eslint-disable-next-line max-len\n                    if (objects[i] instanceof Node && ((canOutConnect(objects[i]) || (canPortOutConnect(outPort)) || canInConnect(objects[i]) || (canPortInConnect(inPort))) ||\n                        (action === 'PortDraw' && (tool instanceof ConnectTool) && tool[endPoint] === 'ConnectorTargetEnd' &&\n                            (canInConnect(objects[i]) || (canPortInConnect(inPort)))))) {\n                        actualTarget = objects[i];\n                        if (connector) {\n                            actualTarget = this.isTarget(actualTarget, diagram, action);\n                        }\n                        eventArg.actualObject = actualTarget;\n                        return actualTarget;\n                    }\n                }\n            }\n            else if (action === 'ConnectorTargetEnd' && source) {\n                for (var i = objects.length - 1; i >= 0; i--) {\n                    inPort = getInOutConnectPorts(objects[i], true);\n                    if (objects[i] instanceof Node && (canInConnect(objects[i]) || (canPortInConnect(inPort)))) {\n                        actualTarget = objects[i];\n                        actualTarget = this.isTarget(actualTarget, diagram, action);\n                        eventArg.actualObject = actualTarget;\n                        return actualTarget;\n                    }\n                }\n            }\n            else if (source && (action === 'Drag' || (diagram[eventHandler].tool instanceof MoveTool))) {\n                var index = 0;\n                for (var i = 0; i < objects.length; i++) {\n                    var temp = objects[i];\n                    if (source !== temp && (temp instanceof Connector ||\n                        !position || temp.wrapper.bounds.containsPoint(position))) {\n                        if (canAllowDrop(temp)) {\n                            if (!actualTarget) {\n                                actualTarget = temp;\n                                index = actualTarget.zIndex;\n                            }\n                            else {\n                                actualTarget = index >= temp.zIndex ? actualTarget : temp;\n                                index = Math.max(index, temp.zIndex);\n                            }\n                        }\n                    }\n                }\n                if (actualTarget && actualTarget.shape.type === 'Bpmn') {\n                    if (diagram.selectedItems.nodes.length > 0 && diagram.selectedItems.nodes[0].shape.type === 'Bpmn') {\n                        // eslint-disable-next-line no-self-assign\n                        actualTarget = actualTarget;\n                    }\n                    else {\n                        actualTarget = null;\n                    }\n                }\n                if (actualTarget) {\n                    eventArg.actualObject = actualTarget;\n                }\n                return actualTarget;\n            }\n            else if ((action === 'Select' || action === 'Pan') && diagram[eventHandler].tool) {\n                for (var i = objects.length - 1; i >= 0; i--) {\n                    if (objects[i] instanceof Connector) {\n                        var objj1 = objects[i - 1];\n                        if (objects[i - 1] instanceof Node && objj1.ports) {\n                            var portElement = this.findTargetElement(objj1.wrapper, position, undefined);\n                            if ((portElement && (portElement.id.match('_icon_content_shape$') || portElement.id.match('_icon_content_rect$')))) {\n                                return objj1;\n                            }\n                            for (var j = 0; j < objj1.ports.length; j++) {\n                                if (portElement && portElement.id.match('_' + objj1.ports[j].id + '$')) {\n                                    if (canDraw(objj1.ports[j], diagram)) {\n                                        return objj1;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n                actualTarget = objects[objects.length - 1];\n                eventArg.actualObject = actualTarget;\n                if (!diagram[eventHandler].itemClick(actualTarget, true)) {\n                    if (actualTarget.parentId) {\n                        var obj = actualTarget;\n                        var selected = isSelected(diagram, obj);\n                        while (obj) {\n                            if (isSelected(diagram, obj) && !selected) {\n                                break;\n                            }\n                            actualTarget = obj;\n                            obj = diagram.nameTable[obj.parentId];\n                        }\n                    }\n                }\n            }\n            else if (action === 'Pan' || action === 'LayoutAnimation') {\n                for (var i = objects.length - 1; i >= 0; i--) {\n                    if (objects[i] instanceof Node || objects[i] instanceof Connector) {\n                        var portElement = this.findTargetElement(objects[i].wrapper, position, undefined);\n                        if ((action === 'Pan') || ((portElement && (portElement.id.match('_icon_content_shape$') || portElement.id.match('_icon_content_rect$'))))) {\n                            return objects[i];\n                        }\n                    }\n                }\n            }\n            else {\n                actualTarget = objects[objects.length - 1];\n                if (eventArg && actualTarget) {\n                    eventArg.actualObject = actualTarget;\n                }\n            }\n        }\n        return actualTarget;\n    };\n    /* tslint:enable */\n    /** @private */\n    ObjectFinder.prototype.findElementUnderSelectedItem = function (obj, position, padding) {\n        //rewrite this for multiple selection\n        if (obj instanceof Selector) {\n            if (obj.nodes.length === 1 && (!obj.connectors || !obj.connectors.length)) {\n                return this.findElementUnderMouse(obj.nodes[0], position);\n            }\n            else if ((!obj.nodes || obj.nodes.length) && obj.connectors.length === 1) {\n                return this.findElementUnderMouse(obj.connectors[0], position);\n            }\n        }\n        else {\n            return this.findElementUnderMouse(obj, position, padding);\n        }\n        return null;\n    };\n    ObjectFinder.prototype.findElementUnderMouse = function (obj, position, padding) {\n        return this.findTargetElement(obj.wrapper, position, padding);\n    };\n    /** @private */\n    ObjectFinder.prototype.findTargetElement = function (container, position, padding) {\n        for (var i = container.children.length - 1; i >= 0; i--) {\n            var element = container.children[i];\n            if (element && element.outerBounds.containsPoint(position, padding || 0)) {\n                if (element instanceof Container) {\n                    var target = this.findTargetElement(element, position);\n                    if (target) {\n                        return target;\n                    }\n                }\n                if (element.bounds.containsPoint(position, padding || 0)) {\n                    return element;\n                }\n            }\n        }\n        if (container.bounds.containsPoint(position, padding) && container.style.fill !== 'none') {\n            return container;\n        }\n        return null;\n    };\n    return ObjectFinder;\n}());\n"]},"metadata":{},"sourceType":"module"}