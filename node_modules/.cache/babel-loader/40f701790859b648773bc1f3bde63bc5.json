{"ast":null,"code":"/* eslint-disable jsdoc/require-param */\n\n/* eslint-disable @typescript-eslint/no-unused-vars */\n\n/* eslint-disable @typescript-eslint/ban-types */\n\n/* eslint-disable valid-jsdoc */\n\n/* eslint-disable jsdoc/require-returns */\n\n/* eslint-disable @typescript-eslint/no-this-alias */\nimport { Browser, isBlazor } from '@syncfusion/ej2-base';\nimport { CanvasRenderer } from './rendering/canvas-renderer';\nimport { DiagramRenderer } from './rendering/renderer';\nimport { Size } from './primitives/size';\nimport { SnapConstraints } from './enum/enum';\nimport { setAttributeHtml, setAttributeSvg, createHtmlElement } from './utility/dom-util';\nimport { Rect } from './primitives/rect';\nimport { createSvgElement, getHTMLLayer } from './utility/dom-util';\nimport { getDiagramLayerSvg } from './utility/dom-util';\nimport { checkBrowserInfo } from './utility/diagram-util';\nimport { DiagramHtmlElement } from './core/elements/html-element';\nimport { DiagramNativeElement } from './core/elements/native-element';\nimport { LinearGradient } from './core/appearance';\n/**\n * Print and Export Settings\n */\n\nvar PrintAndExport =\n/** @class */\nfunction () {\n  function PrintAndExport(diagram) {\n    this.diagram = diagram;\n  }\n  /**\n   * To Export the diagram\n   *\n   * @private\n   */\n\n\n  PrintAndExport.prototype.exportDiagram = function (options) {\n    var fileType;\n    var customBounds;\n    var content;\n    var content1 = '';\n    var data = 'data'; //let mode: string;\n\n    var buffers = [];\n    var margin = options.margin || {};\n    var region = options && options.region ? options.region : 'Content';\n    var mode = options && options.mode ? options.mode : 'Download';\n    var bounds = this.getDiagramBounds(region, options);\n\n    if (options.bounds) {\n      customBounds = true;\n      bounds.x = options.bounds.x ? options.bounds.x : bounds.x;\n      bounds.y = options.bounds.y ? options.bounds.y : bounds.y;\n      bounds.width = options.bounds.width || bounds.width;\n      bounds.height = options.bounds.height || bounds.height;\n    }\n\n    margin = {\n      top: margin.top !== undefined ? margin.top : 25,\n      bottom: margin.bottom !== undefined ? margin.bottom : 25,\n      right: margin.right !== undefined ? margin.right : 25,\n      left: margin.left !== undefined ? margin.left : 25\n    };\n    var nodes = this.diagram.nodes;\n\n    if (region !== 'PageSettings') {\n      bounds.x -= margin.left;\n      bounds.y -= margin.top;\n      bounds.width += margin.left + margin.right;\n      bounds.height += margin.top + margin.bottom;\n    }\n\n    var fileName = options.fileName || 'diagram';\n\n    if (options.format !== 'SVG') {\n      data = this.setCanvas(options, bounds, margin, mode, customBounds, region, fileName);\n\n      if (data !== null) {\n        return data;\n      }\n    } else {\n      fileType = options.format;\n      options.bounds = bounds;\n      options.margin = margin;\n      var svg = content = this.diagramAsSvg(options, margin);\n\n      if (mode === 'Data') {\n        if (isBlazor() && options.format === 'SVG') {\n          var svgData = new XMLSerializer().serializeToString(svg);\n          return svgData;\n        }\n\n        return content;\n      }\n\n      var buffer = new XMLSerializer().serializeToString(svg);\n      buffers.push(buffer);\n    }\n\n    if (mode === 'Download' && data !== null) {\n      var browserInfo = void 0; // Ensure this for Safari\n      // if (Browser.info.name === 'msie' && Number(Browser.info.version) < 10 || Browser.info.name === 'webkit') {\n      //     let info: string = Browser.info.name === 'webkit' ? 'Safari' : 'IE-9';\n      //     alert('Downloading option is not supported in ' + info + ', Please use the returned data');\n      //     return content;\n      // } else {\n\n      for (var b = 0; b < buffers.length; b++) {\n        var blob = new Blob([buffers[b]], {\n          type: 'application/octet-stream'\n        });\n\n        if (Browser.info.name === 'msie') {\n          window.navigator.msSaveOrOpenBlob(blob, fileName + '.' + fileType);\n        } else {\n          var pom = createHtmlElement('a', {\n            'download': fileName + '.' + fileType\n          });\n          var url = URL.createObjectURL(blob);\n          pom.href = url;\n          var e = document.createEvent('MouseEvents');\n          e.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n          pom.dispatchEvent(e);\n        }\n      }\n    }\n\n    return null;\n  };\n\n  PrintAndExport.prototype.setCanvas = function (options, bounds, margin, mode, customBounds, region, fileName) {\n    var content;\n    options.bounds = bounds;\n    options.region = region;\n    var scaleX = 'scaleX';\n    var scaleY = 'scaleY';\n    var scaleOffsetX = 'scaleOffsetX';\n    var scaleOffsetY = 'scaleOffsetY';\n    this.setScaleValueforCanvas(options, bounds);\n    var canvas = this.diagramAsCanvas({\n      bounds: bounds,\n      margin: margin,\n      region: region,\n      scaleX: options[scaleX],\n      scaleY: options[scaleY],\n      scaleOffsetX: options[scaleOffsetX],\n      scaleOffsetY: options[scaleOffsetY]\n    }, customBounds);\n    var image;\n\n    if (options.format === 'JPG' && mode === \"Data\") {\n      image = content = canvas.toDataURL('image/jpeg');\n    } else {\n      image = content = canvas.toDataURL();\n    }\n\n    if (mode === 'Data') {\n      return content;\n    }\n\n    this.canvasMultiplePage(options, canvas, margin, image, fileName);\n    return null;\n  };\n\n  PrintAndExport.prototype.canvasMultiplePage = function (options, canvas, margin, image, fileName) {\n    var _this = this;\n\n    var images = [];\n    var fileType = options.format || 'JPG';\n\n    if (options.multiplePage) {\n      options.pageHeight = options.pageHeight ? options.pageHeight : this.diagram.pageSettings.height;\n      options.pageWidth = options.pageWidth ? options.pageWidth : this.diagram.pageSettings.width;\n      options.pageHeight = options.pageHeight ? options.pageHeight : canvas.width;\n      options.pageWidth = options.pageWidth ? options.pageWidth : canvas.height;\n      margin = options.margin || {};\n\n      if (options.pageOrientation) {\n        if (options.pageOrientation === 'Landscape' && options.pageHeight > options.pageWidth || options.pageOrientation === 'Portrait' && options.pageWidth > options.pageHeight) {\n          var temp = options.pageWidth;\n          options.pageWidth = options.pageHeight;\n          options.pageHeight = temp;\n        }\n      }\n\n      options.margin = {\n        top: !isNaN(margin.top) ? margin.top : 0,\n        bottom: !isNaN(margin.bottom) ? margin.bottom : 0,\n        left: !isNaN(margin.left) ? margin.left : 0,\n        right: !isNaN(margin.right) ? margin.right : 0\n      };\n      var attr = {\n        'id': this.diagram.element.id + '_printImage',\n        'src': image\n      };\n      var img_1 = createHtmlElement('img', attr);\n\n      img_1.onload = function () {\n        images = _this.getMultipleImage(img_1, options, true);\n\n        _this.exportImage(images, fileName, fileType, image);\n      };\n    } else {\n      images = [image];\n      this.exportImage(images, fileName, fileType, image);\n    }\n  };\n\n  PrintAndExport.prototype.exportImage = function (images, fileName, fileType, image) {\n    var buffers = [];\n    var length = !(images instanceof HTMLElement) ? images.length : 0;\n\n    for (var g = 0; g < length; g++) {\n      image = images[g];\n      image = image.replace(/^data:[a-z]*;,/, '');\n      var image1 = image.split(',');\n      var byteString = atob(image1[1]);\n      var buffer = new ArrayBuffer(byteString.length);\n      var intArray = new Uint8Array(buffer);\n\n      for (var i = 0; i < byteString.length; i++) {\n        intArray[i] = byteString.charCodeAt(i);\n      }\n\n      buffers.push(buffer);\n    }\n\n    var _loop_1 = function (j) {\n      var b = new Blob([buffers[j]], {\n        type: 'application/octet-stream'\n      });\n\n      if (Browser.info.name === 'msie') {\n        window.navigator.msSaveOrOpenBlob(b, fileName + '.' + fileType);\n      } else {\n        var htmlElement_1 = createHtmlElement('a', {\n          'download': fileName + '.' + fileType\n        });\n        var urlLink = URL.createObjectURL(b);\n        htmlElement_1.href = urlLink;\n        var mouseEvent_1 = document.createEvent('MouseEvents');\n        mouseEvent_1.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n        setTimeout(function () {\n          htmlElement_1.dispatchEvent(mouseEvent_1);\n        }, (j + 1) * 5);\n      }\n    }; // Ensure this for safari\n    // if (Browser.info.name === 'msie' && Number(Browser.info.version) < 10 || Browser.info.name === 'webkit') {\n    //     let browserInfo: string = Browser.info.name === 'webkit' ? 'Safari' : 'IE-9';\n    //     alert('Downloading option is not supported in ' + browserInfo + ', Please use the returned data');\n    //     return content;\n    // } else {\n\n\n    for (var j = 0; j < buffers.length; j++) {\n      _loop_1(j);\n    }\n  };\n  /**   @private  */\n\n\n  PrintAndExport.prototype.getObjectsBound = function (options) {\n    var nodes = this.diagram.nodes;\n    var nodebounds;\n\n    for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\n      var node = nodes_1[_i];\n\n      if (node.visible) {\n        if (options.format !== 'SVG' && !(node instanceof DiagramNativeElement) && !(node instanceof DiagramHtmlElement) || options.format === 'SVG' && !(node instanceof DiagramHtmlElement)) {\n          if (!nodebounds) {\n            nodebounds = node.wrapper.outerBounds;\n          } else {\n            nodebounds = nodebounds.uniteRect(node.wrapper.outerBounds);\n          }\n        }\n      }\n    }\n\n    var connectors = this.diagram.connectors;\n\n    for (var _a = 0, connectors_1 = connectors; _a < connectors_1.length; _a++) {\n      var connector = connectors_1[_a];\n\n      if (connector.visible) {\n        if (!nodebounds) {\n          nodebounds = connector.wrapper.outerBounds;\n        } else {\n          nodebounds = nodebounds.uniteRect(connector.wrapper.outerBounds);\n        }\n      }\n    }\n\n    return nodebounds || new Rect(0, 0, 0, 0);\n  };\n  /**   @private  */\n\n\n  PrintAndExport.prototype.getDiagramBounds = function (mode, options) {\n    var rect = this.getObjectsBound(options);\n    var left = rect.left;\n    var top = rect.top;\n    var right = rect.right - rect.left;\n    var bottom = rect.bottom - rect.top;\n\n    if (mode !== 'Content') {\n      if (this.diagram.pageSettings && this.diagram.pageSettings.multiplePage) {\n        left = rect.left;\n        top = rect.top;\n\n        if (this.diagram.pageSettings.width) {\n          left = Math.floor(left / this.diagram.pageSettings.width) * this.diagram.pageSettings.width;\n          right = Math.ceil(rect.right / this.diagram.pageSettings.width) * this.diagram.pageSettings.width - left;\n        }\n\n        if (this.diagram.pageSettings.height) {\n          top = Math.floor(top / this.diagram.pageSettings.height) * this.diagram.pageSettings.height;\n          bottom = Math.ceil(rect.bottom / this.diagram.pageSettings.height) * this.diagram.pageSettings.height - top;\n        }\n\n        if (rect.width === 0 && this.diagram.pageSettings.width !== null) {\n          right = this.diagram.pageSettings.width;\n        }\n\n        if (rect.height === 0 && this.diagram.pageSettings.height !== null) {\n          bottom = this.diagram.pageSettings.height;\n        }\n      } else {\n        if (this.diagram.pageSettings.width) {\n          left = 0;\n          right = this.diagram.pageSettings.width;\n        }\n\n        if (this.diagram.pageSettings.height) {\n          top = 0;\n          bottom = this.diagram.pageSettings.height;\n        }\n      }\n    }\n\n    var svgBounds = new Rect();\n    svgBounds.x = left;\n    svgBounds.y = top;\n    svgBounds.width = right;\n    svgBounds.height = bottom;\n    return svgBounds;\n  };\n\n  PrintAndExport.prototype.setScaleValueforCanvas = function (options, bounds) {\n    var scaleX = 'scaleX';\n    var scaleY = 'scaleY';\n    var scaleOffsetX = 'scaleOffsetX';\n    var scaleOffsetY = 'scaleOffsetY';\n    options[scaleX] = 1;\n    options[scaleY] = 1;\n    options[scaleOffsetX] = 0;\n    options[scaleOffsetY] = 0;\n    options.pageHeight = options.pageHeight || this.diagram.pageSettings.height;\n    options.pageWidth = options.pageWidth || this.diagram.pageSettings.width;\n    var pageOrientation = options.pageOrientation || this.diagram.pageSettings.orientation;\n\n    if (!pageOrientation) {\n      pageOrientation = 'Portrait';\n    }\n\n    if (pageOrientation === 'Portrait') {\n      if (options.pageWidth > options.pageHeight) {\n        var temp = options.pageHeight;\n        options.pageHeight = options.pageWidth;\n        options.pageWidth = temp;\n      }\n    } else {\n      if (options.pageHeight > options.pageWidth) {\n        var temp = options.pageWidth;\n        options.pageWidth = options.pageHeight;\n        options.pageHeight = temp;\n      }\n    }\n\n    if (options.pageWidth && options.pageHeight && !options.multiplePage) {\n      options.stretch = 'Meet';\n    }\n\n    var height = options.pageHeight || bounds.height;\n    var width = options.pageWidth || bounds.width;\n\n    if (options.stretch === 'Stretch' || options.stretch === 'Meet' || options.stretch === 'Slice') {\n      options[scaleX] = width / bounds.width;\n      options[scaleY] = height / bounds.height;\n\n      if (options.stretch === 'Meet') {\n        options[scaleX] = options[scaleY] = Math.min(options[scaleX], options[scaleY]);\n        options[scaleOffsetY] = (options.pageHeight - bounds.height * options[scaleX]) / 2;\n        options[scaleOffsetX] = (options.pageWidth - bounds.width * options[scaleX]) / 2;\n      } else if (options.stretch === 'Slice') {\n        options[scaleX] = options[scaleY] = Math.max(options[scaleX], options[scaleY]);\n      }\n\n      bounds.width = width;\n      bounds.height = height;\n    }\n\n    bounds.x *= options[scaleX];\n    bounds.y *= options[scaleY];\n  };\n\n  PrintAndExport.prototype.diagramAsSvg = function (options, margin) {\n    var svg = this.diagram.createSvg(this.diagram.element.id + '_diagram_svg', options.bounds.width, options.bounds.height);\n    document.body.appendChild(svg);\n    var g = createSvgElement('g', {\n      'id': this.diagram.element.id + '_pageBackground'\n    });\n    var region = options && options.region ? options.region : 'Content';\n    var bounds = this.getDiagramBounds(region, options);\n    var left = bounds.x;\n    var top = bounds.y;\n    var width = bounds.width;\n    var height = bounds.height;\n    svg.appendChild(g);\n    var attr = {\n      'x': String(left),\n      'y': String(top),\n      'width': String(width),\n      'height': String(height)\n    };\n    setAttributeSvg(g, attr);\n    this.setTransform(g, options.bounds, margin);\n    var gradient = document.getElementById(this.diagram.element.id + 'gradient_pattern');\n\n    if (gradient) {\n      svg.appendChild(gradient);\n    }\n\n    attr = {\n      'x': String(left),\n      'y': String(top),\n      'width': String(width + margin.left + margin.right),\n      'height': String(height + margin.top + margin.bottom)\n    };\n    var backimage = document.getElementById(this.diagram.element.id + '_backgroundImageLayer').cloneNode(true);\n    setAttributeSvg(backimage, attr);\n    svg.appendChild(backimage);\n    this.setTransform(backimage, bounds, margin);\n    var backRect = document.getElementById(this.diagram.element.id + '_backgroundLayerrect').cloneNode(true);\n    setAttributeSvg(backRect, attr);\n    svg.appendChild(backRect);\n    this.setTransform(backRect, bounds, margin);\n\n    if (this.diagram.mode === 'SVG') {\n      var element = void 0;\n      var i = void 0;\n      var diagramLayerSVG = getDiagramLayerSvg(this.diagram.element.id);\n      svg.appendChild(diagramLayerSVG.getElementById(this.diagram.diagramLayer.id).cloneNode(true));\n\n      for (i = 0; i < svg.childNodes.length; i++) {\n        element = svg.childNodes[i];\n\n        if (element.id === this.diagram.element.id + '_diagramLayer') {\n          this.setTransform(element, bounds, margin);\n        }\n      }\n    } else {\n      g = createSvgElement('g', {\n        'id': this.diagram.element.id + '_diagramLayer'\n      });\n      svg.appendChild(g);\n      this.setTransform(g, options.bounds, margin); //renderLabels\n\n      var renderer = new DiagramRenderer('', null, true);\n      var htmlLayer = getHTMLLayer(this.diagram.element.id);\n      this.diagram.renderDiagramElements(svg, renderer, htmlLayer, false);\n    }\n\n    document.body.removeChild(svg);\n    return svg;\n  };\n\n  PrintAndExport.prototype.setTransform = function (element, bounds, margin) {\n    element.setAttribute('transform', 'translate(' + (-bounds.x + margin.left) + ', ' + (-bounds.y + margin.top) + ')');\n  };\n\n  PrintAndExport.prototype.diagramAsCanvas = function (options, customBounds) {\n    var scaleX = 'scaleX';\n    var scaleY = 'scaleY';\n    var scaleOffsetX = 'scaleOffsetX';\n    var scaleOffsetY = 'scaleOffsetY';\n    var element;\n    var elements = [];\n    var region = options.bounds;\n    var margin = options.margin;\n    var mode = options && options.region ? options.region : 'Content';\n    var pageBounds = this.getDiagramBounds(mode, options);\n    var bgColor = this.diagram.pageSettings.background.color;\n    var canvas = CanvasRenderer.createCanvas(this.diagram.element.id + '_diagram', options.bounds.width, options.bounds.height); //canvas.setAttribute('style', 'position:absolute;top:135px;left:160px;');\n\n    var context = canvas.getContext('2d');\n    context.translate(-region.x, -region.y);\n    context.save();\n    context.fillStyle = this.diagram.pageSettings.background.color === 'transparent' ? 'white' : this.diagram.pageSettings.background.color;\n    region = mode === 'Content' ? pageBounds : region;\n    context.fillRect(region.x, region.y, region.width, region.height);\n    var bgImg = this.diagram.pageSettings.background;\n\n    if (bgImg && bgImg.source) {\n      pageBounds = this.getDiagramBounds(mode, options);\n      var image = new Image();\n      image.src = bgImg.source;\n      var proportionX = pageBounds.width / image.width;\n      var proportionY = pageBounds.height / image.height;\n      var x = pageBounds.x;\n      var y = pageBounds.y;\n      var width = pageBounds.width;\n      var height = pageBounds.height;\n      var exportable = this.isImageExportable(bgImg);\n\n      if (bgImg.scale !== 'None' && bgImg.align !== 'None') {\n        var proportion = bgImg.scale === 'Meet' ? Math.min(proportionX, proportionY) : Math.max(proportionX, proportionY);\n        width = proportion * image.width;\n        height = proportion * image.height;\n\n        if (bgImg.align.indexOf('xmid') > -1) {\n          x += (pageBounds.width - width) / 2;\n        } else if (bgImg.align.indexOf('xmax') > -1) {\n          x = x + pageBounds.width - width;\n        }\n\n        if (bgImg.align.indexOf('ymid') > -1) {\n          y += (pageBounds.height - height) / 2;\n        } else if (bgImg.align.indexOf('ymax') > -1) {\n          y = y + pageBounds.height - height;\n        }\n\n        if (this.diagram.pageSettings.background.color === 'none' || this.diagram.pageSettings.background.color === 'transparent') {\n          context.fillStyle = 'white';\n          context.fillRect(pageBounds.x * options[scaleX], pageBounds.y * options[scaleY], pageBounds.width * options[scaleX], pageBounds.height * options[scaleY]);\n        }\n\n        if (exportable) {\n          context.drawImage(image, x, y, proportion * image.width, proportion * image.height);\n        }\n      } else if (exportable) {\n        context.drawImage(image, x, y, pageBounds.width, pageBounds.height);\n      }\n    } else {\n      context.fillStyle = bgColor === 'transparent' ? 'white' : bgColor;\n      context.fillRect(pageBounds.x * options[scaleX] - margin.left, pageBounds.y * options[scaleY] - margin.top, pageBounds.width * options[scaleX] + margin.left + margin.right, options[scaleY] * pageBounds.height + margin.top + margin.bottom);\n    }\n\n    var brColor = this.diagram.pageSettings.background.color;\n    var brWidth = this.diagram.pageSettings.width;\n\n    if (brWidth) {\n      context.strokeStyle = brColor === 'none' ? 'transparent' : brColor;\n      context.lineWidth = brWidth;\n      context.strokeRect(pageBounds.x * options[scaleX], pageBounds.y * options[scaleY], pageBounds.width * options[scaleX], pageBounds.height * options[scaleY]);\n    }\n\n    context.restore();\n    var htmlLayer = getHTMLLayer(this.diagram.element.id);\n    var renderer = new DiagramRenderer('', null, false);\n    this.updateObjectValue(options[scaleX], options[scaleOffsetX], options[scaleOffsetY], true);\n    this.diagram.renderDiagramElements(canvas, renderer, htmlLayer, false, true);\n    this.updateObjectValue(options[scaleX], options[scaleOffsetX], options[scaleOffsetY], false);\n    return canvas;\n  };\n\n  PrintAndExport.prototype.updateWrapper = function (canvas, value, scaleOffsetX, scaleOffsetY, isExport) {\n    if (canvas && canvas.length > 0) {\n      for (var j = 0; j < canvas.length; j++) {\n        if (canvas[j].children) {\n          this.updateWrapper(canvas[j].children, value, scaleOffsetX, scaleOffsetY, isExport);\n        }\n\n        canvas[j].exportScaleValue.x = value;\n        canvas[j].exportScaleValue.y = value;\n        canvas[j].exportScaleOffset.x = scaleOffsetX;\n        canvas[j].exportScaleOffset.y = scaleOffsetY;\n        canvas[j].isExport = isExport;\n      }\n    }\n  };\n\n  PrintAndExport.prototype.scaleGradientValue = function (node, scaleValue, isExport) {\n    if (node.style.gradient.stops.length > 0) {\n      var gradients = node.style.gradient;\n\n      if (node.style.gradient instanceof LinearGradient) {\n        gradients.x1 = isExport ? gradients.x1 * scaleValue : gradients.x1 / scaleValue;\n        gradients.y1 = isExport ? gradients.y1 * scaleValue : gradients.y1 / scaleValue;\n        gradients.x2 = isExport ? gradients.x2 * scaleValue : gradients.x2 / scaleValue;\n        gradients.y2 = isExport ? gradients.y2 * scaleValue : gradients.y2 / scaleValue;\n      } else {\n        gradients.fx = isExport ? gradients.fx * scaleValue : gradients.fx / scaleValue;\n        gradients.fy = isExport ? gradients.fy * scaleValue : gradients.fy / scaleValue;\n        gradients.cx = isExport ? gradients.cx * scaleValue : gradients.cx / scaleValue;\n        gradients.cy = isExport ? gradients.cy * scaleValue : gradients.cy / scaleValue;\n        gradients.r = isExport ? gradients.r * scaleValue : gradients.r / scaleValue;\n      }\n    }\n  };\n\n  PrintAndExport.prototype.updateObjectValue = function (value, scaleOffsetX, scaleOffsetY, isExport) {\n    var wrapper;\n\n    for (var i = 0; i < this.diagram.nodes.length; i++) {\n      wrapper = this.diagram.nodes[i].wrapper;\n      this.scaleGradientValue(this.diagram.nodes[i], value, isExport);\n      this.updateWrapper(wrapper.children, value, scaleOffsetX, scaleOffsetY, isExport);\n      wrapper.exportScaleValue.x = value;\n      wrapper.exportScaleValue.y = value;\n      wrapper.exportScaleOffset.x = scaleOffsetX;\n      wrapper.exportScaleOffset.y = scaleOffsetY;\n      wrapper.isExport = isExport;\n    }\n\n    for (var j = 0; j < this.diagram.connectors.length; j++) {\n      wrapper = this.diagram.connectors[j].wrapper;\n\n      for (var k = 0; k < wrapper.children.length; k++) {\n        wrapper.children[k].isExport = isExport;\n\n        if (isExport) {\n          wrapper.children[k].exportScaleValue.x = value;\n          wrapper.children[k].exportScaleValue.y = value;\n          wrapper.children[k].exportScaleOffset.x = scaleOffsetX;\n          wrapper.children[k].exportScaleOffset.y = scaleOffsetY;\n        }\n      }\n    }\n  };\n\n  PrintAndExport.prototype.isImageExportable = function (backgroundImage) {\n    var state = true;\n    var content;\n    var canvas;\n\n    if (backgroundImage.source) {\n      try {\n        canvas = CanvasRenderer.createCanvas(this.diagram.element.id + 'temp_canvas', 100, 100);\n        var ctx = canvas.getContext('2d');\n        ctx.save();\n        var image = new Image();\n        image.src = backgroundImage.source;\n        ctx.drawImage(image, 0, 0, 100, 100);\n        ctx.restore();\n        content = canvas.toDataURL();\n      } catch (e) {\n        state = false;\n      }\n    }\n\n    return state;\n  };\n\n  PrintAndExport.prototype.getPrintCanvasStyle = function (img, options) {\n    var width = 0;\n    var height = 0;\n    var size = new Size();\n    width = img.width;\n    height = img.height;\n\n    if (options.pageHeight || options.pageWidth) {\n      height = options.pageHeight ? options.pageHeight : height;\n      width = options.pageWidth ? options.pageWidth : width;\n    }\n\n    if (options.pageOrientation) {\n      if (options.pageOrientation === 'Landscape' && height > width || options.pageOrientation === 'Portrait' && width > height) {\n        var temp = width;\n        width = height;\n        height = temp;\n      }\n    }\n\n    size.height = height;\n    size.width = width;\n    return size;\n  };\n\n  PrintAndExport.prototype.getMultipleImage = function (img, options, isExport) {\n    var imageArray = [];\n    var div = createHtmlElement('div', {});\n    var pageSize = this.getPrintCanvasStyle(img, options); //let pageWidth: number;\n    //let pageHeight: number;\n\n    var margin = options.margin;\n    var mLeft = margin.left;\n    var mTop = margin.top;\n    var mRight = margin.right;\n    var mBottom = margin.bottom;\n    var x = 0;\n    var y = 0;\n    var pageWidth = pageSize.width + x;\n    var pageHeight = pageSize.height + y;\n    var drawnX = 0;\n    var drawnY = 0;\n\n    if (options && options.multiplePage) {\n      div.style.height = 'auto';\n      div.style.width = 'auto';\n      var imgHeight = img.height;\n      var imgWidth = img.width; //if (img) {\n\n      var i = 0;\n      var j = 0;\n      var url = void 0;\n      var clipWidth = 0;\n      var clipHeight = 0;\n      var ctx = void 0;\n      var canvas = void 0;\n\n      do {\n        do {\n          clipWidth = pageSize.width;\n          clipHeight = pageSize.height;\n\n          if (drawnX + pageSize.width >= imgWidth) {\n            clipWidth = imgWidth - drawnX;\n          }\n\n          if (drawnY + pageSize.height >= imgHeight) {\n            clipHeight = imgHeight - drawnY;\n          }\n\n          canvas = CanvasRenderer.createCanvas(this.diagram.element.id + '_multiplePrint', pageSize.width, pageSize.height);\n          ctx = canvas.getContext('2d');\n          ctx.drawImage(img, x + drawnX + mLeft, y + drawnY + mTop, clipWidth - mRight - mLeft, clipHeight - mBottom - mTop, 0 + mLeft, 0 + mTop, clipWidth - mRight - mLeft, clipHeight - mBottom - mTop);\n\n          if (drawnX + pageSize.width >= imgWidth) {\n            drawnX -= drawnX - imgWidth;\n          }\n\n          url = canvas.toDataURL();\n          ctx.restore();\n          drawnX += pageWidth;\n\n          if (isExport) {\n            imageArray.push(url);\n          } else {\n            this.printImage(div, url, i + '' + j, pageWidth + 'px;', pageHeight + 'px;');\n          }\n\n          i++;\n        } while (drawnX < imgWidth);\n\n        j++;\n        i = x = drawnX = 0;\n\n        if (drawnY + pageSize.height >= imgHeight) {\n          drawnY -= drawnY - imgHeight;\n        }\n\n        drawnY += pageHeight;\n      } while (drawnY < imgHeight); //}\n\n    } else {\n      var x_1 = 0;\n      var y_1 = 0;\n      var pageSize_1 = this.getPrintCanvasStyle(img, options); ///let pageWidth: number; let pageHeight: number;\n\n      var pageWidth_1 = pageSize_1.width;\n      var pageHeight_1 = pageSize_1.height; //let ctx: CanvasRenderingContext2D;\n      //let canvas: HTMLCanvasElement;\n      //let url: string;\n\n      var canvas = CanvasRenderer.createCanvas(this.diagram.element.id + '_diagram', pageWidth_1, pageHeight_1);\n      var ctx = canvas.getContext('2d');\n      ctx.drawImage(img, x_1 + mLeft, y_1 + mTop, img.width - (mRight + mLeft), img.height - (mTop + mBottom), 0 + mLeft, 0 + mTop, pageWidth_1 - (mRight + mLeft), pageHeight_1 - (mTop + mBottom));\n      var url = canvas.toDataURL();\n      ctx.restore();\n\n      if (isExport) {\n        imageArray.push(url);\n      } else {\n        this.printImage(div, url, 0);\n      }\n    }\n\n    if (isExport) {\n      return imageArray;\n    } else {\n      return div;\n    }\n  };\n\n  PrintAndExport.prototype.printImage = function (div, url, i, pageWidth, pageHeight) {\n    var attr = {\n      'class': 'e-diagram-print-page',\n      'style': 'width:' + pageWidth + 'height:' + pageHeight\n    };\n    var img = createHtmlElement('img', attr);\n    var innerDiv = createHtmlElement('div', attr);\n    attr = {\n      'id': this.diagram.element.id + '_multiplePrint_img' + i,\n      'style': 'float:left',\n      'src': url\n    };\n    setAttributeHtml(img, attr);\n    innerDiv.appendChild(img);\n    div.appendChild(innerDiv);\n  };\n  /**\n   * To print the image\n   *\n   * @private\n   */\n\n\n  PrintAndExport.prototype.print = function (options) {\n    options.mode = 'Data';\n    var url = this.exportDiagram(options);\n    this.printImages(url, options);\n  };\n\n  PrintAndExport.prototype.printImages = function (url, options) {\n    var _this = this;\n\n    var attr = {\n      'id': this.diagram.element.id + '_printImage',\n      'src': url\n    };\n    options.margin = {\n      top: 0,\n      bottom: 0,\n      right: 0,\n      left: 0\n    };\n    var img = createHtmlElement('img', attr);\n\n    img.onload = function () {\n      var div = _this.getMultipleImage(img, options); // specify window parameters\n\n\n      var printWind = window.open('');\n\n      if (printWind != null) {\n        if (div instanceof HTMLElement) {\n          printWind.document.write('<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page' + '{page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}' + '</style><title></title></head>');\n          printWind.addEventListener('load', function (event) {\n            setTimeout(function () {\n              printWind.window.print();\n            }, 3000);\n          });\n          printWind.document.write('<center>' + div.innerHTML + '</center>');\n          printWind.document.close();\n        }\n      }\n    };\n  };\n  /** @private */\n\n\n  PrintAndExport.prototype.getDiagramContent = function (styleSheets) {\n    var container = document.getElementById(this.diagram.element.id + 'content');\n    var scrollerX = container.scrollLeft;\n    var scrollerY = container.scrollTop;\n    var oldZoom = this.diagram.scrollSettings.currentZoom;\n    var oldHorizontalOffset = this.diagram.scroller.horizontalOffset;\n    var oldVerticalOffset = this.diagram.scroller.verticalOffset;\n    var oldWidth = Number(String(this.diagram.width).split('%')[0]) ? container.clientWidth : Number(String(this.diagram.width).split('px')[0]);\n    var oldHeight = Number(String(this.diagram.height).split('%')[0]) ? container.clientHeight : Number(String(this.diagram.height).split('px')[0]);\n    var bounds = this.getDiagramBounds('', {});\n    this.diagram.scroller.zoom(1 / oldZoom);\n    var scrollX = 0;\n    var scrollY = 0;\n    scrollX = bounds.x;\n    scrollY = bounds.y;\n    this.diagram.scroller.transform = {\n      tx: -scrollX,\n      ty: -scrollY,\n      scale: this.diagram.scroller.currentZoom\n    };\n    this.diagram.scroller.horizontalOffset = -scrollX;\n    this.diagram.scroller.verticalOffset = -scrollY;\n    this.diagram.scroller.setSize();\n    this.diagram.setSize(bounds.width, bounds.height);\n    var snapConstraints = this.diagram.snapSettings.constraints;\n    this.diagram.snapSettings.constraints = this.diagram.snapSettings.constraints & ~SnapConstraints.ShowLines;\n    this.diagram.dataBind();\n    this.diagram.clearSelection();\n    styleSheets = styleSheets || document.styleSheets;\n    var styleSheetRef = '';\n\n    for (var i = 0; i < styleSheets.length; i++) {\n      if (styleSheets[i].href || typeof styleSheets[i] === 'string') {\n        styleSheetRef += '<link href=\\'' + (styleSheets[i].href || styleSheets[i]) + '\\' rel=\\'stylesheet\\' />';\n      }\n    }\n\n    var htmlData = document.getElementById(this.diagram.element.id + 'content').innerHTML;\n    var marginStyle = 'margin-left:' + 0 + 'px;margin-top:' + 0 + 'px;margin-right:' + 0 + 'px;margin-bottom:' + 0 + 'px;';\n    htmlData = styleSheetRef + '<body style=\"margin: 0px; padding: 0px\"><div style=\\'' + marginStyle + '\\'>' + htmlData + '</div></body>';\n    htmlData = htmlData.replace(/ transform: t/g, ' -webkit-transform: t');\n    this.diagram.setSize(oldWidth, oldHeight);\n    this.diagram.scroller.zoom(oldZoom / this.diagram.scrollSettings.currentZoom);\n    this.diagram.snapSettings.constraints = snapConstraints;\n    this.diagram.dataBind();\n\n    if (scrollerX || scrollerY) {\n      this.diagram.setOffset(scrollerX, scrollerY);\n    } else {\n      this.diagram.scroller.transform = {\n        tx: oldHorizontalOffset / this.diagram.scroller.currentZoom,\n        ty: oldVerticalOffset / this.diagram.scroller.currentZoom,\n        scale: this.diagram.scroller.currentZoom\n      };\n      this.diagram.scroller.horizontalOffset = oldHorizontalOffset;\n      this.diagram.scroller.verticalOffset = oldVerticalOffset;\n    }\n\n    this.diagram.renderSelector(false);\n    /* tslint:disable */\n    // eslint-disable-next-line quotes\n\n    return checkBrowserInfo() ? htmlData.replace(\"url(\" + location.protocol + '//' + location.host + location.pathname + \"#diagram_pattern \", \"url(#diagram_pattern)\") : htmlData;\n    /* tslint:enable */\n  };\n  /** @private */\n\n\n  PrintAndExport.prototype.exportImages = function (image, options) {\n    var _this = this;\n\n    var region = options && options.region ? options.region : 'Content';\n    var margin = options.margin || {};\n    margin = {\n      top: !isNaN(margin.top) ? margin.top : 0,\n      bottom: !isNaN(margin.bottom) ? margin.bottom : 0,\n      left: !isNaN(margin.left) ? margin.left : 0,\n      right: !isNaN(margin.right) ? margin.right : 0\n    };\n    var bounds = this.getDiagramBounds(region, {});\n\n    if (options.bounds) {\n      bounds.x = !isNaN(options.bounds.x) ? options.bounds.x : bounds.x;\n      bounds.y = !isNaN(options.bounds.y) ? options.bounds.y : bounds.y;\n      bounds.width = options.bounds.width || bounds.width;\n      bounds.height = options.bounds.height || bounds.height;\n    }\n\n    var img = document.createElement('img');\n    var attr = {\n      'src': image\n    };\n    setAttributeHtml(img, attr);\n    var context = this;\n\n    img.onload = function () {\n      var canvas = CanvasRenderer.createCanvas(context.diagram.element.id + 'innerImage', bounds.width + (margin.left + margin.right), bounds.height + (margin.top + margin.bottom));\n      var ctx = canvas.getContext('2d');\n      ctx.fillStyle = context.diagram.pageSettings.background.color;\n      ctx.fillRect(0, 0, bounds.width + (margin.left + margin.right), bounds.height + (margin.top + margin.bottom));\n      ctx.drawImage(img, 0, 0, bounds.width, bounds.height, margin.left, margin.top, bounds.width, bounds.height);\n      image = canvas.toDataURL();\n\n      if (options.printOptions) {\n        context.printImages(image, options);\n        return;\n      }\n\n      ctx.restore();\n      var fileName = options.fileName || 'diagram';\n\n      _this.canvasMultiplePage(options, canvas, margin, image, fileName);\n    };\n  };\n  /**\n   *To destroy the ruler\n   *\n   * @returns {void} To destroy the ruler\n   */\n\n\n  PrintAndExport.prototype.destroy = function () {\n    /**\n     * Destroys the Print and Export module\n     */\n  };\n  /**\n   * Get module name.\n   */\n\n\n  PrintAndExport.prototype.getModuleName = function () {\n    /**\n     * Returns the module name\n     */\n    return 'PrintandExport';\n  };\n\n  return PrintAndExport;\n}();\n\nexport { PrintAndExport };","map":{"version":3,"sources":["/Users/sergeismogliuk/Documents/Project/Project_node/Diplom/react-diplom/react-diplom/node_modules/@syncfusion/ej2-diagrams/src/diagram/print-settings.js"],"names":["Browser","isBlazor","CanvasRenderer","DiagramRenderer","Size","SnapConstraints","setAttributeHtml","setAttributeSvg","createHtmlElement","Rect","createSvgElement","getHTMLLayer","getDiagramLayerSvg","checkBrowserInfo","DiagramHtmlElement","DiagramNativeElement","LinearGradient","PrintAndExport","diagram","prototype","exportDiagram","options","fileType","customBounds","content","content1","data","buffers","margin","region","mode","bounds","getDiagramBounds","x","y","width","height","top","undefined","bottom","right","left","nodes","fileName","format","setCanvas","svg","diagramAsSvg","svgData","XMLSerializer","serializeToString","buffer","push","browserInfo","b","length","blob","Blob","type","info","name","window","navigator","msSaveOrOpenBlob","pom","url","URL","createObjectURL","href","e","document","createEvent","initMouseEvent","dispatchEvent","scaleX","scaleY","scaleOffsetX","scaleOffsetY","setScaleValueforCanvas","canvas","diagramAsCanvas","image","toDataURL","canvasMultiplePage","_this","images","multiplePage","pageHeight","pageSettings","pageWidth","pageOrientation","temp","isNaN","attr","element","id","img_1","onload","getMultipleImage","exportImage","HTMLElement","g","replace","image1","split","byteString","atob","ArrayBuffer","intArray","Uint8Array","i","charCodeAt","_loop_1","j","htmlElement_1","urlLink","mouseEvent_1","setTimeout","getObjectsBound","nodebounds","_i","nodes_1","node","visible","wrapper","outerBounds","uniteRect","connectors","_a","connectors_1","connector","rect","Math","floor","ceil","svgBounds","orientation","stretch","min","max","createSvg","body","appendChild","String","setTransform","gradient","getElementById","backimage","cloneNode","backRect","diagramLayerSVG","diagramLayer","childNodes","renderer","htmlLayer","renderDiagramElements","removeChild","setAttribute","elements","pageBounds","bgColor","background","color","createCanvas","context","getContext","translate","save","fillStyle","fillRect","bgImg","source","Image","src","proportionX","proportionY","exportable","isImageExportable","scale","align","proportion","indexOf","drawImage","brColor","brWidth","strokeStyle","lineWidth","strokeRect","restore","updateObjectValue","updateWrapper","value","isExport","children","exportScaleValue","exportScaleOffset","scaleGradientValue","scaleValue","style","stops","gradients","x1","y1","x2","y2","fx","fy","cx","cy","r","k","backgroundImage","state","ctx","getPrintCanvasStyle","img","size","imageArray","div","pageSize","mLeft","mTop","mRight","mBottom","drawnX","drawnY","imgHeight","imgWidth","clipWidth","clipHeight","printImage","x_1","y_1","pageSize_1","pageWidth_1","pageHeight_1","innerDiv","print","printImages","printWind","open","write","addEventListener","event","innerHTML","close","getDiagramContent","styleSheets","container","scrollerX","scrollLeft","scrollerY","scrollTop","oldZoom","scrollSettings","currentZoom","oldHorizontalOffset","scroller","horizontalOffset","oldVerticalOffset","verticalOffset","oldWidth","Number","clientWidth","oldHeight","clientHeight","zoom","scrollX","scrollY","transform","tx","ty","setSize","snapConstraints","snapSettings","constraints","ShowLines","dataBind","clearSelection","styleSheetRef","htmlData","marginStyle","setOffset","renderSelector","location","protocol","host","pathname","exportImages","createElement","printOptions","destroy","getModuleName"],"mappings":"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","sourcesContent":["/* eslint-disable jsdoc/require-param */\n/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable @typescript-eslint/ban-types */\n/* eslint-disable valid-jsdoc */\n/* eslint-disable jsdoc/require-returns */\n/* eslint-disable @typescript-eslint/no-this-alias */\nimport { Browser, isBlazor } from '@syncfusion/ej2-base';\nimport { CanvasRenderer } from './rendering/canvas-renderer';\nimport { DiagramRenderer } from './rendering/renderer';\nimport { Size } from './primitives/size';\nimport { SnapConstraints } from './enum/enum';\nimport { setAttributeHtml, setAttributeSvg, createHtmlElement } from './utility/dom-util';\nimport { Rect } from './primitives/rect';\nimport { createSvgElement, getHTMLLayer } from './utility/dom-util';\nimport { getDiagramLayerSvg } from './utility/dom-util';\nimport { checkBrowserInfo } from './utility/diagram-util';\nimport { DiagramHtmlElement } from './core/elements/html-element';\nimport { DiagramNativeElement } from './core/elements/native-element';\nimport { LinearGradient } from './core/appearance';\n/**\n * Print and Export Settings\n */\nvar PrintAndExport = /** @class */ (function () {\n    function PrintAndExport(diagram) {\n        this.diagram = diagram;\n    }\n    /**\n     * To Export the diagram\n     *\n     * @private\n     */\n    PrintAndExport.prototype.exportDiagram = function (options) {\n        var fileType;\n        var customBounds;\n        var content;\n        var content1 = '';\n        var data = 'data';\n        //let mode: string;\n        var buffers = [];\n        var margin = options.margin || {};\n        var region = options && options.region ? options.region : 'Content';\n        var mode = options && options.mode ? options.mode : 'Download';\n        var bounds = this.getDiagramBounds(region, options);\n        if (options.bounds) {\n            customBounds = true;\n            bounds.x = options.bounds.x ? options.bounds.x : bounds.x;\n            bounds.y = options.bounds.y ? options.bounds.y : bounds.y;\n            bounds.width = options.bounds.width || bounds.width;\n            bounds.height = options.bounds.height || bounds.height;\n        }\n        margin = {\n            top: margin.top !== undefined ? margin.top : 25,\n            bottom: margin.bottom !== undefined ? margin.bottom : 25,\n            right: margin.right !== undefined ? margin.right : 25,\n            left: margin.left !== undefined ? margin.left : 25\n        };\n        var nodes = this.diagram.nodes;\n        if (region !== 'PageSettings') {\n            bounds.x -= margin.left;\n            bounds.y -= margin.top;\n            bounds.width += margin.left + margin.right;\n            bounds.height += margin.top + margin.bottom;\n        }\n        var fileName = options.fileName || 'diagram';\n        if (options.format !== 'SVG') {\n            data = this.setCanvas(options, bounds, margin, mode, customBounds, region, fileName);\n            if (data !== null) {\n                return data;\n            }\n        }\n        else {\n            fileType = options.format;\n            options.bounds = bounds;\n            options.margin = margin;\n            var svg = content = this.diagramAsSvg(options, margin);\n            if (mode === 'Data') {\n                if (isBlazor() && options.format === 'SVG') {\n                    var svgData = new XMLSerializer().serializeToString(svg);\n                    return svgData;\n                }\n                return content;\n            }\n            var buffer = new XMLSerializer().serializeToString(svg);\n            buffers.push(buffer);\n        }\n        if (mode === 'Download' && data !== null) {\n            var browserInfo = void 0;\n            // Ensure this for Safari\n            // if (Browser.info.name === 'msie' && Number(Browser.info.version) < 10 || Browser.info.name === 'webkit') {\n            //     let info: string = Browser.info.name === 'webkit' ? 'Safari' : 'IE-9';\n            //     alert('Downloading option is not supported in ' + info + ', Please use the returned data');\n            //     return content;\n            // } else {\n            for (var b = 0; b < buffers.length; b++) {\n                var blob = new Blob([buffers[b]], { type: 'application/octet-stream' });\n                if (Browser.info.name === 'msie') {\n                    window.navigator.msSaveOrOpenBlob(blob, fileName + '.' + fileType);\n                }\n                else {\n                    var pom = createHtmlElement('a', { 'download': fileName + '.' + fileType });\n                    var url = URL.createObjectURL(blob);\n                    pom.href = url;\n                    var e = document.createEvent('MouseEvents');\n                    e.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n                    pom.dispatchEvent(e);\n                }\n            }\n        }\n        return null;\n    };\n    PrintAndExport.prototype.setCanvas = function (options, bounds, margin, mode, customBounds, region, fileName) {\n        var content;\n        options.bounds = bounds;\n        options.region = region;\n        var scaleX = 'scaleX';\n        var scaleY = 'scaleY';\n        var scaleOffsetX = 'scaleOffsetX';\n        var scaleOffsetY = 'scaleOffsetY';\n        this.setScaleValueforCanvas(options, bounds);\n        var canvas = this.diagramAsCanvas({\n            bounds: bounds, margin: margin, region: region, scaleX: options[scaleX],\n            scaleY: options[scaleY], scaleOffsetX: options[scaleOffsetX], scaleOffsetY: options[scaleOffsetY]\n        }, customBounds);\n        var image;\n        if (options.format === 'JPG' && mode === \"Data\") {\n            image = content = canvas.toDataURL('image/jpeg');\n        }\n        else {\n            image = content = canvas.toDataURL();\n        }\n        if (mode === 'Data') {\n            return content;\n        }\n        this.canvasMultiplePage(options, canvas, margin, image, fileName);\n        return null;\n    };\n    PrintAndExport.prototype.canvasMultiplePage = function (options, canvas, margin, image, fileName) {\n        var _this = this;\n        var images = [];\n        var fileType = options.format || 'JPG';\n        if (options.multiplePage) {\n            options.pageHeight = options.pageHeight ? options.pageHeight : this.diagram.pageSettings.height;\n            options.pageWidth = options.pageWidth ? options.pageWidth : this.diagram.pageSettings.width;\n            options.pageHeight = options.pageHeight ? options.pageHeight : canvas.width;\n            options.pageWidth = options.pageWidth ? options.pageWidth : canvas.height;\n            margin = options.margin || {};\n            if (options.pageOrientation) {\n                if ((options.pageOrientation === 'Landscape' && options.pageHeight > options.pageWidth) ||\n                    options.pageOrientation === 'Portrait' && options.pageWidth > options.pageHeight) {\n                    var temp = options.pageWidth;\n                    options.pageWidth = options.pageHeight;\n                    options.pageHeight = temp;\n                }\n            }\n            options.margin = {\n                top: !isNaN(margin.top) ? margin.top : 0,\n                bottom: !isNaN(margin.bottom) ? margin.bottom : 0,\n                left: !isNaN(margin.left) ? margin.left : 0,\n                right: !isNaN(margin.right) ? margin.right : 0\n            };\n            var attr = {\n                'id': this.diagram.element.id + '_printImage',\n                'src': image\n            };\n            var img_1 = createHtmlElement('img', attr);\n            img_1.onload = function () {\n                images = _this.getMultipleImage(img_1, options, true);\n                _this.exportImage(images, fileName, fileType, image);\n            };\n        }\n        else {\n            images = [image];\n            this.exportImage(images, fileName, fileType, image);\n        }\n    };\n    PrintAndExport.prototype.exportImage = function (images, fileName, fileType, image) {\n        var buffers = [];\n        var length = (!(images instanceof HTMLElement)) ? images.length : 0;\n        for (var g = 0; g < length; g++) {\n            image = images[g];\n            image = image.replace(/^data:[a-z]*;,/, '');\n            var image1 = image.split(',');\n            var byteString = atob(image1[1]);\n            var buffer = new ArrayBuffer(byteString.length);\n            var intArray = new Uint8Array(buffer);\n            for (var i = 0; i < byteString.length; i++) {\n                intArray[i] = byteString.charCodeAt(i);\n            }\n            buffers.push(buffer);\n        }\n        var _loop_1 = function (j) {\n            var b = new Blob([buffers[j]], { type: 'application/octet-stream' });\n            if (Browser.info.name === 'msie') {\n                window.navigator.msSaveOrOpenBlob(b, fileName + '.' + fileType);\n            }\n            else {\n                var htmlElement_1 = createHtmlElement('a', { 'download': fileName + '.' + fileType });\n                var urlLink = URL.createObjectURL(b);\n                htmlElement_1.href = urlLink;\n                var mouseEvent_1 = document.createEvent('MouseEvents');\n                mouseEvent_1.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n                setTimeout(function () {\n                    htmlElement_1.dispatchEvent(mouseEvent_1);\n                }, ((j + 1) * 5));\n            }\n        };\n        // Ensure this for safari\n        // if (Browser.info.name === 'msie' && Number(Browser.info.version) < 10 || Browser.info.name === 'webkit') {\n        //     let browserInfo: string = Browser.info.name === 'webkit' ? 'Safari' : 'IE-9';\n        //     alert('Downloading option is not supported in ' + browserInfo + ', Please use the returned data');\n        //     return content;\n        // } else {\n        for (var j = 0; j < buffers.length; j++) {\n            _loop_1(j);\n        }\n    };\n    /**   @private  */\n    PrintAndExport.prototype.getObjectsBound = function (options) {\n        var nodes = this.diagram.nodes;\n        var nodebounds;\n        for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\n            var node = nodes_1[_i];\n            if (node.visible) {\n                if (((options.format !== 'SVG' && !(node instanceof DiagramNativeElement) && !(node instanceof DiagramHtmlElement))\n                    || (options.format === 'SVG' && !(node instanceof DiagramHtmlElement)))) {\n                    if (!nodebounds) {\n                        nodebounds = node.wrapper.outerBounds;\n                    }\n                    else {\n                        nodebounds = nodebounds.uniteRect(node.wrapper.outerBounds);\n                    }\n                }\n            }\n        }\n        var connectors = this.diagram.connectors;\n        for (var _a = 0, connectors_1 = connectors; _a < connectors_1.length; _a++) {\n            var connector = connectors_1[_a];\n            if (connector.visible) {\n                if (!nodebounds) {\n                    nodebounds = connector.wrapper.outerBounds;\n                }\n                else {\n                    nodebounds = nodebounds.uniteRect(connector.wrapper.outerBounds);\n                }\n            }\n        }\n        return nodebounds || new Rect(0, 0, 0, 0);\n    };\n    /**   @private  */\n    PrintAndExport.prototype.getDiagramBounds = function (mode, options) {\n        var rect = this.getObjectsBound(options);\n        var left = rect.left;\n        var top = rect.top;\n        var right = rect.right - rect.left;\n        var bottom = rect.bottom - rect.top;\n        if (mode !== 'Content') {\n            if (this.diagram.pageSettings && this.diagram.pageSettings.multiplePage) {\n                left = rect.left;\n                top = rect.top;\n                if (this.diagram.pageSettings.width) {\n                    left = Math.floor(left / this.diagram.pageSettings.width) * this.diagram.pageSettings.width;\n                    right = Math.ceil(rect.right / this.diagram.pageSettings.width) * this.diagram.pageSettings.width - left;\n                }\n                if (this.diagram.pageSettings.height) {\n                    top = Math.floor(top / this.diagram.pageSettings.height) * this.diagram.pageSettings.height;\n                    bottom = Math.ceil(rect.bottom / this.diagram.pageSettings.height) * this.diagram.pageSettings.height - top;\n                }\n                if ((rect.width === 0) && this.diagram.pageSettings.width !== null) {\n                    right = this.diagram.pageSettings.width;\n                }\n                if ((rect.height === 0) && this.diagram.pageSettings.height !== null) {\n                    bottom = this.diagram.pageSettings.height;\n                }\n            }\n            else {\n                if (this.diagram.pageSettings.width) {\n                    left = 0;\n                    right = this.diagram.pageSettings.width;\n                }\n                if (this.diagram.pageSettings.height) {\n                    top = 0;\n                    bottom = this.diagram.pageSettings.height;\n                }\n            }\n        }\n        var svgBounds = new Rect();\n        svgBounds.x = left;\n        svgBounds.y = top;\n        svgBounds.width = right;\n        svgBounds.height = bottom;\n        return svgBounds;\n    };\n    PrintAndExport.prototype.setScaleValueforCanvas = function (options, bounds) {\n        var scaleX = 'scaleX';\n        var scaleY = 'scaleY';\n        var scaleOffsetX = 'scaleOffsetX';\n        var scaleOffsetY = 'scaleOffsetY';\n        options[scaleX] = 1;\n        options[scaleY] = 1;\n        options[scaleOffsetX] = 0;\n        options[scaleOffsetY] = 0;\n        options.pageHeight = options.pageHeight || this.diagram.pageSettings.height;\n        options.pageWidth = options.pageWidth || this.diagram.pageSettings.width;\n        var pageOrientation = options.pageOrientation || this.diagram.pageSettings.orientation;\n        if (!pageOrientation) {\n            pageOrientation = 'Portrait';\n        }\n        if (pageOrientation === 'Portrait') {\n            if (options.pageWidth > options.pageHeight) {\n                var temp = options.pageHeight;\n                options.pageHeight = options.pageWidth;\n                options.pageWidth = temp;\n            }\n        }\n        else {\n            if (options.pageHeight > options.pageWidth) {\n                var temp = options.pageWidth;\n                options.pageWidth = options.pageHeight;\n                options.pageHeight = temp;\n            }\n        }\n        if (options.pageWidth && options.pageHeight && !options.multiplePage) {\n            options.stretch = 'Meet';\n        }\n        var height = options.pageHeight || bounds.height;\n        var width = options.pageWidth || bounds.width;\n        if (options.stretch === 'Stretch' || options.stretch === 'Meet' || options.stretch === 'Slice') {\n            options[scaleX] = width / bounds.width;\n            options[scaleY] = height / bounds.height;\n            if (options.stretch === 'Meet') {\n                options[scaleX] = options[scaleY] = Math.min(options[scaleX], options[scaleY]);\n                options[scaleOffsetY] = (options.pageHeight - bounds.height * options[scaleX]) / 2;\n                options[scaleOffsetX] = (options.pageWidth - bounds.width * options[scaleX]) / 2;\n            }\n            else if (options.stretch === 'Slice') {\n                options[scaleX] = options[scaleY] = Math.max(options[scaleX], options[scaleY]);\n            }\n            bounds.width = width;\n            bounds.height = height;\n        }\n        bounds.x *= options[scaleX];\n        bounds.y *= options[scaleY];\n    };\n    PrintAndExport.prototype.diagramAsSvg = function (options, margin) {\n        var svg = this.diagram.createSvg(this.diagram.element.id + '_diagram_svg', options.bounds.width, options.bounds.height);\n        document.body.appendChild(svg);\n        var g = createSvgElement('g', { 'id': this.diagram.element.id + '_pageBackground' });\n        var region = options && options.region ? options.region : 'Content';\n        var bounds = this.getDiagramBounds(region, options);\n        var left = bounds.x;\n        var top = bounds.y;\n        var width = bounds.width;\n        var height = bounds.height;\n        svg.appendChild(g);\n        var attr = {\n            'x': String(left),\n            'y': String(top), 'width': String(width), 'height': String(height)\n        };\n        setAttributeSvg(g, attr);\n        this.setTransform(g, options.bounds, margin);\n        var gradient = document.getElementById(this.diagram.element.id + 'gradient_pattern');\n        if (gradient) {\n            svg.appendChild(gradient);\n        }\n        attr = {\n            'x': String(left),\n            'y': String(top), 'width': String(width + margin.left + margin.right), 'height': String(height + margin.top + margin.bottom)\n        };\n        var backimage = document.getElementById(this.diagram.element.id + '_backgroundImageLayer').cloneNode(true);\n        setAttributeSvg(backimage, attr);\n        svg.appendChild(backimage);\n        this.setTransform(backimage, bounds, margin);\n        var backRect = document.getElementById(this.diagram.element.id + '_backgroundLayerrect').cloneNode(true);\n        setAttributeSvg(backRect, attr);\n        svg.appendChild(backRect);\n        this.setTransform(backRect, bounds, margin);\n        if (this.diagram.mode === 'SVG') {\n            var element = void 0;\n            var i = void 0;\n            var diagramLayerSVG = getDiagramLayerSvg(this.diagram.element.id);\n            svg.appendChild(diagramLayerSVG.getElementById(this.diagram.diagramLayer.id).cloneNode(true));\n            for (i = 0; i < svg.childNodes.length; i++) {\n                element = svg.childNodes[i];\n                if (element.id === this.diagram.element.id + '_diagramLayer') {\n                    this.setTransform(element, bounds, margin);\n                }\n            }\n        }\n        else {\n            g = createSvgElement('g', { 'id': this.diagram.element.id + '_diagramLayer' });\n            svg.appendChild(g);\n            this.setTransform(g, options.bounds, margin);\n            //renderLabels\n            var renderer = new DiagramRenderer('', null, true);\n            var htmlLayer = getHTMLLayer(this.diagram.element.id);\n            this.diagram.renderDiagramElements(svg, renderer, htmlLayer, false);\n        }\n        document.body.removeChild(svg);\n        return svg;\n    };\n    PrintAndExport.prototype.setTransform = function (element, bounds, margin) {\n        element.setAttribute('transform', 'translate(' + (-bounds.x + margin.left) + ', ' +\n            (-bounds.y + margin.top) + ')');\n    };\n    PrintAndExport.prototype.diagramAsCanvas = function (options, customBounds) {\n        var scaleX = 'scaleX';\n        var scaleY = 'scaleY';\n        var scaleOffsetX = 'scaleOffsetX';\n        var scaleOffsetY = 'scaleOffsetY';\n        var element;\n        var elements = [];\n        var region = options.bounds;\n        var margin = options.margin;\n        var mode = options && options.region ? options.region : 'Content';\n        var pageBounds = this.getDiagramBounds(mode, options);\n        var bgColor = this.diagram.pageSettings.background.color;\n        var canvas = CanvasRenderer.createCanvas(this.diagram.element.id + '_diagram', options.bounds.width, options.bounds.height);\n        //canvas.setAttribute('style', 'position:absolute;top:135px;left:160px;');\n        var context = canvas.getContext('2d');\n        context.translate(-region.x, -region.y);\n        context.save();\n        context.fillStyle = (this.diagram.pageSettings.background.color === 'transparent') ? 'white' :\n            this.diagram.pageSettings.background.color;\n        region = mode === 'Content' ? pageBounds : region;\n        context.fillRect(region.x, region.y, region.width, region.height);\n        var bgImg = this.diagram.pageSettings.background;\n        if (bgImg && bgImg.source) {\n            pageBounds = this.getDiagramBounds(mode, options);\n            var image = new Image();\n            image.src = bgImg.source;\n            var proportionX = pageBounds.width / image.width;\n            var proportionY = pageBounds.height / image.height;\n            var x = pageBounds.x;\n            var y = pageBounds.y;\n            var width = pageBounds.width;\n            var height = pageBounds.height;\n            var exportable = this.isImageExportable(bgImg);\n            if (bgImg.scale !== 'None' && bgImg.align !== 'None') {\n                var proportion = bgImg.scale === 'Meet' ? Math.min(proportionX, proportionY) : Math.max(proportionX, proportionY);\n                width = proportion * image.width;\n                height = proportion * image.height;\n                if (bgImg.align.indexOf('xmid') > -1) {\n                    x += (pageBounds.width - width) / 2;\n                }\n                else if (bgImg.align.indexOf('xmax') > -1) {\n                    x = x + pageBounds.width - width;\n                }\n                if (bgImg.align.indexOf('ymid') > -1) {\n                    y += (pageBounds.height - height) / 2;\n                }\n                else if (bgImg.align.indexOf('ymax') > -1) {\n                    y = y + pageBounds.height - height;\n                }\n                if (this.diagram.pageSettings.background.color === 'none' || this.diagram.pageSettings.background.color === 'transparent') {\n                    context.fillStyle = 'white';\n                    context.fillRect(pageBounds.x * options[scaleX], pageBounds.y * options[scaleY], pageBounds.width * options[scaleX], pageBounds.height * options[scaleY]);\n                }\n                if (exportable) {\n                    context.drawImage(image, x, y, proportion * image.width, proportion * image.height);\n                }\n            }\n            else if (exportable) {\n                context.drawImage(image, x, y, pageBounds.width, pageBounds.height);\n            }\n        }\n        else {\n            context.fillStyle = bgColor === 'transparent' ? 'white' : bgColor;\n            context.fillRect((pageBounds.x * options[scaleX]) - margin.left, (pageBounds.y * options[scaleY]) - margin.top, (pageBounds.width * options[scaleX]) + margin.left + margin.right, (options[scaleY] * pageBounds.height) + margin.top + margin.bottom);\n        }\n        var brColor = this.diagram.pageSettings.background.color;\n        var brWidth = this.diagram.pageSettings.width;\n        if (brWidth) {\n            context.strokeStyle = brColor === 'none' ? 'transparent' : brColor;\n            context.lineWidth = brWidth;\n            context.strokeRect(pageBounds.x * options[scaleX], pageBounds.y * options[scaleY], pageBounds.width * options[scaleX], pageBounds.height * options[scaleY]);\n        }\n        context.restore();\n        var htmlLayer = getHTMLLayer(this.diagram.element.id);\n        var renderer = new DiagramRenderer('', null, false);\n        this.updateObjectValue(options[scaleX], options[scaleOffsetX], options[scaleOffsetY], true);\n        this.diagram.renderDiagramElements(canvas, renderer, htmlLayer, false, true);\n        this.updateObjectValue(options[scaleX], options[scaleOffsetX], options[scaleOffsetY], false);\n        return canvas;\n    };\n    PrintAndExport.prototype.updateWrapper = function (canvas, value, scaleOffsetX, scaleOffsetY, isExport) {\n        if (canvas && canvas.length > 0) {\n            for (var j = 0; j < canvas.length; j++) {\n                if (canvas[j].children) {\n                    this.updateWrapper(canvas[j].children, value, scaleOffsetX, scaleOffsetY, isExport);\n                }\n                canvas[j].exportScaleValue.x = value;\n                canvas[j].exportScaleValue.y = value;\n                canvas[j].exportScaleOffset.x = scaleOffsetX;\n                canvas[j].exportScaleOffset.y = scaleOffsetY;\n                canvas[j].isExport = isExport;\n            }\n        }\n    };\n    PrintAndExport.prototype.scaleGradientValue = function (node, scaleValue, isExport) {\n        if (node.style.gradient.stops.length > 0) {\n            var gradients = node.style.gradient;\n            if (node.style.gradient instanceof LinearGradient) {\n                gradients.x1 = isExport ? gradients.x1 * scaleValue : gradients.x1 / scaleValue;\n                gradients.y1 = isExport ? gradients.y1 * scaleValue : gradients.y1 / scaleValue;\n                gradients.x2 = isExport ? gradients.x2 * scaleValue : gradients.x2 / scaleValue;\n                gradients.y2 = isExport ? gradients.y2 * scaleValue : gradients.y2 / scaleValue;\n            }\n            else {\n                gradients.fx = isExport ? gradients.fx * scaleValue : gradients.fx / scaleValue;\n                gradients.fy = isExport ? gradients.fy * scaleValue : gradients.fy / scaleValue;\n                gradients.cx = isExport ? gradients.cx * scaleValue : gradients.cx / scaleValue;\n                gradients.cy = isExport ? gradients.cy * scaleValue : gradients.cy / scaleValue;\n                gradients.r = isExport ? gradients.r * scaleValue : gradients.r / scaleValue;\n            }\n        }\n    };\n    PrintAndExport.prototype.updateObjectValue = function (value, scaleOffsetX, scaleOffsetY, isExport) {\n        var wrapper;\n        for (var i = 0; i < this.diagram.nodes.length; i++) {\n            wrapper = this.diagram.nodes[i].wrapper;\n            this.scaleGradientValue(this.diagram.nodes[i], value, isExport);\n            this.updateWrapper(wrapper.children, value, scaleOffsetX, scaleOffsetY, isExport);\n            wrapper.exportScaleValue.x = value;\n            wrapper.exportScaleValue.y = value;\n            wrapper.exportScaleOffset.x = scaleOffsetX;\n            wrapper.exportScaleOffset.y = scaleOffsetY;\n            wrapper.isExport = isExport;\n        }\n        for (var j = 0; j < this.diagram.connectors.length; j++) {\n            wrapper = this.diagram.connectors[j].wrapper;\n            for (var k = 0; k < wrapper.children.length; k++) {\n                wrapper.children[k].isExport = isExport;\n                if (isExport) {\n                    wrapper.children[k].exportScaleValue.x = value;\n                    wrapper.children[k].exportScaleValue.y = value;\n                    wrapper.children[k].exportScaleOffset.x = scaleOffsetX;\n                    wrapper.children[k].exportScaleOffset.y = scaleOffsetY;\n                }\n            }\n        }\n    };\n    PrintAndExport.prototype.isImageExportable = function (backgroundImage) {\n        var state = true;\n        var content;\n        var canvas;\n        if (backgroundImage.source) {\n            try {\n                canvas = CanvasRenderer.createCanvas(this.diagram.element.id + 'temp_canvas', 100, 100);\n                var ctx = canvas.getContext('2d');\n                ctx.save();\n                var image = new Image();\n                image.src = backgroundImage.source;\n                ctx.drawImage(image, 0, 0, 100, 100);\n                ctx.restore();\n                content = canvas.toDataURL();\n            }\n            catch (e) {\n                state = false;\n            }\n        }\n        return state;\n    };\n    PrintAndExport.prototype.getPrintCanvasStyle = function (img, options) {\n        var width = 0;\n        var height = 0;\n        var size = new Size();\n        width = img.width;\n        height = img.height;\n        if (options.pageHeight || options.pageWidth) {\n            height = options.pageHeight ? options.pageHeight : height;\n            width = options.pageWidth ? options.pageWidth : width;\n        }\n        if (options.pageOrientation) {\n            if ((options.pageOrientation === 'Landscape' && height > width) || options.pageOrientation === 'Portrait' && width > height) {\n                var temp = width;\n                width = height;\n                height = temp;\n            }\n        }\n        size.height = height;\n        size.width = width;\n        return size;\n    };\n    PrintAndExport.prototype.getMultipleImage = function (img, options, isExport) {\n        var imageArray = [];\n        var div = createHtmlElement('div', {});\n        var pageSize = this.getPrintCanvasStyle(img, options);\n        //let pageWidth: number;\n        //let pageHeight: number;\n        var margin = options.margin;\n        var mLeft = margin.left;\n        var mTop = margin.top;\n        var mRight = margin.right;\n        var mBottom = margin.bottom;\n        var x = 0;\n        var y = 0;\n        var pageWidth = pageSize.width + x;\n        var pageHeight = pageSize.height + y;\n        var drawnX = 0;\n        var drawnY = 0;\n        if (options && options.multiplePage) {\n            div.style.height = 'auto';\n            div.style.width = 'auto';\n            var imgHeight = img.height;\n            var imgWidth = img.width;\n            //if (img) {\n            var i = 0;\n            var j = 0;\n            var url = void 0;\n            var clipWidth = 0;\n            var clipHeight = 0;\n            var ctx = void 0;\n            var canvas = void 0;\n            do {\n                do {\n                    clipWidth = pageSize.width;\n                    clipHeight = pageSize.height;\n                    if ((drawnX + pageSize.width) >= imgWidth) {\n                        clipWidth = (imgWidth - drawnX);\n                    }\n                    if ((drawnY + pageSize.height) >= imgHeight) {\n                        clipHeight = (imgHeight - drawnY);\n                    }\n                    canvas = CanvasRenderer.createCanvas(this.diagram.element.id + '_multiplePrint', pageSize.width, pageSize.height);\n                    ctx = canvas.getContext('2d');\n                    ctx.drawImage(img, x + drawnX + mLeft, y + drawnY + mTop, clipWidth - mRight - mLeft, clipHeight - mBottom - mTop, 0 + mLeft, 0 + mTop, clipWidth - mRight - mLeft, clipHeight - mBottom - mTop);\n                    if ((drawnX + pageSize.width) >= imgWidth) {\n                        drawnX -= (drawnX - imgWidth);\n                    }\n                    url = canvas.toDataURL();\n                    ctx.restore();\n                    drawnX += pageWidth;\n                    if (isExport) {\n                        imageArray.push(url);\n                    }\n                    else {\n                        this.printImage(div, url, i + '' + j, pageWidth + 'px;', pageHeight + 'px;');\n                    }\n                    i++;\n                } while (drawnX < imgWidth);\n                j++;\n                i = x = drawnX = 0;\n                if ((drawnY + pageSize.height) >= imgHeight) {\n                    drawnY -= (drawnY - imgHeight);\n                }\n                drawnY += pageHeight;\n            } while (drawnY < imgHeight);\n            //}\n        }\n        else {\n            var x_1 = 0;\n            var y_1 = 0;\n            var pageSize_1 = this.getPrintCanvasStyle(img, options);\n            ///let pageWidth: number; let pageHeight: number;\n            var pageWidth_1 = pageSize_1.width;\n            var pageHeight_1 = pageSize_1.height;\n            //let ctx: CanvasRenderingContext2D;\n            //let canvas: HTMLCanvasElement;\n            //let url: string;\n            var canvas = CanvasRenderer.createCanvas(this.diagram.element.id + '_diagram', pageWidth_1, pageHeight_1);\n            var ctx = canvas.getContext('2d');\n            ctx.drawImage(img, x_1 + mLeft, y_1 + mTop, img.width - (mRight + mLeft), img.height - (mTop + mBottom), 0 + mLeft, 0 + mTop, pageWidth_1 - (mRight + mLeft), pageHeight_1 - (mTop + mBottom));\n            var url = canvas.toDataURL();\n            ctx.restore();\n            if (isExport) {\n                imageArray.push(url);\n            }\n            else {\n                this.printImage(div, url, 0);\n            }\n        }\n        if (isExport) {\n            return imageArray;\n        }\n        else {\n            return div;\n        }\n    };\n    PrintAndExport.prototype.printImage = function (div, url, i, pageWidth, pageHeight) {\n        var attr = { 'class': 'e-diagram-print-page', 'style': 'width:' + pageWidth + 'height:' + pageHeight };\n        var img = createHtmlElement('img', attr);\n        var innerDiv = createHtmlElement('div', attr);\n        attr = { 'id': this.diagram.element.id + '_multiplePrint_img' + i, 'style': 'float:left', 'src': url };\n        setAttributeHtml(img, attr);\n        innerDiv.appendChild(img);\n        div.appendChild(innerDiv);\n    };\n    /**\n     * To print the image\n     *\n     * @private\n     */\n    PrintAndExport.prototype.print = function (options) {\n        options.mode = 'Data';\n        var url = this.exportDiagram(options);\n        this.printImages(url, options);\n    };\n    PrintAndExport.prototype.printImages = function (url, options) {\n        var _this = this;\n        var attr = {\n            'id': this.diagram.element.id + '_printImage',\n            'src': url\n        };\n        options.margin = { top: 0, bottom: 0, right: 0, left: 0 };\n        var img = createHtmlElement('img', attr);\n        img.onload = function () {\n            var div = _this.getMultipleImage(img, options);\n            // specify window parameters\n            var printWind = window.open('');\n            if (printWind != null) {\n                if ((div instanceof HTMLElement)) {\n                    printWind.document.write('<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page' +\n                        '{page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}' +\n                        '</style><title></title></head>');\n                    printWind.addEventListener('load', function (event) {\n                        setTimeout(function () {\n                            printWind.window.print();\n                        }, 3000);\n                    });\n                    printWind.document.write('<center>' + div.innerHTML + '</center>');\n                    printWind.document.close();\n                }\n            }\n        };\n    };\n    /** @private */\n    PrintAndExport.prototype.getDiagramContent = function (styleSheets) {\n        var container = document.getElementById(this.diagram.element.id + 'content');\n        var scrollerX = container.scrollLeft;\n        var scrollerY = container.scrollTop;\n        var oldZoom = this.diagram.scrollSettings.currentZoom;\n        var oldHorizontalOffset = this.diagram.scroller.horizontalOffset;\n        var oldVerticalOffset = this.diagram.scroller.verticalOffset;\n        var oldWidth = Number(String(this.diagram.width).split('%')[0]) ?\n            container.clientWidth : Number(String(this.diagram.width).split('px')[0]);\n        var oldHeight = Number(String(this.diagram.height).split('%')[0]) ?\n            container.clientHeight : Number(String(this.diagram.height).split('px')[0]);\n        var bounds = this.getDiagramBounds('', {});\n        this.diagram.scroller.zoom((1 / oldZoom));\n        var scrollX = 0;\n        var scrollY = 0;\n        scrollX = bounds.x;\n        scrollY = bounds.y;\n        this.diagram.scroller.transform = {\n            tx: -scrollX,\n            ty: -scrollY,\n            scale: this.diagram.scroller.currentZoom\n        };\n        this.diagram.scroller.horizontalOffset = -scrollX;\n        this.diagram.scroller.verticalOffset = -scrollY;\n        this.diagram.scroller.setSize();\n        this.diagram.setSize(bounds.width, bounds.height);\n        var snapConstraints = this.diagram.snapSettings.constraints;\n        this.diagram.snapSettings.constraints = (this.diagram.snapSettings.constraints & ~SnapConstraints.ShowLines);\n        this.diagram.dataBind();\n        this.diagram.clearSelection();\n        styleSheets = styleSheets || document.styleSheets;\n        var styleSheetRef = '';\n        for (var i = 0; i < styleSheets.length; i++) {\n            if (styleSheets[i].href || typeof styleSheets[i] === 'string') {\n                styleSheetRef += '<link href=\\'' + (styleSheets[i].href || styleSheets[i]) + '\\' rel=\\'stylesheet\\' />';\n            }\n        }\n        var htmlData = document.getElementById(this.diagram.element.id + 'content').innerHTML;\n        var marginStyle = 'margin-left:' + 0 + 'px;margin-top:' + 0 + 'px;margin-right:'\n            + 0 + 'px;margin-bottom:' + 0 + 'px;';\n        htmlData = styleSheetRef + '<body style=\"margin: 0px; padding: 0px\"><div style=\\'' +\n            marginStyle + '\\'>' + htmlData + '</div></body>';\n        htmlData = htmlData.replace(/ transform: t/g, ' -webkit-transform: t');\n        this.diagram.setSize(oldWidth, oldHeight);\n        this.diagram.scroller.zoom(oldZoom / this.diagram.scrollSettings.currentZoom);\n        this.diagram.snapSettings.constraints = snapConstraints;\n        this.diagram.dataBind();\n        if (scrollerX || scrollerY) {\n            this.diagram.setOffset(scrollerX, scrollerY);\n        }\n        else {\n            this.diagram.scroller.transform = {\n                tx: (oldHorizontalOffset) / this.diagram.scroller.currentZoom,\n                ty: (oldVerticalOffset) / this.diagram.scroller.currentZoom,\n                scale: this.diagram.scroller.currentZoom\n            };\n            this.diagram.scroller.horizontalOffset = oldHorizontalOffset;\n            this.diagram.scroller.verticalOffset = oldVerticalOffset;\n        }\n        this.diagram.renderSelector(false);\n        /* tslint:disable */\n        // eslint-disable-next-line quotes\n        return checkBrowserInfo() ? htmlData.replace(\"url(\" + location.protocol + '//' + location.host + location.pathname + \"#diagram_pattern \", \"url(#diagram_pattern)\") : htmlData;\n        /* tslint:enable */\n    };\n    /** @private */\n    PrintAndExport.prototype.exportImages = function (image, options) {\n        var _this = this;\n        var region = options && options.region ? options.region : 'Content';\n        var margin = options.margin || {};\n        margin = {\n            top: !isNaN(margin.top) ? margin.top : 0,\n            bottom: !isNaN(margin.bottom) ? margin.bottom : 0,\n            left: !isNaN(margin.left) ? margin.left : 0,\n            right: !isNaN(margin.right) ? margin.right : 0\n        };\n        var bounds = this.getDiagramBounds(region, {});\n        if (options.bounds) {\n            bounds.x = (!isNaN(options.bounds.x) ? options.bounds.x : bounds.x);\n            bounds.y = (!isNaN(options.bounds.y) ? options.bounds.y : bounds.y);\n            bounds.width = (options.bounds.width || bounds.width);\n            bounds.height = (options.bounds.height || bounds.height);\n        }\n        var img = document.createElement('img');\n        var attr = {\n            'src': image\n        };\n        setAttributeHtml(img, attr);\n        var context = this;\n        img.onload = function () {\n            var canvas = CanvasRenderer.createCanvas(context.diagram.element.id + 'innerImage', bounds.width + (margin.left + margin.right), bounds.height + (margin.top + margin.bottom));\n            var ctx = canvas.getContext('2d');\n            ctx.fillStyle = context.diagram.pageSettings.background.color;\n            ctx.fillRect(0, 0, bounds.width + (margin.left + margin.right), bounds.height + (margin.top + margin.bottom));\n            ctx.drawImage(img, 0, 0, bounds.width, bounds.height, margin.left, margin.top, bounds.width, bounds.height);\n            image = canvas.toDataURL();\n            if (options.printOptions) {\n                context.printImages(image, options);\n                return;\n            }\n            ctx.restore();\n            var fileName = options.fileName || 'diagram';\n            _this.canvasMultiplePage(options, canvas, margin, image, fileName);\n        };\n    };\n    /**\n     *To destroy the ruler\n     *\n     * @returns {void} To destroy the ruler\n     */\n    PrintAndExport.prototype.destroy = function () {\n        /**\n         * Destroys the Print and Export module\n         */\n    };\n    /**\n     * Get module name.\n     */\n    PrintAndExport.prototype.getModuleName = function () {\n        /**\n         * Returns the module name\n         */\n        return 'PrintandExport';\n    };\n    return PrintAndExport;\n}());\nexport { PrintAndExport };\n"]},"metadata":{},"sourceType":"module"}